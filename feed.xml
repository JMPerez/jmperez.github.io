<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Jose M. Perez&#39;s Blog</title>
  
  <subtitle>Web development, performance, and some other good practices.</subtitle>
  <link href="/feed.xml" rel="self"/>
  
  <link href="https://jmperezperez.com/"/>
  <updated>2019-04-05T16:47:14.845Z</updated>
  <id>https://jmperezperez.com/</id>
  
  <author>
    <name>Jose M. Perez</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Building Spotify‚Äôs New Web Player</title>
    <link href="https://jmperezperez.com/building-spotify-new-web-player/"/>
    <id>https://jmperezperez.com/building-spotify-new-web-player/</id>
    <published>2019-03-25T05:00:00.000Z</published>
    <updated>2019-04-05T16:47:14.845Z</updated>
    
    <content type="html"><![CDATA[<p>Spotify‚Äôs tech blog has just published my post <a href="https://labs.spotify.com/2019/03/25/building-spotifys-new-web-player/" target="_blank" rel="noopener">Building Spotify‚Äôs New Web Player</a>. I explain why we decided to start from scratch and write a brand new Spotify experience on the web, and how the team is thinking about the future of the project.</p><div style="position:relative;padding-bottom:75%;margin-bottom:1rem"><a href="https://labs.spotify.com/2019/03/25/building-spotifys-new-web-player/" target="_blank" rel="noopener"><img style="max-width:100%; border: 0;position:absolute;top:0;left:0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1554482735/spotify-new-web-player_wynfik.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1554482735/spotify-new-web-player_wynfik.jpg 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1554482735/spotify-new-web-player_wynfik.jpg 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1554482735/spotify-new-web-player_wynfik.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1554482735/spotify-new-web-player_wynfik.jpg" alt></a></div><p>Replacing a working product with a new one is a though decision, and doing it from scratch instead of iteratively always raises red flags. However, sometimes it‚Äôs the best option in order to move forward.</p><p>Spotify‚Äôs web player has been my biggest challenge at Spotify. The most difficult one but the most rewarding.</p><p><a href="https://labs.spotify.com/2019/03/25/building-spotifys-new-web-player/" target="_blank" rel="noopener">Read article on Spotify‚Äôs tech blog</a>.</p><a id="more"></a>]]></content>
    
    <summary type="html">
    
      A story on why and how we built a new Web Player at Spotify. Or how re-writing can be a good decision if risks are minimized and solutions properly validated.
    
    </summary>
    
    
      <category term="spotify" scheme="https://jmperezperez.com/tags/spotify/"/>
    
  </entry>
  
  <entry>
    <title>What PWAs for Desktop means for Users and Developers</title>
    <link href="https://jmperezperez.com/pwas-on-desktop/"/>
    <id>https://jmperezperez.com/pwas-on-desktop/</id>
    <published>2019-03-19T07:15:00.000Z</published>
    <updated>2019-03-19T17:36:20.505Z</updated>
    
    <content type="html"><![CDATA[<p>As Progressive Web Apps make their way on desktop I wanted to talk about why I consider this is a breakthrough. I have talked in the past <a href="/shades-of-pwa/">about different uses cases for PWA</a>. In this post I want to focus on PWAs for desktop.</p><div style="position:relative;padding-bottom:76.47%;margin-bottom:1rem"><img style="max-width:100%; border: 0;position:absolute;top:0;left:0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1552998597/spotify-pwa-mac_szshj0.png 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1552998597/spotify-pwa-mac_szshj0.png 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1552998597/spotify-pwa-mac_szshj0.png 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1552998597/spotify-pwa-mac_szshj0.png 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1552998597/spotify-pwa-mac_szshj0.png" alt></div><p>The current version of Google Chrome stable is Chrome 73. This version <a href="https://twitter.com/rauschma/status/1105599978880331777" target="_blank" rel="noopener">lets you install Progressive Web Apps natively on macOS</a>. You can find more information about the release on <a href="https://developers.google.com/web/updates/2019/03/nic73#pwas-everywhere" target="_blank" rel="noopener">Pete LePage‚Äôs ‚ÄúNew in Chrome 73‚Äù notes</a>.<a id="more"></a></p><p>Wasn‚Äôt this possible before? Well, yes. On Chrome 72 the only option was to <a href="https://developers.google.com/web/fundamentals/app-install-banners/#listen_for_beforeinstallprompt" target="_blank" rel="noopener">wait for a <code>beforeinstallprompt</code> event</a> to then show some button on your page to let the user install the website as a PWA. Since version 73 users can install the PWA directly from Chrome‚Äôs context menu.</p><p>Now, going back to why this is a milestone. <a href="https://twitter.com/jmperezperez/status/1107565909906997250" target="_blank" rel="noopener">I recently tweeted about how to install Spotify‚Äôs web player as a PWA</a> using Chrome‚Äôs context menu.</p><p>I got this great question:</p><p><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">What benefit does this give you vs the regular downloaded desktop app? (Sorry for the ignorance üòÖ)</p>&mdash; Functor Flavius ùù∫ (@FlavioCorpa) <a href="https://twitter.com/FlavioCorpa/status/1107782132791947271?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">18 March 2019</a></blockquote></p><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><h2 id="Understanding-What-to-Optimize-for"><a href="#Understanding-What-to-Optimize-for" class="headerlink" title="Understanding What to Optimize for"></a>Understanding What to Optimize for</h2><p>If you are working on a new website you will see that PWAs for desktop is a nice addition to your site. Users who want to run it as a desktop app can do it. This has some obvious benefits, nicely summarized on <a href="https://developers.google.com/web/progressive-web-apps/desktop" target="_blank" rel="noopener">Pete LePage‚Äôs ‚ÄúDesktop Progressive Web Apps‚Äù article</a>:</p><blockquote><p>They‚Äôre fast. Feel integrated because they launched in the same way as other apps, and run in an app window, without an address bar or tabs. They‚Äôre reliable because service workers can cache all of the assets they need to run. And they create an engaging experience for users.</p></blockquote><p>If you have been working on a project that was a desktop app, the question can be the opposite: <strong>‚ÄúWhat benefit does a desktop app gives you vs the website?‚Äù</strong>. We have seen this battle over and over again on the mobile landscape, with apps vs mobile web. The main advantage of an app is its discoverability, through the Play Store / App Store, but more than that is the presence on your home screen. When you install the app on your phone it‚Äôs there on your grid of apps. You will see the icon easily and you will open it with just a tap. You might get notifications if you opt-in, which will be a good way for the app owner to let you re-engage with you. Doing this on the web is possible, but more difficult. The discoverability is less straightforward. Knowing that a web site can be installed is not that obvious.</p><p>Discoverability is great, but companies look at other important metrics that installable apps excel at against the web: <strong>retention and engagement</strong>. If you have a shortcut to an app on your home screen you will be more likely to use the app than if you don‚Äôt have it. Same thing if you get push notifications. And in the case of Spotify‚Äôs desktop application you will even get the app open automatically when you start your computer. It‚Äôs difficult not to engage with it.</p><p>For services with both app and website there is also another aspect that is usually disregarded. Users that have downloaded and installed your app have higher intention of using the app than those that only only the web version. It‚Äôs natural to think that the end goal is to take users to the platform that has better metrics, so the web is usually seen as a place to put banners and modals that beg the user to install the app.</p><p>What is ignored is that in the way towards the installable app <strong>there will be many users abandoning because they don‚Äôt want to, or can‚Äôt, download and install the app</strong>.</p><p>Retention and engagement was one of the reasons why Spotify keeps developing a desktop application, but also capabilities. A desktop application allowed performant music streaming in the days when network was the bottleneck. It also let premium users download music to be played offline. And it also had a much better integration with the operating system (eg adding custom buttons to the Touch Bar on MacOS, or custom taskbar buttons on Windows).</p><div style="position:relative;padding-bottom:75%;margin-bottom:1rem"><img style="max-width:100%; border: 0;position:absolute;top:0;left:0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1552998304/spotify-mac-touch-bar_q7ywci.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1552998304/spotify-mac-touch-bar_q7ywci.jpg 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1552998304/spotify-mac-touch-bar_q7ywci.jpg 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1552998304/spotify-mac-touch-bar_q7ywci.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1552998304/spotify-mac-touch-bar_q7ywci.jpg" alt="Picture of a Macbook Pro running the Spotify app, with custom controls in the Touch Bar"></div><h2 id="What-the-Web-can-Do"><a href="#What-the-Web-can-Do" class="headerlink" title="What the Web can Do"></a>What the Web can Do</h2><p>The web has been ticking off most of these. Take for instance offline capabilities with encrypted content which <a href="https://www.youtube.com/watch?v=--KA2VrPDao" target="_blank" rel="noopener">Paul Lewis explained how to implement two years ago</a>.</p><p>For companies that currently have 2 implementations of their service, one as an app and another as a website, the question should be ‚Äúis the cost of developing 2 different versions of the same thing worth it?‚Äù. And in most cases PWA for desktop means that, at least on desktop, there is no strong advantage in having the overhead of developing multiple versions. This is especially true in the case that the code base of these versions differs greatly, as in the case of Spotify‚Äôs desktop app and web player.</p><p>The web has also a couple of great benefits over a hybrid app on desktop. Push notifications encourage users to go back to your site even if it‚Äôs not open currently on a browser. And more importantly, the web makes it extremely easy to deliver feature updates and fixes (bug fixes, security fixes, code roll backs). No need to go through release cycles nor app store approvals. Having every user on the latest version is a great perk that should be more appreciated.</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>As I wanted to highlight, for the user the good news is that there are no news. They can install a PWA as a desktop application and won‚Äôt miss any ‚Äútruly desktop app‚Äù capabilities. For a company, though, this can save a lot of duplicated work, help their developers move faster and deliver the best experience for the user regardless of their device.</p><p>Because the web was always great for this.</p>]]></content>
    
    <summary type="html">
    
      Progressive Web Apps for desktop fills an important gap for the web. Native apps might not be worth thanks to the new capabilities of the web
    
    </summary>
    
    
      <category term="pwa" scheme="https://jmperezperez.com/tags/pwa/"/>
    
  </entry>
  
  <entry>
    <title>Developing modern sites with good performance</title>
    <link href="https://jmperezperez.com/modern-sites-good-performance/"/>
    <id>https://jmperezperez.com/modern-sites-good-performance/</id>
    <published>2019-02-01T06:15:00.000Z</published>
    <updated>2019-05-12T05:18:55.050Z</updated>
    
    <content type="html"><![CDATA[<p>Poor performance leads to exclusion. When we create heavy sites we limit what users can access our content. Those with more powerful devices and better network will get sites loaded faster. Those with older devices and slower network will need to wait more.</p><p><div style="position:relative;padding-bottom:66.6666%;margin-bottom:1rem"><img style="max-width:100%; border: 0;position:absolute;top:0;left:0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1549005393/android-apps-hand-15092_zj2jkp.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1549005393/android-apps-hand-15092_zj2jkp.jpg 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1549005393/android-apps-hand-15092_zj2jkp.jpg 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1549005393/android-apps-hand-15092_zj2jkp.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1549005393/android-apps-hand-15092_zj2jkp.jpg" alt></div><a id="more"></a></p><h2 id="Why-performance-is-important"><a href="#Why-performance-is-important" class="headerlink" title="Why performance is important"></a>Why performance is important</h2><p><a href="https://wpostats.com/" target="_blank" rel="noopener">Study after study</a> shows how slowing sites down results in less engagement, less time on the site and a general decrease in key business metrics. Still, in our development teams we continue to prioritize more highly shipping features over addressing web performance.</p><p>Don‚Äôt get me wrong, features are important. Serving an empty site is fast, but not very useful. It‚Äôs important to deliver a core set of features, and do it in such a way that many users can enjoy it. Just keep in mind that if they user can‚Äôt use the product we will lose them, no matter how much we have worked on the feature set.</p><h2 id="Our-role-promoting-performance"><a href="#Our-role-promoting-performance" class="headerlink" title="Our role promoting performance"></a>Our role promoting performance</h2><p>Developers play a key role in prioritizing performance. They can steer what tasks the development team works on, and they can prove with results the impact of the changes.</p><p>While some performance improvements might be costly in time, there are usually lots of low-hanging fruits that can drive to big improvements. And we are more prepared than ever to do a good job.</p><p>We have a better understanding of how the browser and network works, and how to serve content to the user without incurring in delays. We also use tools to build our sites that help us defining dependencies and delivering a small payload, tailored to the current session.</p><h2 id="Taking-advantage-of-modern-tools"><a href="#Taking-advantage-of-modern-tools" class="headerlink" title="Taking advantage of modern tools"></a>Taking advantage of modern tools</h2><p>Single Page Applications and the trend of moving most of the logic to the client comes with performance implications. There is now more work to do in the browser, like data-fetching, templating or routing, which makes sites slower out-of-the-box. If we don‚Äôt stop there and explore the beauty of component-based sites we will see that <a href="/high-performance-lazy-loading/">code-splitting and lazy-loading</a> fit perfectly in the picture and they allow us, for the first time, to be smart on how we ship code while keeping complexity at a minimum.</p><p>While it can be difficult to keep track of every new tool and browser API, it‚Äôs important to be aware of them. It wouldn‚Äôt be smart to jump immediately on them and rewrite constantly our product on the latest and trendiest stack, but we can learn something from them.</p><p>I get inspired by tools like <a href="https://www.gatsbyjs.org/" target="_blank" rel="noopener">Gatsby</a> or <a href="https://nextjs.org/" target="_blank" rel="noopener">Next.js</a>. They let us build sites that have a high performance out of the box. What they do is not black magic, but making a good job serving what is needed for the current page, and deferred the loading of the rest of the content. Nothing prevents us from adopting some of those techniques to our projects to give them a boost.</p><h2 id="The-web-that-is-coming"><a href="#The-web-that-is-coming" class="headerlink" title="The web that is coming"></a>The web that is coming</h2><p>The future looks bright. We are decoupling UI and data. We are creating sites that can be run on a laptop, phone, TV or <a href="https://developer.apple.com/videos/play/wwdc2018/239/" target="_blank" rel="noopener">smartwatch</a>. We are building offline experiences and sites that synchronize in the background and handle push notifications. We are moving desktop applications to the web, seamlessly running <a href="https://developer.mozilla.org/docs/WebAssembly" target="_blank" rel="noopener">assembly code</a> in the browser.</p>]]></content>
    
    <summary type="html">
    
      Performance affects user engagement but also can leave many users out. Fast sites are key to democratize the web and let everyone enjoy our products and services.
    
    </summary>
    
    
      <category term="performance" scheme="https://jmperezperez.com/tags/performance/"/>
    
  </entry>
  
  <entry>
    <title>My 2018</title>
    <link href="https://jmperezperez.com/my-2018/"/>
    <id>https://jmperezperez.com/my-2018/</id>
    <published>2018-12-30T05:00:00.000Z</published>
    <updated>2019-03-19T08:12:57.820Z</updated>
    
    <content type="html"><![CDATA[<p>As I expected, this year I have dedicated more time to my family and less to side projects. I have been on parental leave for 7 months and it has been a great time to put things in perspective.</p><a id="more"></a><h2 id="Blogging"><a href="#Blogging" class="headerlink" title="Blogging"></a>Blogging</h2><p>During 2018 I wrote 8 blog posts. This is way lower than <a href="/my-2017/">last year</a>.</p><p>The main highlight was that I got to publish <a href="https://www.smashingmagazine.com/2018/02/progressive-image-loading-user-perceived-performance/" target="_blank" rel="noopener">a post on Smashing Magazine on user perceived peformance</a>. I enjoyed the experience a lot and their support helped me writing posts with a better structure. I also like seeing that it gets referenced in posts <a href="https://calendar.perfplanet.com/2018/improving-perceived-performance-web-app/" target="_blank" rel="noopener">like this from Perfplanet‚Äôs Performance Calendar</a>.</p><h2 id="Side-projects"><a href="#Side-projects" class="headerlink" title="Side projects"></a>Side projects</h2><p>I started a project with <a href="https://twitter.com/nucliweb" target="_blank" rel="noopener">Joan Le√≥n (aka @nucliweb)</a> to do performance reviews of web sites and explain our findings as videos. We both like talking about performance and realized that lots of developers don‚Äôt know where to start when improving it, and lots of stakeholders in general don‚Äôt give performance the importance it deserves.</p><p>The videos are in Spanish and we want to take it as an opportunity to make it easier for a huge community to access knowledge that exists mainly in English. If you are interested in having a look, check out <a href="https://www.youtube.com/channel/UCNoF5_1loBFvW2lZXPxp8ww" target="_blank" rel="noopener">our channel on Youtube</a>.</p><h2 id="Conferences"><a href="#Conferences" class="headerlink" title="Conferences"></a>Conferences</h2><p>This year I spoke at <a href="/pitercss-2018/">PiterCSS in Saint Petersburg</a>, <a href="https://www.meetup.com/Stockholm-ReactJS-Meetup/events/253918039/" target="_blank" rel="noopener">ReactJS in Stockholm</a>, <a href="https://www.meetup.com/Stockholm-Google-Developer-Group/events/255690962/" target="_blank" rel="noopener">GDG in Stockholm</a>, and <a href="https://noti.st/jmperez/bSkEUc/better-performance-for-component-based-web-apps" target="_blank" rel="noopener">Codemotion in Madrid</a>.</p><h2 id="Certifications"><a href="#Certifications" class="headerlink" title="Certifications"></a>Certifications</h2><p>I became a <a href="https://developers.google.com/experts/people/jose-manuel-perez-perez" target="_blank" rel="noopener">Google Developer Expert in Web Technologies</a>, which got me in contact with an amazing community of developers who are pushing the web forward in different fronts. It‚Äôs also great to have contacts from Google at hand to know more about their web initiatives.</p><h2 id="Work"><a href="#Work" class="headerlink" title="Work"></a>Work</h2><p>Parental leave meant changes for me. I came to the conclusion that I wanted to make a professional move after 6+ years working at Spotify. I still don‚Äôt know if I just loved my work too much or became too attached to some projects I wanted to see succeed (which they did). Truth is that I woke up some day and realized I needed to push myself a bit enough out of my comfort zone, and that would bring positive experiences.</p><h2 id="What‚Äôs-next-in-2019"><a href="#What‚Äôs-next-in-2019" class="headerlink" title="What‚Äôs next in 2019?"></a>What‚Äôs next in 2019?</h2><p>In a few days I will start working at Facebook and I‚Äôm excited to take on new challenges. It will be a new role for me, taking a step back from the web, looking at a bigger picture to use technology to unlock business opportunities.</p><p>This is a big change for me and I‚Äôm looking forward to find out what the future looks like.</p>]]></content>
    
    <summary type="html">
    
      Wrapping up 2018 - A summary of what I have done during this year.
    
    </summary>
    
    
      <category term="pwa" scheme="https://jmperezperez.com/tags/pwa/"/>
    
  </entry>
  
  <entry>
    <title>The different shades of Progressive Web¬†Apps</title>
    <link href="https://jmperezperez.com/shades-of-pwa/"/>
    <id>https://jmperezperez.com/shades-of-pwa/</id>
    <published>2018-11-02T12:44:00.000Z</published>
    <updated>2019-03-19T08:12:57.820Z</updated>
    
    <content type="html"><![CDATA[<p>Implementing a PWA or adapting an existing site to ‚Äúbecome a PWA‚Äù can be daunting. There are many new technologies to learn about, but you don‚Äôt need to use all of them to improve your website performance and user experience greatly.</p><div style="position:relative;padding-bottom:66.6666%;margin-bottom:1rem"><img style="max-width:100%; border: 0;position:absolute;top:0;left:0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1541172389/shades-of-pwa/header.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1541172389/shades-of-pwa/header.jpg 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1541172389/shades-of-pwa/header.jpg 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1541172389/shades-of-pwa/header.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1541172389/shades-of-pwa/header.jpg" alt></div><p>On this post I will describe several use cases where Progressive Web Apps (PWA) can be useful to make your website achieve better performance and be more reliable.</p><a id="more"></a><h2 id="What-are-Progressive-Web-Apps"><a href="#What-are-Progressive-Web-Apps" class="headerlink" title="What are Progressive Web Apps"></a>What are Progressive Web Apps</h2><p>If you are a web developer you have probably heard about Progressive Web Apps (PWA). Web sites that load quick, are reliable, feel smooth and take advantage of modern APIs.</p><p>There is a lot of buzz about them, partly because Google coined the term and has been leading the implementation of the bits and pieces that composed it.</p><p>Implementing a PWA or adapting an existing site to ‚Äúbecome a PWA‚Äù looks like a big endeavor. The same powerful marketing that has made PWA known in the developer community can be a blessing and a curse. Developers might get the wrong idea that either they use everything and make installable offline-capable push notifications-enabled websites, or they bail out. After all, <strong>PWA is just a way to coin a set of recent browser APIs and techniques, not all or nothing</strong>.</p><p>Every website‚Äôs use case is different and that is alright. If installing your website as an app is not something a user would do for your site, you don‚Äôt need to build that capability. <strong>You can still take advantage of some of the technologies powering PWAs</strong>. The main requirement is that your site runs on HTTPS and, in most cases, creating a ServiceWorker, which is not more than a Javascript file.</p><p>I want to describe some of the typical scenarios where you can applied elements from PWAs.</p><h2 id="Common-Use-Cases-to-Apply-Service-Workers-and-other-PWA-related-functionality"><a href="#Common-Use-Cases-to-Apply-Service-Workers-and-other-PWA-related-functionality" class="headerlink" title="Common Use Cases to Apply Service Workers and other PWA-related functionality"></a>Common Use Cases to Apply Service Workers and other PWA-related functionality</h2><h3 id="Offline-mode-and-pre-caching"><a href="#Offline-mode-and-pre-caching" class="headerlink" title="Offline mode and pre-caching"></a>Offline mode and pre-caching</h3><p>To get your site to load without a connection, the user needs to visit it and the site needs to run a Service Worker (SW)that will make content available offline. The SW can follow different strategies (eg serving cache first, making a network request first, etc). You can find strategies on <a href="https://jakearchibald.com/2014/offline-cookbook/" target="_blank" rel="noopener">Jake Archibald‚Äôs Offline Cookbook</a> and <a href="https://serviceworke.rs/" target="_blank" rel="noopener">serviceworke.rs</a>.</p><div style="position:relative;padding-bottom:49%;margin-bottom:1rem"><img style="max-width:100%; border: 0; position: absolute; top: 0; left: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1541172749/shades-of-pwa/stale-while-revalidate-sw.png 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1541172749/shades-of-pwa/stale-while-revalidate-sw.png 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1541172749/shades-of-pwa/stale-while-revalidate-sw.png 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1541172749/shades-of-pwa/stale-while-revalidate-sw.png 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1541172749/shades-of-pwa/stale-while-revalidate-sw.png" alt="Stale-while-revalidate‚Äù strategy, of the many explained on Jake Archibald‚Äôs Offline Cookbook"></div><p><small class="caption">‚ÄúStale-while-revalidate‚Äù strategy, of the many explained on <a href="https://jakearchibald.com/2014/offline-cookbook/" target="_blank" rel="noopener">Jake Archibald‚Äôs Offline Cookbook</a>. If there‚Äôs a cached version available, use it, but fetch an update for next time.</small></p><p>The strategies that check the cache first can be used to fetch and pre-cache top-level navigation routes and other critical resources. Thus, the user gets a faster loading and rendering experience as they click around the PWA.</p><p>Offline support is something that can be added pretty much to any site, big or small. I run <a href="https://jmperezperez.com/sw.js">a simple SW</a> <a href="https://jmperezperez.com">on my blog</a> to download the main sections and the posts that the user reads.</p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// the cache version gets updated every time there is a new deployment</span><span class="token keyword">const</span> CACHE_VERSION <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token keyword">const</span> CURRENT_CACHE <span class="token operator">=</span> <span class="token template-string"><span class="token string">`main-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>CACHE_VERSION<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// these are the routes we are going to cache for offline support</span><span class="token keyword">const</span> cacheFiles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token string">'/about-me/'</span><span class="token punctuation">,</span> <span class="token string">'/projects/'</span><span class="token punctuation">,</span> <span class="token string">'/offline/'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// on activation we clean up the previously registered service workers</span>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'activate'</span><span class="token punctuation">,</span> evt <span class="token operator">=</span><span class="token operator">></span>  evt<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>    caches<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>        cacheNames<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>cacheName <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>cacheName <span class="token operator">!==</span> CURRENT_CACHE<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>      <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// on install we download the routes we want to cache for offline</span>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> evt <span class="token operator">=</span><span class="token operator">></span>  evt<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>    caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>CURRENT_CACHE<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>cache <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>cacheFiles<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// fetch the resource from the network</span><span class="token keyword">const</span> fromNetwork <span class="token operator">=</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span>  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fulfill<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> timeoutId <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>reject<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">fetch</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeoutId<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">fulfill</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">update</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// fetch the resource from the browser cache</span><span class="token keyword">const</span> fromCache <span class="token operator">=</span> request <span class="token operator">=</span><span class="token operator">></span>  caches    <span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>CURRENT_CACHE<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>cache <span class="token operator">=</span><span class="token operator">></span>      cache        <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>matching <span class="token operator">=</span><span class="token operator">></span> matching <span class="token operator">||</span> cache<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">'/offline/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// cache the current page to make it available for offline</span><span class="token keyword">const</span> update <span class="token operator">=</span> request <span class="token operator">=</span><span class="token operator">></span>  caches    <span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>CURRENT_CACHE<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>cache <span class="token operator">=</span><span class="token operator">></span>      <span class="token function">fetch</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=</span><span class="token operator">></span> cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// general strategy when making a request (eg if online try to fetch it</span><span class="token comment" spellcheck="true">// from the network with a timeout, if something fails serve from cache)</span>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> evt <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  evt<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>    <span class="token function">fromNetwork</span><span class="token punctuation">(</span>evt<span class="token punctuation">.</span>request<span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">fromCache</span><span class="token punctuation">(</span>evt<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>  evt<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span><span class="token function">update</span><span class="token punctuation">(</span>evt<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>With great power comes great responsibility. Do not use SWs to abuse the user‚Äôs data connection, downloading content they will never need, just in case.</p><h3 id="Service-Workers-for-Multi-page-Applications"><a href="#Service-Workers-for-Multi-page-Applications" class="headerlink" title="Service Workers for Multi-page Applications"></a>Service Workers for Multi-page Applications</h3><p>In a multi-page app (MPA), every route that a user navigates to triggers a full request of the page, along with associated scripts and styles needed, to the server.</p><p>A good example is <a href="https://ele.me" target="_blank" rel="noopener">ele.me</a>, the biggest food ordering and delivery company in mainland China. They used a SW to precache the main routes from their site, and implemented skeleton screens that are immediately shown while loading routes that aren‚Äôt cached.</p><div><img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:350,f_auto,c_scale,w_600/v1541171672/shades-of-pwa/ele-me-skeleton-page.png" sizes="(max-width: 768px) 50vw, 350px" alt="Processing a picture through Primitive using 10 shapes" style="width:48%;float:left;margin-right:2%;padding-bottom:10px"> <img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:350,f_auto,c_scale,w_600/v1541171587/shades-of-pwa/ele-me-full-load.png" sizes="(max-width: 768px) 50vw, 350px" alt="Processing a picturethrough Primitive using 100 shapes" style="width:48%;float:left;margin-right:2%;padding-bottom:10px"></div><p>You can read more about their approach on <a href="https://developers.google.com/web/showcase/2017/eleme" target="_blank" rel="noopener">Google Developers site</a> and <a href="https://medium.com/elemefe/upgrading-ele-me-to-progressive-web-app-2a446832e509" target="_blank" rel="noopener">this in-depth post</a>.</p><h3 id="Bridging-the-gap-between-SPAs-and-server-side-rendered-sites"><a href="#Bridging-the-gap-between-SPAs-and-server-side-rendered-sites" class="headerlink" title="Bridging the gap between SPAs and server-side rendered sites"></a>Bridging the gap between SPAs and server-side rendered sites</h3><p>Web development has gone through different stages</p><ol><li>Old sites used to be server-side rendered. Only minor interactions used Javascript in the client. Every page navigation meant a full page load.</li><li>Then we started creating more complex web experiences and moved all the logic (and templates) to client-side land. Everything was amazing as long as you waited a bit while staring at a blank page whose main purpose was to load a large JS bundle.</li><li>We realized that maybe we needed a hybrid solution. First request server-side rendered, then the rest happening client-side.</li></ol><p><strong>Reaching the third step involves doing server-side rendering.</strong> If you don‚Äôt want to duplicate templates and logic, the usual solution is to use NodeJS on the server. This is fun for web developers because we get to use the same language both on server and browser. In medium and large web projects it means rewriting existing working code from python/java/PHP/others to Javascript, and the typical nuances of adopting something different from the existing solution.</p><p>Server-side rendered sites have also a largely underestimated drawback. <strong>Putting content early on the screen is one thing. Making the content interactive is another.</strong> A page that renders quickly but then doesn‚Äôt respond to click/touch for seconds, while loads and executes the JS behemoth, results in frustration.</p><p>In web dev terms we are improving the <a href="https://developers.google.com/web/tools/lighthouse/audits/first-meaningful-paint" target="_blank" rel="noopener">First Meaningful Paint</a> (‚ÄòFMP‚Äô), but we aren‚Äôt making any improvement in the <a href="https://developers.google.com/web/tools/lighthouse/audits/time-to-interactive" target="_blank" rel="noopener">Time to Interactive</a> (‚ÄòTTI‚Äô).</p><p>This short version of Addy Osmani‚Äôs ‚ÄúThe cost of JavaScript‚Äú explains it very well:</p><div class="videoWrapper"><iframe width="1764" height="1080" src="https://www.youtube.com/embed/qUFA1pAMfj4" frameborder="0" allowfullscreen></iframe></div><p><small class="caption">‚Äú<a href="https://www.youtube.com/watch?v=qUFA1pAMfj4" target="_blank" rel="noopener">The cost of JavaScript</a>‚Äù by Addy Osmani. If you like it, there is also <a href="https://www.youtube.com/watch?v=63I-mEuSvGA" target="_blank" rel="noopener">a longer version of the talk.</a></small></p><p>Paul Lewis also described the situation in his post ‚Äú<a href="https://aerotwist.com/blog/when-everything-is-important-nothing-is/" target="_blank" rel="noopener">When everything is important nothing is</a>‚Äù, and describes it as the <em>Uncanny Valley.</em></p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1541171412/shades-of-pwa/uncanny-valley.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1541171412/shades-of-pwa/uncanny-valley.jpg 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1541171412/shades-of-pwa/uncanny-valley.jpg 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1541171412/shades-of-pwa/uncanny-valley.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1541171412/shades-of-pwa/uncanny-valley.jpg" alt="Spotify web player shows an offline page when there is no internet connection"> <small class="caption">Rendering your app server-side. An image from ‚Äú<a href="https://aerotwist.com/blog/when-everything-is-important-nothing-is/" target="_blank" rel="noopener">When everything is important nothing is</a>‚Äù.</small></p><p>I have seen many cases when server-side rendering was proposed as the first step to improve the performance in a SPA. This left off the table ideas like bundle-splitting, which would have likely reduced both FMP and TTI.</p><blockquote><p>[‚Ä¶] <strong>you should avoid SSR if you don‚Äôt need it.</strong> Most modern web apps require sophisticated interaction with the UI that has to be driven by non-trivial amounts of JavaScript. If you need to write all of that JS anyway, and you <em>don‚Äôt</em> need the first page load benefits that SSR gives you, you‚Äôll be better off just building a <a href="https://developers.google.com/web/fundamentals/architecture/app-shell" target="_blank" rel="noopener">static app shell</a> and avoiding the headaches of client-server code reuse, data re-hydration, and dynamic content cache invalidation.‚Ää‚Äî‚Ää<a href="https://blog.usejournal.com/when-should-i-server-side-render-c2a383ff2d0f" target="_blank" rel="noopener">When should I Server-Side Render?</a> by <a href="https://blog.usejournal.com/@mbleigh" target="_blank" rel="noopener">Michael Bleigh</a></p></blockquote><p>Single Page Applications that are not server-side rendered can take great advantage from using Service Workers. In most cases the browser requests some data and injects it in a JS template or component. This means that the browser can cache the JS code and the data independently.</p><p>The site can then follow different strategies. For instance, it can load immediately with stale data, similar to what usually happens with native apps. It can also decide to render a skeleton while the data is fetched. In any case, it makes an approach like <a href="https://developers.google.com/web/fundamentals/performance/prpl-pattern/" target="_blank" rel="noopener">PRPL</a>, easy to implement.</p><h3 id="Installable-Website"><a href="#Installable-Website" class="headerlink" title="Installable Website"></a>Installable Website</h3><p>You might want to make your website installable, close to what everyone knows as an ‚Äúapp‚Äù. For this you don‚Äôt need many to use many capabilities from the web. As long as your site runs on HTTPS you just need a web manifest, an icon and a ServiceWorker. You can find documentation on <a href="https://developers.google.com/web/fundamentals/app-install-banners/" target="_blank" rel="noopener">Google‚Äôs Developer site</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/Apps/Progressive/Installable_PWAs" target="_blank" rel="noopener">MDN</a>.</p><p>Your site doesn‚Äôt need to be fully functional offline to make it installable. Take for instance Spotify‚Äôs Progressive Web App.</p><div class="videoWrapper"><iframe width="560" height="315" src="https://www.youtube.com/embed/EvcjSldzQ1E" frameborder="0" allowfullscreen></iframe></div><p><small class="caption">Spotify‚Äôs Web Player works as an installable PWA.</small></p><p>As you see, the PWA is installable, yet it doesn‚Äôt have support for offline navigation nor playback. When there is no connection, the PWA shows this custom page:</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1541171689/shades-of-pwa/spotify-offline.png 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1541171689/shades-of-pwa/spotify-offline.png 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1541171689/shades-of-pwa/spotify-offline.png 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1541171689/shades-of-pwa/spotify-offline.png 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1541171689/shades-of-pwa/spotify-offline.png" alt="Spotify web player shows an offline page when there is no internet connection"></p><p>Installable PWAs are not limited to mobile. They are already supported on <a href="https://developers.google.com/web/progressive-web-apps/desktop" target="_blank" rel="noopener">ChromeOS, Windows and Linux</a>, and pretty soon on Mac too (Chrome 72+).</p><h4 id="More-features-enabled-by-Service-Workers"><a href="#More-features-enabled-by-Service-Workers" class="headerlink" title="More features enabled by Service Workers"></a>More features enabled by Service Workers</h4><p>I have only talked about some use cases for ServiceWorkers and other elements of PWAs, but there are more. Browsers can show <a href="https://developers.google.com/web/fundamentals/push-notifications/" target="_blank" rel="noopener">push notifications</a> after the user has enabled it for a certain site, and the push notifications are delivered even when the site is not opened. This makes it ideal for reengage with users without having to wait for them to visit your site again.</p><p>You can also use <a href="https://developers.google.com/web/updates/2015/12/background-sync" target="_blank" rel="noopener">background sync</a>, ideally for schedule data sending beyond the life of the page. Think of uploading pictures or sending chat messages even after the user leaves the page.</p><h3 id="More-Resources"><a href="#More-Resources" class="headerlink" title="More Resources"></a>More Resources</h3><p>I love reading about real sites that have adopted PWAs and have shared their findings. I particularly like <a href="https://www.youtube.com/watch?v=aCMbSyngXB4" target="_blank" rel="noopener">Addy Osmani‚Äôs talk ‚ÄúProduction Progressive Web Apps With JavaScript Frameworks‚Äù</a>, showcasing some case studies from large web sites that have been integrating these technologies to improve their key metrics.</p><div class="videoWrapper"><iframe width="1764" height="1080" src="https://www.youtube.com/embed/aCMbSyngXB4" frameborder="0" allowfullscreen></iframe></div><p>They are good examples to demonstrate that you don‚Äôt need to re-architecture an existing site to use PWA goodness, and that you can apply some of these concepts and see improvements in perceived performance very quickly.</p>]]></content>
    
    <summary type="html">
    
      Taking advantage of PWA functionality on your site is easy. You don&#39;t need to go all-in using all the features. Just take what is needed for your use case.
    
    </summary>
    
    
      <category term="pwa" scheme="https://jmperezperez.com/tags/pwa/"/>
    
  </entry>
  
  <entry>
    <title>Common Pitfalls when Serving SVGs and How to Solve Them</title>
    <link href="https://jmperezperez.com/spotify-svg/"/>
    <id>https://jmperezperez.com/spotify-svg/</id>
    <published>2018-09-22T06:20:00.000Z</published>
    <updated>2019-03-19T08:12:57.819Z</updated>
    
    <content type="html"><![CDATA[<p>Optimizing SVGs is great for performance, but can we go beyond? In this post I will show some common issues with inlined and responsive SVGs applied to a real website.</p><p>Scalable Vector Graphics (SVG) are ideal to show logos and drawings on the web due to their small size. SVGs also have other useful applications, such as <a href="/svg-placeholders">placeholders for lazy loaded images</a> and <a href="/drawing-edges-svg">animations</a>. In a past post I also explained <a href="/optimising-svgs">how to optimize a SVG</a> with several tools that remove unneeded code and simplify shapes.</p><p>Even if we optimize our SVG assets, we can still make mistakes delivering those to the browser. In this post I am going to explain some issues I found on Spotify‚Äôs website, where the same SVG is inlined several times and where a responsive SVG logo could save additional network requests.</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1537603259/spotify-svg/spotify-svg.png 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1537603259/spotify-svg/spotify-svg.png 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1537603259/spotify-svg/spotify-svg.png 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1537603259/spotify-svg/spotify-svg.png 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1537603259/spotify-svg/spotify-svg.png" alt="Spotify SVG logo showing its arcs and points"></p><a id="more"></a><p>If there is something that all Spotify sites have in common, it‚Äôs the Spotify logo. It is usually shown in the header of the page, and also in the footer. In addition the Spotify circle logo might appear somewhere in the middle.</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1537603261/spotify-svg/spotify-logos.png 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1537603261/spotify-svg/spotify-logos.png 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1537603261/spotify-svg/spotify-logos.png 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1537603261/spotify-svg/spotify-logos.png 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1537603261/spotify-svg/spotify-logos.png" alt="Spotify's home page on www.spotify.com. The logo is shown in the header and the footer"> <small class="caption">Spotify‚Äôs home page on <a href="http://www.spotify.com" target="_blank" rel="noopener">www.spotify.com</a>. The logo is shown in the header and the footer.</small></p><p>Spotify‚Äôs logo is served using SVG. This vector format is ideal for drawings and icons. They look crisp on every screen, are usually small in bytes, are compressible, stylable through CSS, scriptable through JS‚Ä¶ What‚Äôs not to like?</p><p>There are still ways to misuse SVGs or not take advantage of its capabilities. In this post I want to explain some improvements that can be applied to the Spotify logo and the way it is served.</p><h3 id="Tip-1-Include-it-once"><a href="#Tip-1-Include-it-once" class="headerlink" title="Tip 1: Include it once"></a>Tip 1: Include it once</h3><p>SVGs can be inserted on web pages in different ways. In the case of the Spotify logo above it is inlined in CSS, setting it as a <code>background-image</code>:</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1537603267/spotify-svg/spotify-logo-header.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1537603267/spotify-svg/spotify-logo-header.jpg 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1537603267/spotify-svg/spotify-logo-header.jpg 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1537603267/spotify-svg/spotify-logo-header.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1537603267/spotify-svg/spotify-logo-header.jpg" alt="Inspecting the Spotify logo in the header"> <small class="caption">Inspecting the Spotify logo in the header.</small></p><p>Chrome Developer Tools doesn‚Äôt show the whole code for the logo. If we inspect it we get this not showing the whole code for the logo, which is this:</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Layer_1<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">enable-background</span><span class="token punctuation">:</span>new <span class="token number">0</span> <span class="token number">0</span> <span class="token number">566.93</span> <span class="token number">170.04</span></span><span class="token punctuation">"</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/2000/svg<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xml:</span>space</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>preserve<span class="token punctuation">"</span></span> <span class="token attr-name">viewBox</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0 0 566.93 170.04<span class="token punctuation">"</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1.1<span class="token punctuation">"</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0px<span class="token punctuation">"</span></span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0px<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xlink</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/1999/xlink<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>567<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>171<span class="token punctuation">"</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#FFF<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>m87.996 1.277c-46.249 0-83.743 37.493-83.743 83.742 0 46.254 37.494 83.745 83.743 83.745 46.251 0 83.743-37.491 83.743-83.745 0-46.246-37.49-83.738-83.744-83.738zm38.404 120.78c-1.504 2.467-4.718 3.24-7.177 1.737-19.665-12.019-44.417-14.734-73.567-8.075-2.809 0.644-5.609-1.117-6.249-3.925-0.643-2.809 1.11-5.609 3.926-6.249 31.9-7.293 59.263-4.154 81.336 9.334 2.46 1.51 3.24 4.72 1.73 7.18zm10.25-22.799c-1.894 3.073-5.912 4.037-8.981 2.15-22.505-13.834-56.822-17.841-83.447-9.759-3.453 1.043-7.1-0.903-8.148-4.35-1.04-3.453 0.907-7.093 4.354-8.143 30.413-9.228 68.221-4.758 94.071 11.127 3.07 1.89 4.04 5.91 2.15 8.976zm0.88-23.744c-26.994-16.031-71.52-17.505-97.289-9.684-4.138 1.255-8.514-1.081-9.768-5.219-1.254-4.14 1.08-8.513 5.221-9.771 29.581-8.98 78.756-7.245 109.83 11.202 3.722 2.209 4.943 7.016 2.737 10.733-2.2 3.722-7.02 4.949-10.73 2.739z<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>m232.09 78.586c-14.459-3.448-17.033-5.868-17.033-10.953 0-4.804 4.523-8.037 11.249-8.037 6.52 0 12.985 2.455 19.763 7.509 0.205 0.153 0.462 0.214 0.715 0.174 0.253-0.038 0.477-0.177 0.625-0.386l7.06-9.952c0.29-0.41 0.211-0.975-0.18-1.288-8.067-6.473-17.151-9.62-27.769-9.62-15.612 0-26.517 9.369-26.517 22.774 0 14.375 9.407 19.465 25.663 23.394 13.836 3.187 16.171 5.857 16.171 10.63 0 5.289-4.722 8.577-12.321 8.577-8.44 0-15.324-2.843-23.025-9.512-0.191-0.165-0.453-0.24-0.695-0.226-0.255 0.021-0.488 0.139-0.65 0.334l-7.916 9.421c-0.332 0.391-0.29 0.975 0.094 1.313 8.96 7.999 19.98 12.224 31.872 12.224 16.823 0 27.694-9.192 27.694-23.419 0.03-12.01-7.16-18.66-24.77-22.944z<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>m294.95 64.326c-7.292 0-13.273 2.872-18.205 8.757v-6.624c0-0.523-0.424-0.949-0.946-0.949h-12.947c-0.523 0-0.946 0.426-0.946 0.949v73.602c0 0.523 0.423 0.949 0.946 0.949h12.947c0.522 0 0.946-0.426 0.946-0.949v-23.233c4.933 5.536 10.915 8.241 18.205 8.241 13.549 0 27.265-10.43 27.265-30.368 0.02-19.943-13.7-30.376-27.25-30.376zm12.21 30.375c0 10.153-6.254 17.238-15.209 17.238-8.853 0-15.531-7.407-15.531-17.238 0-9.83 6.678-17.238 15.531-17.238 8.81-0.001 15.21 7.247 15.21 17.237z<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>m357.37 64.326c-17.449 0-31.119 13.436-31.119 30.592 0 16.969 13.576 30.264 30.905 30.264 17.511 0 31.223-13.391 31.223-30.481 0-17.031-13.62-30.373-31.01-30.373zm0 47.714c-9.281 0-16.278-7.457-16.278-17.344 0-9.929 6.755-17.134 16.064-17.134 9.341 0 16.385 7.457 16.385 17.351 0 9.927-6.8 17.127-16.17 17.127z<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>m425.64 65.51h-14.247v-14.566c0-0.522-0.422-0.948-0.945-0.948h-12.945c-0.524 0-0.949 0.426-0.949 0.948v14.566h-6.225c-0.521 0-0.943 0.426-0.943 0.949v11.127c0 0.522 0.422 0.949 0.943 0.949h6.225v28.791c0 11.635 5.791 17.534 17.212 17.534 4.644 0 8.497-0.959 12.128-3.018 0.295-0.165 0.478-0.483 0.478-0.821v-10.596c0-0.327-0.17-0.636-0.45-0.807-0.282-0.177-0.633-0.186-0.922-0.043-2.494 1.255-4.905 1.834-7.6 1.834-4.154 0-6.007-1.886-6.007-6.113v-26.756h14.247c0.523 0 0.944-0.426 0.944-0.949v-11.126c0.02-0.523-0.4-0.949-0.93-0.949z<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>m475.28 65.567v-1.789c0-5.263 2.018-7.61 6.544-7.61 2.699 0 4.867 0.536 7.295 1.346 0.299 0.094 0.611 0.047 0.854-0.132 0.25-0.179 0.391-0.466 0.391-0.77v-10.91c0-0.417-0.268-0.786-0.67-0.909-2.565-0.763-5.847-1.546-10.761-1.546-11.958 0-18.279 6.734-18.279 19.467v2.74h-6.22c-0.522 0-0.95 0.426-0.95 0.948v11.184c0 0.522 0.428 0.949 0.95 0.949h6.22v44.409c0 0.523 0.422 0.949 0.944 0.949h12.947c0.523 0 0.949-0.426 0.949-0.949v-44.406h12.088l18.517 44.398c-2.102 4.665-4.169 5.593-6.991 5.593-2.281 0-4.683-0.681-7.139-2.025-0.231-0.127-0.505-0.148-0.754-0.071-0.247 0.087-0.455 0.271-0.56 0.511l-4.388 9.627c-0.209 0.455-0.03 0.989 0.408 1.225 4.581 2.481 8.716 3.54 13.827 3.54 9.56 0 14.844-4.453 19.502-16.433l22.461-58.04c0.113-0.292 0.079-0.622-0.1-0.881-0.178-0.257-0.465-0.412-0.779-0.412h-13.478c-0.404 0-0.765 0.257-0.897 0.636l-13.807 39.438-15.123-39.464c-0.138-0.367-0.492-0.61-0.884-0.61h-22.12z<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>m446.5 65.51h-12.947c-0.523 0-0.949 0.426-0.949 0.949v56.485c0 0.523 0.426 0.949 0.949 0.949h12.947c0.522 0 0.949-0.426 0.949-0.949v-56.481c0-0.523-0.42-0.949-0.95-0.949z<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>m440.1 39.791c-5.129 0-9.291 4.152-9.291 9.281 0 5.132 4.163 9.289 9.291 9.289 5.127 0 9.285-4.157 9.285-9.289 0-5.128-4.16-9.281-9.28-9.281z<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>m553.52 83.671c-5.124 0-9.111-4.115-9.111-9.112s4.039-9.159 9.159-9.159c5.124 0 9.111 4.114 9.111 9.107 0 4.997-4.04 9.164-9.16 9.164zm0.05-17.365c-4.667 0-8.198 3.71-8.198 8.253 0 4.541 3.506 8.201 8.151 8.201 4.666 0 8.201-3.707 8.201-8.253 0-4.541-3.51-8.201-8.15-8.201zm2.02 9.138l2.577 3.608h-2.173l-2.32-3.31h-1.995v3.31h-1.819v-9.564h4.265c2.222 0 3.683 1.137 3.683 3.051 0.01 1.568-0.9 2.526-2.21 2.905zm-1.54-4.315h-2.372v3.025h2.372c1.184 0 1.891-0.579 1.891-1.514 0-0.984-0.71-1.511-1.89-1.511z<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">></span></span></code></pre><p>The size of the image, not compressed, is 4,960 bytes. It‚Äôs not huge for an image, but we‚Äôll see there are ways to improve it.</p><p>The screenshot shows the style applied to <code>.navbar-logo</code>, which is the one shown in the header. The same logo is inlined a second time for the footer, applied to the <code>.footer .footer-logo&gt;a</code> CSS rule:</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1537603267/spotify-svg/spotify-logo-footer.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1537603267/spotify-svg/spotify-logo-footer.jpg 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1537603267/spotify-svg/spotify-logo-footer.jpg 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1537603267/spotify-svg/spotify-logo-footer.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1537603267/spotify-svg/spotify-logo-footer.jpg" alt="Inspecting the Spotify logo in the header"> <small class="caption">Inspecting the Spotify logo in the footer.</small></p><p>If that wasn‚Äôt enough, it is inlined a third time in the <code>.navbar-transparent-signup-b .navbar-logo</code> CSS rule, which is not being applied to this specific page.</p><p>Even though gzip helps with the size of the CSS, <strong>a better way would be to include it just once in a CSS class that can be reused as needed</strong>. Stylesheets are part of the critical path, so any savings here means that the page will render faster.</p><h3 id="Tip-2-Optimize-the-logo"><a href="#Tip-2-Optimize-the-logo" class="headerlink" title="Tip 2) Optimize the logo"></a>Tip 2) Optimize the logo</h3><p>If you take a close look at the SVG code for the Spotify logo you will see an id and style that are not needed. Optimizing SVGs by hand can be tricky, but fortunately there are tools like <a href="https://jakearchibald.github.io/svgomg/" target="_blank" rel="noopener">SVGOMG</a> that will make these and more changes for us.</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1537603266/spotify-svg/spotify-logo-svgomg.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1537603266/spotify-svg/spotify-logo-svgomg.jpg 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1537603266/spotify-svg/spotify-logo-svgomg.jpg 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1537603266/spotify-svg/spotify-logo-svgomg.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1537603266/spotify-svg/spotify-logo-svgomg.jpg" alt="Spotify logo on SVGMOMG"></p><p>Passing the image through the tool, keeping the same shape precision, gives us this code:</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/2000/svg<span class="token punctuation">"</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#FFF<span class="token punctuation">"</span></span> <span class="token attr-name">viewBox</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0 0 566.93 170.04<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M87.996 1.277c-46.249 0-83.743 37.493-83.743 83.742 0 46.254 37.494 83.745 83.743 83.745 46.251 0 83.743-37.491 83.743-83.745 0-46.246-37.49-83.738-83.744-83.738zm38.404 120.78c-1.504 2.467-4.718 3.24-7.177 1.737-19.665-12.019-44.417-14.734-73.567-8.075-2.809.644-5.609-1.117-6.249-3.925-.643-2.809 1.11-5.609 3.926-6.249 31.9-7.293 59.263-4.154 81.336 9.334 2.46 1.51 3.24 4.72 1.73 7.18zm10.25-22.799c-1.894 3.073-5.912 4.037-8.981 2.15-22.505-13.834-56.822-17.841-83.447-9.759-3.453 1.043-7.1-.903-8.148-4.35-1.04-3.453.907-7.093 4.354-8.143 30.413-9.228 68.221-4.758 94.071 11.127 3.07 1.89 4.04 5.91 2.15 8.976zm.88-23.744c-26.994-16.031-71.52-17.505-97.289-9.684-4.138 1.255-8.514-1.081-9.768-5.219-1.254-4.14 1.08-8.513 5.221-9.771 29.581-8.98 78.756-7.245 109.83 11.202 3.722 2.209 4.943 7.016 2.737 10.733-2.2 3.722-7.02 4.949-10.73 2.739zM232.09 78.586c-14.459-3.448-17.033-5.868-17.033-10.953 0-4.804 4.523-8.037 11.249-8.037 6.52 0 12.985 2.455 19.763 7.509.205.153.462.214.715.174.253-.038.477-.177.625-.386l7.06-9.952c.29-.41.211-.975-.18-1.288-8.067-6.473-17.151-9.62-27.769-9.62-15.612 0-26.517 9.369-26.517 22.774 0 14.375 9.407 19.465 25.663 23.394 13.836 3.187 16.171 5.857 16.171 10.63 0 5.289-4.722 8.577-12.321 8.577-8.44 0-15.324-2.843-23.025-9.512-.191-.165-.453-.24-.695-.226-.255.021-.488.139-.65.334l-7.916 9.421c-.332.391-.29.975.094 1.313 8.96 7.999 19.98 12.224 31.872 12.224 16.823 0 27.694-9.192 27.694-23.419.03-12.01-7.16-18.66-24.77-22.944zM294.95 64.326c-7.292 0-13.273 2.872-18.205 8.757v-6.624c0-.523-.424-.949-.946-.949h-12.947c-.523 0-.946.426-.946.949v73.602c0 .523.423.949.946.949h12.947c.522 0 .946-.426.946-.949v-23.233c4.933 5.536 10.915 8.241 18.205 8.241 13.549 0 27.265-10.43 27.265-30.368.02-19.943-13.7-30.376-27.25-30.376zm12.21 30.375c0 10.153-6.254 17.238-15.209 17.238-8.853 0-15.531-7.407-15.531-17.238 0-9.83 6.678-17.238 15.531-17.238 8.81-.001 15.21 7.247 15.21 17.237zM357.37 64.326c-17.449 0-31.119 13.436-31.119 30.592 0 16.969 13.576 30.264 30.905 30.264 17.511 0 31.223-13.391 31.223-30.481 0-17.031-13.62-30.373-31.01-30.373zm0 47.714c-9.281 0-16.278-7.457-16.278-17.344 0-9.929 6.755-17.134 16.064-17.134 9.341 0 16.385 7.457 16.385 17.351 0 9.927-6.8 17.127-16.17 17.127zM425.64 65.51h-14.247V50.944c0-.522-.422-.948-.945-.948h-12.945c-.524 0-.949.426-.949.948V65.51h-6.225c-.521 0-.943.426-.943.949v11.127c0 .522.422.949.943.949h6.225v28.791c0 11.635 5.791 17.534 17.212 17.534 4.644 0 8.497-.959 12.128-3.018.295-.165.478-.483.478-.821v-10.596c0-.327-.17-.636-.45-.807-.282-.177-.633-.186-.922-.043-2.494 1.255-4.905 1.834-7.6 1.834-4.154 0-6.007-1.886-6.007-6.113V78.54h14.247c.523 0 .944-.426.944-.949V66.465c.02-.523-.4-.949-.93-.949zM475.28 65.567v-1.789c0-5.263 2.018-7.61 6.544-7.61 2.699 0 4.867.536 7.295 1.346.299.094.611.047.854-.132.25-.179.391-.466.391-.77v-10.91c0-.417-.268-.786-.67-.909-2.565-.763-5.847-1.546-10.761-1.546-11.958 0-18.279 6.734-18.279 19.467v2.74h-6.22c-.522 0-.95.426-.95.948v11.184c0 .522.428.949.95.949h6.22v44.409c0 .523.422.949.944.949h12.947c.523 0 .949-.426.949-.949V78.538h12.088l18.517 44.398c-2.102 4.665-4.169 5.593-6.991 5.593-2.281 0-4.683-.681-7.139-2.025-.231-.127-.505-.148-.754-.071-.247.087-.455.271-.56.511l-4.388 9.627c-.209.455-.03.989.408 1.225 4.581 2.481 8.716 3.54 13.827 3.54 9.56 0 14.844-4.453 19.502-16.433l22.461-58.04c.113-.292.079-.622-.1-.881-.178-.257-.465-.412-.779-.412h-13.478c-.404 0-.765.257-.897.636l-13.807 39.438-15.123-39.464c-.138-.367-.492-.61-.884-.61h-22.12zM446.5 65.51h-12.947c-.523 0-.949.426-.949.949v56.485c0 .523.426.949.949.949H446.5c.522 0 .949-.426.949-.949V66.463c0-.523-.42-.949-.95-.949zM440.1 39.791c-5.129 0-9.291 4.152-9.291 9.281 0 5.132 4.163 9.289 9.291 9.289 5.127 0 9.285-4.157 9.285-9.289 0-5.128-4.16-9.281-9.28-9.281zM553.52 83.671c-5.124 0-9.111-4.115-9.111-9.112s4.039-9.159 9.159-9.159c5.124 0 9.111 4.114 9.111 9.107 0 4.997-4.04 9.164-9.16 9.164zm.05-17.365c-4.667 0-8.198 3.71-8.198 8.253 0 4.541 3.506 8.201 8.151 8.201 4.666 0 8.201-3.707 8.201-8.253 0-4.541-3.51-8.201-8.15-8.201zm2.02 9.138l2.577 3.608h-2.173l-2.32-3.31h-1.995v3.31h-1.819v-9.564h4.265c2.222 0 3.683 1.137 3.683 3.051.01 1.568-.9 2.526-2.21 2.905zm-1.54-4.315h-2.372v3.025h2.372c1.184 0 1.891-.579 1.891-1.514 0-.984-.71-1.511-1.89-1.511z<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">></span></span></code></pre><p>That is 4,383 bytes, amounting to 11,6% savings respect the original image.</p><p>We can achieve further improvements by simplifying paths and rounding the numbers. For example, instead of having a viewbox of 566.93 x 170.04 we could convert it to 567 x 170. Same thing with the position of the points in the paths.</p><p>If you are interested in this topic, I recommend you to read this series of posts by <a href="https://twitter.com/larsenwork" target="_blank" rel="noopener">Andreas Larsen</a>:</p><ul><li><a href="https://medium.com/larsenwork-andreas-larsen/optimising-svgs-for-web-use-part-1-67e8f2d4035" target="_blank" rel="noopener">Optimising SVGs for Web Use - Part 1</a></li><li><a href="https://medium.com/larsenwork-andreas-larsen/optimising-svgs-for-web-use-part-2-6711cc15df46" target="_blank" rel="noopener">Optimising SVGs for Web Use - Part 2</a></li><li><a href="https://medium.com/larsenwork-andreas-larsen/optimising-svgs-for-web-use-part-2-1-598815d74f9c" target="_blank" rel="noopener">Optimising SVGs for Web Use - Part 2¬Ω</a></li></ul><p>I spent some time optimizing the Spotify logo following Andreas‚Äô tips. You can read more about it <a href="/optimising-svgs/">on a post I wrote</a>. I managed to get the logo down to 1,859 bytes, or 62,7% reduction from the original image. The resulting image is visually almost identical to the original one.</p><p><a href="https://codepen.io/jmperez/pen/BjYaKg" target="_blank" rel="noopener">I created a codepen</a> so you can switch between the 2 versions and see it more clearly.</p><iframe id="cp_embed_BjYaKg" src="//codepen.io/jmperez/embed/BjYaKg?height=400&theme-id=0&slug-hash=BjYaKg&default-tab=result" scrolling="no" frameborder="no" height="400" allowtransparency="true" allowfullscreen="true" class="cp_embed_iframe" data-amp-width="100%" style="width: 100%; overflow: hidden"></iframe><h3 id="Tip-3-Responsive-logo"><a href="#Tip-3-Responsive-logo" class="headerlink" title="Tip 3: Responsive logo!"></a>Tip 3: Responsive logo!</h3><p>SVG is really powerful and people are discovering more use cases every day. We can use SVG to create a responsive logo that changes its contents depending on the size of the image. That‚Äôs right, the size of the image, not the viewport. This is similar to what container queries are supposed to do, but we can do it today.</p><p>Take for example the <a href="https://artists.spotify.com" target="_blank" rel="noopener">Spotify for Artists site</a>. On narrow windows it shows the Spotify logo + ‚Äúfor Artists‚Äù.</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1537603269/spotify-svg/spotify-artists-logo-header.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1537603269/spotify-svg/spotify-artists-logo-header.jpg 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1537603269/spotify-svg/spotify-artists-logo-header.jpg 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1537603269/spotify-svg/spotify-artists-logo-header.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1537603269/spotify-svg/spotify-artists-logo-header.jpg" alt="Spotify logo on Spotify's Artists page"></p><p>On wider windows it overrides the logo, using a wider one composed of the Spotify logo with ‚ÄúSpotify‚Äù + ‚Äúfor Artists‚Äù.</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1537603271/spotify-svg/spotify-artists-logo-header-wide.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1537603271/spotify-svg/spotify-artists-logo-header-wide.jpg 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1537603271/spotify-svg/spotify-artists-logo-header-wide.jpg 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1537603271/spotify-svg/spotify-artists-logo-header-wide.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1537603271/spotify-svg/spotify-artists-logo-header-wide.jpg" alt="Spotify logo on Spotify's Artists page (wide version)"></p><p>Instead of serving 2 different SVGs it‚Äôs possible to serve a single one. Then we define the width and height for the logo and let the logo render one of the versions. The advantage is a smaller payload since we can reuse elements like the Spotify circle logo inside the SVG.</p><p>‚Äú<a href="https://medium.com/9elements/building-a-responsive-image-e4c6229fa1f6" target="_blank" rel="noopener">Building a responsive image</a>‚Äù is a post that explains how to achieve this. It shows how to create a responsive logo with 4 different versions, including a rotated/vertical one. You can see <a href="https://codepen.io/enbee81/full/QrNRdm/" target="_blank" rel="noopener">a demo on codepen</a>.</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1537603825/spotify-svg/9elements.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1537603825/spotify-svg/9elements.jpg 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1537603825/spotify-svg/9elements.jpg 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1537603825/spotify-svg/9elements.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1537603825/spotify-svg/9elements.jpg" alt="Responsive logo for 9elements"> <small class="caption">Taken from <a href="https://medium.com/9elements/building-a-responsive-image-e4c6229fa1f6" target="_blank" rel="noopener">Building a responsive image</a></small></p><p>I thought I would do the same for the Spotify logo, switching between the ‚Äúcircle‚Äù and the ‚Äúcircle + Spotify‚Äù versions. I created <a href="https://codepen.io/jmperez/pen/ERMxmZ" target="_blank" rel="noopener">a codepen to demo it</a>.</p><iframe id="cp_embed_ERMxmZ" src="//codepen.io/jmperez/embed/ERMxmZ?height=400&theme-id=0&slug-hash=ERMxmZ&default-tab=result" scrolling="no" frameborder="no" height="400" allowtransparency="true" allowfullscreen="true" class="cp_embed_iframe" data-amp-width="100%" style="width: 100%; overflow: hidden"></iframe><p>The code for the responsive Spotify logo looks like this:</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/2000/svg<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100%<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100%<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xlink</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/1999/xlink<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">        <span class="token selector"><span class="token class">.square</span> </span><span class="token punctuation">{</span> <span class="token property">visibility</span><span class="token punctuation">:</span> visible<span class="token punctuation">;</span> <span class="token punctuation">}</span>        <span class="token selector"><span class="token class">.landscape</span> </span><span class="token punctuation">{</span> <span class="token property">visibility</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span> <span class="token punctuation">}</span>        <span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">min-aspect-ratio</span><span class="token punctuation">:</span> 1118/335<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>            <span class="token selector"><span class="token class">.square</span> </span><span class="token punctuation">{</span> <span class="token property">visibility</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span> <span class="token punctuation">}</span>            <span class="token selector"><span class="token class">.landscape</span> </span><span class="token punctuation">{</span> <span class="token property">visibility</span><span class="token punctuation">:</span> visible<span class="token punctuation">;</span> <span class="token punctuation">}</span>        <span class="token punctuation">}</span> </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>symbol</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>c<span class="token punctuation">"</span></span> <span class="token attr-name">viewBox</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0 0 335 335<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M0 167C0 259 75.7738 335 167.5 335C259.226 335 335 259 335 167C335 75 259.226 0 167.5 0C75.7738 0 0 75 0 167ZM229.315 245C190.432 221 140.58 215 82.753 228C68.7946 230 66.8006 210 78.7649 208C142.574 193 196.414 200 240.283 227C251.25 234 240.283 251 229.315 245ZM246.265 200C201.399 172 132.604 164 79.7619 180C62.8125 185 56.8304 159 72.7827 155C133.601 137 208.378 146 260.223 178C274.182 187 260.223 209 246.265 200ZM71.7857 129C54.8363 135 43.869 106 62.8125 99C121.637 81 221.339 84 283.155 121C300.104 130 284.152 158 266.205 148C212.366 116 122.634 113 71.7857 129Z<span class="token punctuation">"</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>black<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>symbol</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>symbol</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>s<span class="token punctuation">"</span></span> <span class="token attr-name">viewBox</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0 0 732 203<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M64.75 143C47.75 143 31.75 137 17.75 123C16.75 123 16.75 124 16.75 124L0.75 143C-0.25 144 -0.25 145 0.75 146C18.75 162 40.75 170 64.75 170C98.75 170 119.75 151 119.75 123C119.75 99 104.75 86 69.75 77C40.75 70 35.75 65 35.75 55C35.75 45 45.75 39 58.75 39C71.75 39 83.75 44 97.75 54C97.75 54 98.75 55 99.75 55C100.75 55 100.75 54 100.75 54L114.75 34C115.75 33 115.75 33 114.75 32C98.75 19 79.75 12 58.75 12C27.75 12 5.75 31 5.75 58C5.75 87 25.75 96 57.75 104C85.75 110 89.75 116 89.75 126C89.75 137 79.75 143 64.75 143ZM159.75 66V53C159.75 52 158.75 51 157.75 51H131.75C130.75 51 129.75 52 129.75 53V200C129.75 201 130.75 202 131.75 202H157.75C158.75 202 159.75 201 159.75 200V154C169.75 165 180.75 170 195.75 170C222.75 170 249.75 149 249.75 109C249.75 69 222.75 49 195.75 49C180.75 49 169.75 54 159.75 66ZM189.75 144C171.75 144 158.75 129 158.75 109C158.75 89 171.75 75 189.75 75C207.75 75 219.75 89 219.75 109C219.75 129 207.75 144 189.75 144ZM257.75 110C257.75 144 284.75 170 319.75 170C354.75 170 381.75 143 381.75 109C381.75 75 355.75 49 320.75 49C285.75 49 257.75 76 257.75 110ZM287.75 109C287.75 89 300.75 75 319.75 75C338.75 75 352.75 90 352.75 110C352.75 130 339.75 144 320.75 144C301.75 144 287.75 129 287.75 109ZM427.75 51V22C427.75 21 427.75 20 426.75 20H400.75C399.75 20 398.75 21 398.75 22V51H385.75C384.75 51 383.75 52 383.75 53V75C383.75 76 384.75 77 385.75 77H398.75V135C398.75 158 409.75 170 432.75 170C441.75 170 450.75 168 457.75 164C458.75 164 458.75 163 458.75 162V141C458.75 140 458.75 139 457.75 139H455.75C450.75 142 444.75 143 439.75 143C431.75 143 427.75 139 427.75 131V77H457.75C458.75 77 459.75 76 459.75 75V53C459.75 52 458.75 51 457.75 51H427.75ZM556.75 48C556.75 37 560.75 33 569.75 33C574.75 33 579.75 33 584.75 35H585.75C585.75 35 586.75 34 586.75 33V12C586.75 11 586.75 10 585.75 10C580.75 8 573.75 7 563.75 7C539.75 7 527.75 21 527.75 46V51H514.75C513.75 51 512.75 52 512.75 53V75C512.75 76 513.75 77 514.75 77H527.75V166C527.75 167 528.75 168 529.75 168H555.75C556.75 168 556.75 167 556.75 166V77H581.75L618.75 166C614.75 175 610.75 177 604.75 177C599.75 177 594.75 176 589.75 173H588.75L587.75 174L578.75 193C578.75 194 578.75 196 579.75 196C588.75 201 596.75 203 606.75 203C625.75 203 636.75 194 645.75 170L690.75 54V52C690.75 51 689.75 51 688.75 51H661.75C660.75 51 660.75 52 660.75 53L632.75 131L602.75 53C602.75 52 601.75 51 600.75 51H556.75V48ZM473.75 51C472.75 51 471.75 52 471.75 53V166C471.75 167 472.75 168 473.75 168H499.75C500.75 168 500.75 167 500.75 166V53C500.75 52 500.75 51 499.75 51H473.75ZM467.75 18C467.75 28 476.75 37 486.75 37C496.75 37 504.75 28 504.75 18C504.75 8 496.75 0 486.75 0C476.75 0 467.75 8 467.75 18ZM712.75 87C722.75 87 731.75 79 731.75 69C731.75 59 722.75 51 712.75 51C702.75 51 694.75 59 694.75 69C694.75 79 702.75 87 712.75 87ZM712.75 53C721.75 53 729.75 60 729.75 69C729.75 78 721.75 85 712.75 85C703.75 85 696.75 78 696.75 69C696.75 60 703.75 53 712.75 53ZM716.75 71C719.75 70 721.75 68 721.75 65C721.75 61 717.75 59 713.75 59H705.75V78H709.75V72H713.75L717.75 78H722.75L716.75 71ZM713.75 62C715.75 62 717.75 63 717.75 65C717.75 67 715.75 68 713.75 68H709.75V62H713.75Z<span class="token punctuation">"</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>black<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>symbol</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>symbol</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>landscape<span class="token punctuation">"</span></span> <span class="token attr-name">viewBox</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0 0 1118 335<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>use</span> <span class="token attr-name"><span class="token namespace">xlink:</span>href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#c<span class="token punctuation">"</span></span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>335<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>335<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>use</span> <span class="token attr-name"><span class="token namespace">xlink:</span>href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#s<span class="token punctuation">"</span></span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>386<span class="token punctuation">"</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>77<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>732<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>203<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>symbol</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>use</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>square<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xlink:</span>href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#c<span class="token punctuation">"</span></span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100%<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100%<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>use</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>landscape<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xlink:</span>href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#landscape<span class="token punctuation">"</span></span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100%<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100%<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">></span></span></code></pre><p><a href="/demos/svg-logo/logo.min.svg">After minification</a>, the logo weights 4,423 bytes, which is still smaller than the original logo (4,960 bytes).</p><h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>There are many ways we can optimize the delivery of SVGs. Even though they are highly compressible and usually small, there is usually room for delivering them better.</p><p>I hope this post has showed you some ways to optimize SVGs and some of its capabilities.</p>]]></content>
    
    <summary type="html">
    
      Some ways to reduce the payload of the Spotify logo on their website, which can be applied to other SVGs.
    
    </summary>
    
    
      <category term="svg" scheme="https://jmperezperez.com/tags/svg/"/>
    
  </entry>
  
  <entry>
    <title>PiterCSS 2018</title>
    <link href="https://jmperezperez.com/pitercss-2018/"/>
    <id>https://jmperezperez.com/pitercss-2018/</id>
    <published>2018-07-03T05:00:00.000Z</published>
    <updated>2019-03-19T08:12:57.819Z</updated>
    
    <content type="html"><![CDATA[<p>A few weeks ago I attended <a href="https://pitercss.com/" target="_blank" rel="noopener">PiterCSS</a>, the first international front-end conference in Saint Petersburg, Russia. There I gave a talk about creating a performance culture, based on the <a href="/fostering-web-performance-culture/">blog post I wrote recently</a>. You can find <a href="https://docs.google.com/presentation/u/1/d/1Ttow9QvHB9aTWcGcgmLzsVEaIyCQak0SJkxZ2fj_EFQ/edit?usp=sharing" target="_blank" rel="noopener">the slides online</a>.</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1529907011/speaking/pitercss-2018.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1529907011/speaking/pitercss-2018.jpg 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1529907011/speaking/pitercss-2018.jpg 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1529907011/speaking/pitercss-2018.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1529907011/speaking/pitercss-2018.jpg" alt="Speaking at PiterCSS about Forstering Web Performance Culture"></p><a id="more"></a><p>I could only attend the second day of the conference and I had a blast.</p><p>I met the amazing <a href="https://twitter.com/una" target="_blank" rel="noopener">Una Kravets</a>, whose job I have been following for a long time. I also met <a href="https://twitter.com/larsenwork" target="_blank" rel="noopener">Andreas Larsen</a>, who inspired me to <a href="/optimising-svgs/">optimize SVGs beyond using SVGOMG</a>. There was the great <a href="https://twitter.com/smashingmag" target="_blank" rel="noopener">Vitaly Friedman</a>, who I admire both for his work at Smashing Magazine and his focus to push web performance and user experience forward. Oh, and <a href="https://twitter.com/kornelski" target="_blank" rel="noopener">Kornel Lesi≈Ñski</a>, the creator of <a href="https://imageoptim.com/" target="_blank" rel="noopener">ImageOptim</a>, a tool I use on a daily basis which has made image optimization a non-brainer for everyone. And lots of very talented speakers who taught me about accessibility, animations, VR, typography‚Ä¶</p><p>The conference was held at a great venue. There was an extreme attention to small details, with lots of well designed posters, video intros, wall stickers, unique badges and even banners that the speakers could take back home. The best souvenir ever!</p><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">Love the attention to detail from the <a href="https://twitter.com/hashtag/pitercss?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#pitercss</a> crew that went into the conference badge <a href="https://twitter.com/hashtag/design?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#design</a> (I think it was automated based on talk titles) ‚Äì these are <a href="https://twitter.com/glyphe?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@glyphe</a>, <a href="https://twitter.com/szynszyliszys?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@szynszyliszys</a> and mine. <a href="https://t.co/trfkJNGyGd" target="_blank" rel="noopener">pic.twitter.com/trfkJNGyGd</a></p>&mdash; Andreas Larsen (@larsenwork) <a href="https://twitter.com/larsenwork/status/1005463754413363201?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">9 June 2018</a></blockquote><p><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">I love the banners the <a href="https://twitter.com/pitercss_conf?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@pitercss_conf</a> organizers hung up and we get to take them home after the conference üòç <a href="https://twitter.com/hashtag/pitercss?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#pitercss</a> <a href="https://t.co/FRsgOAGjod" target="_blank" rel="noopener">pic.twitter.com/FRsgOAGjod</a></p>&mdash; Lisi Linhart (@lisi_linhart) <a href="https://twitter.com/lisi_linhart/status/1005464974989451266?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">9 June 2018</a></blockquote></p><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><p>I would like to thank all the organizers for the great job they did and I hope they had a deserved relax time after the conference.</p><p>This was my second time at a conference in Russia and I enjoyed it a lot. I really like the single track format with only talks in English. I would definitely recommend it to anyone interested in getting up to speed with frontend development.</p>]]></content>
    
    <summary type="html">
    
      A short summary about this frontend conference hosted in Saint Petersburg, Russia. There I spoke about fostering a web performance culture.
    
    </summary>
    
    
      <category term="talks" scheme="https://jmperezperez.com/tags/talks/"/>
    
  </entry>
  
  <entry>
    <title>Fostering a Web Performance Culture</title>
    <link href="https://jmperezperez.com/fostering-web-performance-culture/"/>
    <id>https://jmperezperez.com/fostering-web-performance-culture/</id>
    <published>2018-06-02T14:00:00.000Z</published>
    <updated>2019-03-19T08:12:57.819Z</updated>
    
    <content type="html"><![CDATA[<p>Web Performance is not only about understanding what makes a site fast. It‚Äôs about creating awareness amongst both developers and non-developers. Performance is a feature and needs to be prioritized as such.</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1527949830/fostering-web-performance-culture/fostering-web-performance-culture.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1527949830/fostering-web-performance-culture/fostering-web-performance-culture.jpg 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1527949830/fostering-web-performance-culture/fostering-web-performance-culture.jpg 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1527949830/fostering-web-performance-culture/fostering-web-performance-culture.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1527949830/fostering-web-performance-culture/fostering-web-performance-culture.jpg" alt="Forstering Web Performance Culture"></p><a id="more"></a><p>Performance is a topic that has interested me for a long time. I remember when I learned about dynamic programming, greedy or divide and conquer algorithms. There was something gratifying in taking a code that takes minutes to run and make it run in a handful seconds.</p><p>Moving over to web, the performance problems are different. Usually, they are not related with computational complexity, but about serving what‚Äôs needed when needed in the best possible way. It might seem like a no-brainer, but it‚Äôs more difficult than it seems.</p><p><a href="https://stevesouders.com/" target="_blank" rel="noopener">Steve Souders</a> was one of the first in reverse-engineering how browsers requested and waited for resources. What resources are blocking? Which ones can be delayed? What about the response headers? He put together <a href="http://stevesouders.com/hpws/rules.php" target="_blank" rel="noopener">a list of 14 rules for faster-loading web sites</a>. If you have ever used YSlow, those are <a href="https://blog.keycdn.com/blog/wp-content/uploads/2016/03/yslow-score-test-results-e1457987091251.png" target="_blank" rel="noopener">the rules the tool was using to flag performance issues</a>.</p><p><img srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1527949830/fostering-web-performance-culture/steve-souders-rules.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1527949830/fostering-web-performance-culture/steve-souders-rules.jpg 800w,    https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1527949830/fostering-web-performance-culture/steve-souders-rules.jpg 1200w,    https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1527949830/fostering-web-performance-culture/steve-souders-rules.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1527949830/fostering-web-performance-culture/steve-souders-rules.jpg" sizes="(max-width: 768px) 100vw, 684px" style="border: 0" alt="Steve Souders‚Äô 14 Rules"> <small class="caption">Steve Souders‚Äô 14 Rules (<a href="https://blog.keycdn.com/blog/wp-content/uploads/2016/03/yslow-score-test-results-e1457987091251.png" target="_blank" rel="noopener">source</a>)</small></p><p>These days we have more and better tools to audit our performance. They can be run as a one-off or integrated in our development and deployment pipelines. Google‚Äôs <a href="https://developers.google.com/web/tools/lighthouse/" target="_blank" rel="noopener">Lighthouse</a> is one of them, which shows information about PWA, SEO and more.</p><p><img style="max-width:80%; border: 0; margin: 0 auto" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1527950062/fostering-web-performance-culture/lighthouse.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1527950062/fostering-web-performance-culture/lighthouse.jpg 800w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1527950062/fostering-web-performance-culture/lighthouse.jpg" alt="A screenshot of Lighthouse 3.0"> <small class="caption">A screenshot of Lighthouse 3.0, presented in Google IO 2018 (<a href="https://developers.google.com/web/updates/2018/05/lighthouse3" target="_blank" rel="noopener">source</a>)</small></p><p>These tools make it easier to determine where we need to put emphasis to improve our sites. At the same time, they open a door to lots of concepts that might be overwhelming: PRPL, RAIL, Paint Timing API, TTI, HTTP/2, Speed Index, Priority Hints <a href="https://docs.google.com/presentation/d/1UcjvtuMT4VAmc-MySWOcc1rLkMNoDjt2DxIhvfHNRXg/present?slide=id.g35f8c548da_0_202" target="_blank" rel="noopener">and more</a>‚Ä¶</p><h3 id="Why-Performance-doesn‚Äôt-get-Prioritized"><a href="#Why-Performance-doesn‚Äôt-get-Prioritized" class="headerlink" title="Why Performance doesn‚Äôt get Prioritized"></a>Why Performance doesn‚Äôt get Prioritized</h3><p>Web performance at organizations is a real challenge. We have better guides and tools than ever, yet very few companies get to spend time improving performance. You see, <strong>it‚Äôs not that we don‚Äôt know what causes long blank screens on our sites.</strong></p><blockquote><p>This is not a post explaining why web performance is important.</p></blockquote><p>There are plenty of other resources that do a way better job, with real numbers from real projects. <strong>This is a post about culture and how it determines what is a priority in our companies</strong>. Only by understanding that can we prioritize performance as another feature of our projects.</p><p>If you are reading this you are likely a developer who knows about web and cares about performance. You can represent your team and company if I ask you about where you work and what you do. But <strong>most likely you are not representative for the rest of web developers in your team and company</strong>, unless you are working on your own. And this is fine. The same way you can‚Äôt know everything about every discipline.</p><p>In your daily job you have lots of technical areas to care about. You will work hard on implementing features, collaborating with other teams (eg adding scripts for analytics, ads, retargeting, A/B test), setting up CI/CD, ensuring security, and making sure the project is usable and pleasant to the eye. And don‚Äôt forget about covering your back with tests.</p><p>You might never have time to look beyond that. Time is finite while your backlog is ever increasing. There needs to be some prioritization.</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1527949830/fostering-web-performance-culture/scrum-board.png 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1527949830/fostering-web-performance-culture/scrum-board.png 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1527949830/fostering-web-performance-culture/scrum-board.png 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1527949830/fostering-web-performance-culture/scrum-board.png 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1527949830/fostering-web-performance-culture/scrum-board.png" alt="A scrum board showing perfmatters at the bottom"></p><p><strong>The prioritization should be objective and based on measurable hypothesis.</strong> ‚ÄúWe think that by implementing feature X, user retention will grow Y%‚Äù. In practice this setup is more difficult. Let‚Äôs take a look at those topics we need to care about and think about who proposes them:</p><ul><li><p><strong>Implementing features</strong>: Normally a PO/PM determines what needs to be done next, according to a vision and mission for the team. The feature might come from stakeholders that have a dependency on us (eg adding a third-party script for <a href="https://simonhearne.github.io/weak-links" target="_blank" rel="noopener">tracking or A/B testing</a>)</p></li><li><p><strong>Setting up CI/CD</strong>: Although developers could come up with their own build and deployment pipelines, chances are that they are relying on some infrastructure provided by another team (eg an ‚Äúinfra‚Äù team)</p></li><li><p><strong>Security</strong>: Hopefully there‚Äôs a team or individual with deep knowledge about security that help us reviewing system designs, implementations, and informs us about reports or and security patches.</p></li><li><p><strong>UI/UX</strong>: There is usually a designer and/or UX person that sets the look &amp; feel and information architecture.</p></li><li><p><strong>Testing</strong>: Well, we should write some tests, right?</p></li></ul><p>When someone has the responsibility for a task to be done it will be more likely to be on the board. Most of them can be traced back to a certain role, but others like testing are something developers are supposed to do. Tests are up to the team, and so some parts will be better tested than others.</p><p>We agree that having automated tests is positive. Normally the team decides how well to cover and test the code, and it‚Äôs important that all developers in a team know how to write tests. Similar to testing, performance is usually left to the developers to figure out. I find that <strong>it is easier to write tests for a piece of code and knowing the implications of broken code in production, than understanding all the moving boxes that can lead to a bad web performance</strong>.</p><h2 id="6-steps-to-start-a-web-performance-culture"><a href="#6-steps-to-start-a-web-performance-culture" class="headerlink" title="6 steps to start a web performance culture"></a>6 steps to start a web performance culture</h2><p>We have the tools to measure performance, though working on it will be up to the team. How can we reach awareness, think of performance as a feature, and have the support of the company?</p><p>I have collected a list of 6 ideas that will take you closer to establish a web performance culture.</p><h3 id="1-Your-dev-environment-is-not-your-user‚Äôs-environment"><a href="#1-Your-dev-environment-is-not-your-user‚Äôs-environment" class="headerlink" title="1. Your dev environment is not your user‚Äôs environment"></a>1. Your dev environment is not your user‚Äôs environment</h3><p><img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto,c_scale/v1527950325/fostering-web-performance-culture/emile-perron-190221-unsplash.jpg" sizes="(max-width: 768px) 100vw, 684px" style="border: 0" alt="Light Work, a picture by √âmile Perron"> <small class="caption"><a href="https://unsplash.com/photos/xrVDYZRGdw4/info" target="_blank" rel="noopener">Light Work</a>, a picture by <a href="https://unsplash.com/@emilep" target="_blank" rel="noopener">√âmile Perron</a></small></p><p>I use a Macbook Pro to develop websites. I have an iPhone X as my phone, and my testing device. Also, the speed of my internet connection is humongous and I‚Äôm close to data centres located in Stockholm and London. When I finish my job for the day I take the subway, where I have an uninterrupted 4G connection. In fact, Stockholm was the <a href="https://www.ericsson.com/en/press-releases/2009/12/worlds-first-4glte-network-goes-live-today-in-stockholm" target="_blank" rel="noopener">first city in installing 4G back in 2009</a>.</p><p>Except for exceptionally few cases, the users of your product don‚Äôt have a similar environment. Not even close.</p><p><strong>How can we prioritize performance if we don‚Äôt perceive performance issues?</strong>It‚Äôs like making something accessible without trying to use keyboard navigation, screen readers nor color contrast checkers. There is no way.</p><p>And this is not about to change. Western web developers enjoy using the latest laptops and gadgets. And the chain goes up to pretty much any person responsible for prioritizing tasks and project are your company. Not only that, but in some cases we may prioritize top devices because those are the ones used by the users that are most likely to pay for our product. As <a href="http://www.brucelawson.co.uk/" target="_blank" rel="noopener">Bruce Lawson</a> put it, we should be building the ‚Äúworld-wide web, not the wealthy western web‚Äù.</p><div class="videoWrapper"><iframe src="https://player.vimeo.com/video/194968584?byline=0&portrait=0" width="684" height="385" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><p>Ask yourself if having more users, even though they are <em>less worth</em> economically, is better than having fewer potentially good ones.</p><p>An interesting ramification of not using user‚Äôs devices is that <strong>we make false assumptions</strong>. Let‚Äôs say we have decided to take a look at the usage stats and deprecate those platforms that have fewer users, or fewer usage (eg less page views per session), in a way to simplify the development and reduce entropy. <strong>There is no point in supporting an old browser that almost nobody uses</strong>. One could argue this is a metric-driven decision.</p><p>Well, not so fast. <strong>What if we are having fewer users or usage on a platform because is just less usable/enjoyable/performant?</strong> This is difficult to prove because developers will say that ‚Äúthe experience‚Äù is what they are seeing on their computers using, for example, Google Chrome. Without a bad intention we tend to prioritize the browser we use, and in that prioritization we often decide on trade-offs in favour of the modern environment. ‚ÄúWhy are users still using that browser, they should upgrade‚Äù I hear you yelling.</p><p>Recently I came across this quote, which I really liked:</p><blockquote><p>‚ÄúWhen I was at Google, someone told me a story about a time that ‚Äúthey‚Äù completed a big optimization push only to find that measured page load times increased. When they dug into the data, they found that the reason load times had increased was that they got a lot more traffic from Africa after doing the optimizations. The team‚Äôs product went from being unusable for people with slow connections to usable, which caused so many users with slow connections to start using the product that load times actually increased.‚Äù ‚Äî <a href="https://danluu.com/web-bloat/" target="_blank" rel="noopener">Dan Luu on ‚ÄúWeb Bloat‚Äù</a></p></blockquote><p>Again, it‚Äôs easy to fake performance optimization by leaving out the bad metrics, blocking users who spoil the stats. This is not real performance optimization, <strong>this is just playing with the numbers</strong>.</p><p><strong>Get yourself, and the people working on your project, an old device. Simulate bad network conditions and slow CPUs and make your project resilient. Figure out what devices users own and be careful prioritizing based on what devices users use on your site.</strong></p><h3 id="2-It‚Äôs-better-to-learn-the-fundamentals-than-the-library"><a href="#2-It‚Äôs-better-to-learn-the-fundamentals-than-the-library" class="headerlink" title="2. It‚Äôs better to learn the fundamentals than the library"></a>2. It‚Äôs better to learn the fundamentals than the library</h3><p>There are still lots of job descriptions and interview processes that focus on libraries and not the underlying technology. What happens when a browser tries to load a website? What are some reasons why a site can take too long to load? How would you architecture a non-trivial size web project (client, server, databases, caching layer)?</p><p>A developer that is aware of this will make better decisions when choosing what npm libraries to add to the project. They will provide a unique point of view when building features with designers and stakeholders. They will keep an eye on new and old browser APIs and will try to take advantage of the platform, rather than trying to isolate it.</p><p>Your team might need to hire someone familiar with React or Vue. You want them to be productive from day 1, and move the project forward. At the same time you want new hires to stay long at the company, encourage them to question the existing tech decisions and come up with better ones.</p><p>There are 2 constants I‚Äôve seen as a developer over and over again:</p><ol><li><p><strong>You need to challenge your own company, otherwise a competitor will do.</strong> Promote feedback from individual contributors and give them time to create innovative prototypes and POCs.</p></li><li><p><strong>The technical decisions you take today have a very short lifespan.</strong> Optimize for deletion, modularity and quick delivery.</p></li></ol><p>If you agree with the above you will benefit from ideas by people that aren‚Äôt sold to a specific technology, and can articulate pros and cons for different tech decisions.</p><p>Get involved in the interview process. Propose having time to learn about topics (lunch &amp; learn / brown bags) and hack on ideas that can benefit your projects, which leads us to the next point.</p><h3 id="3-Get-the-time-to-experiment-and-validate"><a href="#3-Get-the-time-to-experiment-and-validate" class="headerlink" title="3. Get the time to experiment and validate"></a>3. Get the time to experiment and validate</h3><p>I used to send links to my colleagues about the latest Google I/O talk or medium article talking about some new stuff. I found it useful to keep up to date and thought that I was keeping my mates updated too.</p><p><strong>Often, by blindly sharing content you are making them work harder.</strong> Not only do they have to do their job, but now they also have the peer pressure of reading what you shared. Chances are they better learn by putting it in practice, so now they have the added pressure of having to try out that new library/technique/idea.</p><p>Make them a favor and try to apply the novelty to a project at your company. Instead of thinking ‚ÄúThat new browser API sounds cool‚Äù, think ‚Äú<strong>This is how using X will improve our project</strong>‚Äù. Sure, it‚Äôs more difficult to achieve, but way more valuable. That‚Äôs how you can convince your boss.</p><p>There is a lot research on how performance optimization improves key metrics and sites like <a href="https://wpostats.com/" target="_blank" rel="noopener">WPO Stats</a> are a good source of case studies.</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1527951116/fostering-web-performance-culture/wpo-stats.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1527951116/fostering-web-performance-culture/wpo-stats.jpg 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1527951116/fostering-web-performance-culture/wpo-stats.jpg 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1527951116/fostering-web-performance-culture/wpo-stats.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1527951116/fostering-web-performance-culture/wpo-stats.jpg" alt="Lots of case studies where changes in performance led to key metric improvement."> <small class="caption">Lots of case studies where changes in performance led to key metric improvement.</small></p><p>As clear as it can be, sometimes we need more evidence than these case studies to prioritize performance at our companies.</p><p>You might be thinking you will never get the time to work on that POC. You are too busy working on tickets, either for fixing bugs or adding some new features.</p><p>In my mind, this is how features should be thought:</p><p><img style="border: 0; margin: 0 auto" sizes="(max-width: 468px) 100vw, 400px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1527951150/fostering-web-performance-culture/idea-validate-build.png 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1527951150/fostering-web-performance-culture/idea-validate-build.png 800w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1527951150/fostering-web-performance-culture/idea-validate-build.png" alt="Idea -> Validate -> Build"></p><p>The idea can come from a PO/PM, but <strong>also from a developer</strong>. It should be tested, proved that it works, through a prototype or an MVP. Only then it will be built. This also means that everything we build should have had some form of validation. <strong>We should be required to prove why making performant sites drives metrics, but the same applies to any other feature.</strong></p><p>If you had to pick something that you wanted to speed up, choose one that users can perceive. <strong>In order for users to barely see a difference in time duration, <a href="https://www.smashingmagazine.com/2015/09/why-performance-matters-the-perception-of-time/" target="_blank" rel="noopener">it has to be changed by a minimum of 20%</a>.</strong> Ideally, <a href="https://www.machmetrics.com/speed-blog/highlights-perfmatters-2018-web-performance-conference/" target="_blank" rel="noopener">shoot for 30% speed improvements</a>.</p><h3 id="4-Educate-your-Colleagues"><a href="#4-Educate-your-Colleagues" class="headerlink" title="4. Educate your Colleagues"></a>4. Educate your Colleagues</h3><p>Have you ever been in a situation where some piece of code was removed or replaced because nobody understood what it did? Most of us have been there. The author was the only one who could maintain it and make sense of it. What happens if that person goes on vacation, parental leave, gets sick, leaves the company‚Ä¶?</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1527951108/fostering-web-performance-culture/github-remove-code.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1527951108/fostering-web-performance-culture/github-remove-code.jpg 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1527951108/fostering-web-performance-culture/github-remove-code.jpg 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1527951108/fostering-web-performance-culture/github-remove-code.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1527951108/fostering-web-performance-culture/github-remove-code.jpg" alt="Taking advantage of John‚Äôs absence, let‚Äôs simplify this thing."> <small class="caption">Taking advantage of John‚Äôs absence, let‚Äôs simplify this thing.</small></p><p>Most of us work in a team and we need to put emphasis in choosing solutions that most colleagues understand. <strong>Find what the lowest common denominator is in the team, and avoid over-engineered solutions just because they are fun to build</strong>. When it comes to performance optimization, it is very easy to introduce a lot of complexity for the sake of small savings.</p><p>A few months ago <a href="https://medium.com/@jmperezperez/lazy-loading-images-on-the-web-to-improve-loading-time-and-saving-bandwidth-ec988b710290" target="_blank" rel="noopener">I wrote about image optimization and how to improve perceived performance</a>. It started with the obvious: avoid requests, choose the right format, optimize the images. However, most people only remember the creative use of the placeholders to have a smooth transition to the final image.</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1527953176/fostering-web-performance-culture/placeholder-options.png 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1527953176/fostering-web-performance-culture/placeholder-options.png 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1527953176/fostering-web-performance-culture/placeholder-options.png 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1527953176/fostering-web-performance-culture/placeholder-options.png 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1527953176/fostering-web-performance-culture/placeholder-options.png" alt="Different content that we can show in the placeholder before the image is loaded."> <small class="caption">Different content that we can show in the placeholder before the image is loaded.</small></p><p>Sure, that‚Äôs the most fun and innovative part! Now, go to your team and tell them you are going to create a backend service that will process images in a queue and store a tiny thumbnail that is served inline when rendering. When will that be run? How long does it take to run? Where do you store? How do you scale it through different servers?</p><p>The most savings are accomplished by not serving images and optimize the ones you serve. That‚Äôs the sweet spot. Aim for that.</p><p>Apart from choosing ‚Äúgood enough‚Äù solutions that most of your team understand, <strong>think about ways to raise the bar in your team</strong>. Are you an expert in a certain area? Arrange a presentation and show them. Get them excited.</p><p>If you are the only one pushing for an idea, it will die sooner than later.</p><h3 id="5-Share-and-celebrate-success-and-failure-stories"><a href="#5-Share-and-celebrate-success-and-failure-stories" class="headerlink" title="5. Share and celebrate success (and failure) stories"></a>5. Share and celebrate success (and failure) stories</h3><p>Changing the culture of a company starts with small battles, usually at a team level. Share the results of your experiments beyond your team.</p><p>Within the company, <strong>it will get colleagues inspired and it will spin off larger initiatives</strong>. It will be easier to get support for infrastructure or services if several teams have the same needs.</p><p>Externally, <strong>it‚Äôs a way to attract talent and show a compromise with clients and users</strong>.</p><p>I‚Äôm particularly fond of Etsy‚Äôs openness when it comes to web performance. Internally:</p><blockquote><p>‚ÄúThe performance team at Etsy maintains a dashboard celebrating people on other teams who contribute to performance improvements. we include their photo, a graph showing the performance improvement, and a brief description of their solution.‚Äù ‚Äî <a href="http://designingforperformance.com/changing-culture/" target="_blank" rel="noopener">Lara Hogan on ‚ÄúChanging Culture at Your Organization</a>‚Äù</p></blockquote><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 600px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1527953178/fostering-web-performance-culture/chris-fairbanks.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/f_auto/v1527953178/fostering-web-performance-culture/chris-fairbanks.jpg 600w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1527953178/fostering-web-performance-culture/chris-fairbanks.jpg" alt="Chris Fairbanks acknowledged for optimizing the mobile purchases page at Etsy"> <small class="caption">Chris Fairbanks acknowledged for optimizing the mobile purchases page at Etsy</small></p><p>And externally, <a href="https://www.slideshare.net/mikebrittain/web-performance-culture-and-tools-at-etsy" target="_blank" rel="noopener">they have been talking and posting for years</a> about their challenges and performance state.</p><p><img style="max-width:100%" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1527951166/fostering-web-performance-culture/etsy-performance-reports.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1527951166/fostering-web-performance-culture/etsy-performance-reports.jpg 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1527951166/fostering-web-performance-culture/etsy-performance-reports.jpg 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1527951166/fostering-web-performance-culture/etsy-performance-reports.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1527951166/fostering-web-performance-culture/etsy-performance-reports.jpg" alt="Site performance reports on Etsy's blog."> <small class="caption"><a href="https://codeascraft.com/category/performance/" target="_blank" rel="noopener">Site performance reports on Etsy‚Äôs blog</a>.</small></p><p>Before talking about performance improvements it is important to be open and clear about the current state and where we would like to take it. One of the best examples is <a href="https://www.voxmedia.com/a/go-deeper" target="_blank" rel="noopener">Vox Media</a>, the company behind <a href="https://www.theverge.com/" target="_blank" rel="noopener">The Verge</a> and other high trafficked sites. In May 2015, Vox Media wrote about the slowness of their site and commitment to make them faster.</p><blockquote><p>‚ÄúOur main priority was to <strong>ship first and iterate later</strong> and we often had to move on to the next big project before we had time to fully polish and optimize our latest release, leading us to accumulate a rather <strong>significant amount of performance debt</strong>.‚Äù ‚Äî Vox Media‚Äôs <a href="https://product.voxmedia.com/2015/5/6/8561867/declaring-performance-bankruptcy" target="_blank" rel="noopener">Declaring performance bankruptcy</a> <em>(emphasis mine)</em></p></blockquote><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1527953176/fostering-web-performance-culture/vox-media-speedcurve.png 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1527953176/fostering-web-performance-culture/vox-media-speedcurve.png 800w, https://res.cloudinary.com/jmperez/image/upload/f_auto/v1527953176/fostering-web-performance-culture/vox-media-speedcurve.png 941w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1527953176/fostering-web-performance-culture/vox-media-speedcurve.png" alt="SpeedCurve report for several news sites, including Vox Media‚Äôs The Verge"> <small class="caption">SpeedCurve report for several news sites, including Vox Media‚Äôs The Verge (<a href="https://product.voxmedia.com/2015/5/6/8561867/declaring-performance-bankruptcy" target="_blank" rel="noopener">source</a>).</small></p><p>Vox Media took some performance metrics (first paint, page complete and speed index) and decided on a target. Then, they committed to improve it and posted performance update posts regularly.</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1527953183/fostering-web-performance-culture/vox-media-performance-update.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1527953183/fostering-web-performance-culture/vox-media-performance-update.jpg 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1527953183/fostering-web-performance-culture/vox-media-performance-update.jpg 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1527953183/fostering-web-performance-culture/vox-media-performance-update.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1527953183/fostering-web-performance-culture/vox-media-performance-update.jpg" alt="One of Vox Media's posts where they gave an update on their efforts."> <small class="caption">One of Vox Media‚Äôs posts where they gave an update on their efforts.</small></p><p>In summary, don‚Äôt be afraid of recognizing that your product has a bad performance and be public about it. You will find people that want to help fixing it and it will show you are committed to improve it.</p><h3 id="6-Make-performance-part-of-your-workflow"><a href="#6-Make-performance-part-of-your-workflow" class="headerlink" title="6. Make performance part of your workflow"></a>6. Make performance part of your workflow</h3><p>It‚Äôs important that your performance checks are integrated in the regular workflow of your team, and are as automated as possible. This way you will be more likely to succeed when evangelizing about performance.</p><p>There are great tools to detect performance issues like <a href="http://webpagetest.org/" target="_blank" rel="noopener">WebPagetest</a>, <a href="https://developers.google.com/speed/pagespeed/insights/" target="_blank" rel="noopener">Pagespeed Insights</a> or the <a href="https://developers.google.com/web/tools/lighthouse/" target="_blank" rel="noopener">Audits on Chrome Dev Tools</a>. They are good for getting a quick report of your site‚Äôs performance.</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1527953183/fostering-web-performance-culture/webpagetest.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1527953183/fostering-web-performance-culture/webpagetest.jpg 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1527953183/fostering-web-performance-culture/webpagetest.jpg 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1527953183/fostering-web-performance-culture/webpagetest.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1527953183/fostering-web-performance-culture/webpagetest.jpg" alt="A screenshot of WebPagetest."> <small class="caption">WebPagetest is very useful for creating performance reports.</small></p><p>You will want to automate the reports to detect issues without having to rely on developers running these tools manually.</p><p>The MVP is to set a <a href="https://infrequently.org/2017/10/can-you-afford-it-real-world-web-performance-budgets/" target="_blank" rel="noopener">performance budget</a>, run performance audits on your production site on a daily basis, and be notified when those budgets aren‚Äôt met. This will help you catching issues and narrow down what deployments might have caused it, and you barely need to set it up.</p><p>If you want to go beyond, run the tests as part of your pull-request checks. That way you won‚Äôt merge nor deploy code that decreases the performance. This type of testing is called <a href="https://www.oreilly.com/ideas/web-performance-tools-synthetic-vs-rum" target="_blank" rel="noopener">syntethic</a>, since it‚Äôs performed automatically by a script with a predefined environment (device, network speed, location‚Ä¶).</p><p>A complement to synthetic tests are RUM tests. These are based on real users browsing your site. The idea is to collect some metrics like load time or <a href="https://medium.com/@jmperezperez/performanceobserver-and-paint-timing-api-72d3e5b384ea" target="_blank" rel="noopener">first-paint</a>, and post them to some service that you can use to visualize and compare them.</p><p>Although you can use something basic like Google Analytics with custom events, I recommend you to use tools tailor-made for this. Check <a href="https://calibreapp.com/" target="_blank" rel="noopener">Calibre</a>, <a href="https://speedcurve.com/" target="_blank" rel="noopener">SpeedCurve</a> or <a href="https://www.sitespeed.io/" target="_blank" rel="noopener">SiteSpeed</a>.</p><p><video controls style="display:block; margin: 0 auto" width="594" height="516"><source src="https://res.cloudinary.com/jmperez/video/upload/v1527954529/fostering-web-performance-culture/calibre.mp4" type="video/mp4"></video><small class="caption">Calibre‚Äôs integration with Slack. Whenever a budget is exceeded, Calibre will notify you.</small></p><p><strong>Performance monitoring should be effortless. You should only know about it when you need to act on it.</strong></p><p>In general, using these tools cost money in form of a subscription. Other open-source tools like SiteSpeed will require you to host it, so take into account the time to set it up. It‚Äôs essential that you think twice how you are going to propose adding these tools.</p><h2 id="A-concrete-example-to-wrap-up"><a href="#A-concrete-example-to-wrap-up" class="headerlink" title="A concrete example to wrap-up"></a>A concrete example to wrap-up</h2><p>A few months ago I proposed to use Calibre to monitor web performance. In the past I would have proposed it as another happy idea but this time I wanted it to succeed. This is what I did:</p><ul><li><p><strong>Try the product out for myself.</strong> Sign up for a trial, set up monitoring for our websites, use realistic conditions (locations, network speed) and start gathering data.</p></li><li><p><strong>Present it to the team.</strong> Once I was convinced about the product, I prepared presentation for my team exposing the problems we had and how a tool like this could improve the situation. I went through the tool and proposed using it for 3 months, taking a decision on whether to continue using it.</p></li><li><p><strong>Formalize it.</strong> I wrote a formal proposal so stakeholders could review. This included sections like ‚ÄúWhy use something at all‚Äù, ‚ÄúWhy use Calibre‚Äù, ‚ÄúAdvantages‚Äù, ‚ÄúDisadvantages‚Äù and ‚ÄúRoadmap‚Äù. Having a deadline to take a decision whether to use a paid product is appreciated by everyone.</p></li></ul><p>Why was the proposal valuable? It ticked all the 6 ideas that I have talked about in the article.</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1527949830/fostering-web-performance-culture/six-ideas.png 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1527949830/fostering-web-performance-culture/six-ideas.png 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1527949830/fostering-web-performance-culture/six-ideas.png 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1527949830/fostering-web-performance-culture/six-ideas.png 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1527949830/fostering-web-performance-culture/six-ideas.png" alt="Six ideas to set a performance culture."></p><ol><li><p>It tested the sites using several locations and constraints, as opposed to our ideal office conditions.</p></li><li><p>It was library/framework independent. You can choose whatever tool to build your website, in the end we care about a fast experience.</p></li><li><p>It was applied to our projects, what made the solution relevant, not just another link to a random article.</p></li><li><p>The team was informed, knew how to use the tool and collectively agreed to move this forward.</p></li><li><p>It helped visualize performance and see its evolution, which was useful to share results with the rest of web developers at the company. These tools force you to set thresholds for rejecting PRs or getting notified, which become your performance budget.</p></li><li><p>It was part of our workflow and could run effortless, not jeopardizing other tasks.</p></li></ol><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Thanks for reading! I hope I gave you some tips to help you in the quest of building more performant sites.</p>]]></content>
    
    <summary type="html">
    
      Some ideas to create awareness around performance optimization in a team and company.
    
    </summary>
    
    
      <category term="performance" scheme="https://jmperezperez.com/tags/performance/"/>
    
  </entry>
  
  <entry>
    <title>Increase the Performance of your Site with Lazy-Loading and Code-Splitting</title>
    <link href="https://jmperezperez.com/high-performance-lazy-loading/"/>
    <id>https://jmperezperez.com/high-performance-lazy-loading/</id>
    <published>2018-04-06T04:00:00.000Z</published>
    <updated>2019-05-10T21:18:30.900Z</updated>
    
    <content type="html"><![CDATA[<p>Componentization has marked a before and after in web development. The main advantages that are usually mentioned is reusability and modularization. Well defined pieces that we can use to build our sites, like bricks of Legos. It turns out this component structure provides a great foundation to improve the performance of our sites.</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1522995807/high-performance_mbjoct.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1522995807/high-performance_mbjoct.jpg 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1522995807/high-performance_mbjoct.jpg 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1522995807/high-performance_mbjoct.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1522995807/high-performance_mbjoct.jpg" alt></p><p>We are explicit about our dependencies, so we know what code we need to run to run a specific component. Lazy-loading and bundle splitting can have a huge impact on page performance: less code requested, parsed, and executed. And this not only applies to JavaScript, but every type of asset.</p><p>I see many sites that could take advantage of this, and I wanted to show how some basic techniques to load content as needed.</p><a id="more"></a><p>The article will be using Preact/React, yet the ideas can be applied to any other component library.</p><p>We are going to cover several topics:</p><ol><li><a href="#Compositional-Patterns">Compositional Patterns</a>: Overview of a couple of patterns that we can use to build complex components.</li><li><a href="#Improving-performance-of-our-sites-by-loading-only-what-is-needed">Improving performance of our sites by loading only what is needed</a>: A practical case where we will apply lazy-loading.</li><li><a href="#A-small-component-to-detect-when-an-area-is-visible">A small component to detect visibility</a>: A simple component that wraps the logic to notify when an element appears on screen.</li><li><a href="#More-use-cases">More use cases</a>: We will see that a component to detect visibility can also be useful in other situations.</li><li><a href="#Polyfilling-IntersectionObserver-on-demand">Polyfilling IntersectionObserver on-demand</a>: How we can include a polyfill only when needed.</li><li><a href="#Code-Splitting-and-CSS-in-JS">Code Splitting and CSS-in-JS</a>: How CSS-in-JS extends code-splitting and lazy-loading to CSS, SVGs and other resources.</li><li><a href="#Useful-implementations">Useful implementations</a>: Existing npm libraries that implement the pattern we have gone through.</li></ol><p>Let‚Äôs start!</p><h2 id="Compositional-Patterns"><a href="#Compositional-Patterns" class="headerlink" title="Compositional Patterns"></a>Compositional Patterns</h2><p>In a component world components aren‚Äôt only used for rendering actual pixels on the screen. They can also wrap functionality that is passed to children components.</p><p>This is usually achieved using <a href="https://reactjs.org/docs/higher-order-components.html" target="_blank" rel="noopener">High Order Components (HOC)</a>. These components receive another component and add some functionality, like a behavior.</p><p>If you have used redux, the <code>connect</code> function is a HOC that receives your not-connected component. You can find more examples on ‚Äú<a href="https://medium.com/@franleplant/react-higher-order-components-in-depth-cf9032ee6c3e" target="_blank" rel="noopener">React Higher Order Components in depth</a>‚Äú by Fran Guijarro.</p><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">const</span> MyComponent <span class="token operator">=</span> props <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>    <span class="token punctuation">{</span>props<span class="token punctuation">.</span>id<span class="token punctuation">}</span> <span class="token operator">-</span> <span class="token punctuation">{</span>props<span class="token punctuation">.</span>name<span class="token punctuation">}</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ...</span><span class="token keyword">const</span> ConnectedComponent <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>  mapStateToProps<span class="token punctuation">,</span>  mapDispatchToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>MyComponent<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Function as Child Component (also known as ‚Äú<a href="https://reactpatterns.com/#render-callback" target="_blank" rel="noopener">Render Callback</a>‚Äú) is another pattern used in similar scenarios. It is getting quite popular these days. You might have come across them in <a href="https://github.com/ReactTraining/react-media" target="_blank" rel="noopener">react-media</a> or <a href="https://github.com/jamiebuilds/unstated" target="_blank" rel="noopener">unstated</a>.</p><p>Look at this example taken from react-media:</p><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">const</span> MyComponent <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Media</span> <span class="token attr-name">query</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(max-width:</span> <span class="token attr-name">599px)"</span><span class="token punctuation">></span></span>    <span class="token punctuation">{</span>matches <span class="token operator">=</span><span class="token operator">></span>      matches <span class="token operator">?</span> <span class="token punctuation">(</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>The document is less than 600px wide<span class="token punctuation">.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>      <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>The document is at least 600px wide<span class="token punctuation">.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>      <span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Media</span><span class="token punctuation">></span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The <code>Media</code> component calls its children passing a <code>matches</code> argument. This way, the children components don‚Äôt need to know about the media query. Componentizing generally makes testing and maintenance easier.</p><h2 id="Improving-performance-of-our-sites-by-loading-only-what-is-needed"><a href="#Improving-performance-of-our-sites-by-loading-only-what-is-needed" class="headerlink" title="Improving performance of our sites by loading only what is needed"></a>Improving performance of our sites by loading only what is needed</h2><p>Imagine a typical web page. You can check <a href="https://css-tricks.com/website-sameness/" target="_blank" rel="noopener">Website Sameness</a> or <a href="https://www.friday.ie/journal/why-do-all-websites-look-the-same/" target="_blank" rel="noopener">Web Design Trends: Why Do All Websites Look The Same?</a> for some inspiration :) . The example page we are going to use contains several sections or blocks:</p><ul><li>a header (these days, a large hero image taking the whole above-the-fold area)</li><li>a section with a few images</li><li>another section with a heavy component like a map</li><li>a footer</li></ul><p style="max-width:300px;display:block;margin-left:auto;margin-right:auto"><img style="max-width:100%" sizes="300px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:300,f_auto/v1523084060/observer/site.png 300w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:600,f_auto/v1523084060/observer/site.png 600w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:900,f_auto/v1523084060/observer/site.png 900w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1523084060/observer/site.png 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:300,f_auto/v1523084060/observer/site.png" alt="A typical website"> <small class="caption">The basic structure of a page we will be using as example.</small></p><p>This, mapped into React components, would be something like this:</p><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">const</span> Page <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Header</span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Gallery</span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Map</span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Footer</span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>When the user visits the page, it is highly likely that they will see the header on screen. After all, it‚Äôs the top most component. It is less likely that they see the gallery, map and footer, unless they scroll.</p><p>Most times you would include all the scripts and CSS needed to render all sections as soon as the user visits the page. Until recently it was difficult to define a module‚Äôs dependencies, and load what was needed.</p><p>Years ago, pre-ES6, large companies came up with their own solutions to define dependencies and load them as needed. Yahoo built <a href="https://books.google.com/books?id=E7p-07kNfXYC&amp;pg=PA65&amp;lpg=PA65&amp;dq=yahoo+yui+loader&amp;source=bl&amp;ots=UOcpQHdaRp&amp;sig=AGTHNZvPYXWdU9lkj9klzTEa3ys&amp;hl=en&amp;sa=X&amp;ved=0ahUKEwjn26Wti8PZAhUJDSwKHQOsCbIQ6AEIVDAG#v=onepage&amp;q=yahoo%20yui%20loader&amp;f=false" target="_blank" rel="noopener">YUI Loader</a> and Facebook wrote <a href="/facebook-frontend-javascript/">Haste, Bootloader and Primer</a>.</p><p>When you send the user code that is not needed, you waste resources from your end, and from the user‚Äôs end. More bandwidth to transfer the data, more CPU to parse and execute them, and more memory to keep around. And those assets will steal the limited resources from other critical assets that need it more urgently.</p><p>What‚Äôs the point in requesting resources that the user will not need, like images that the user won‚Äôt reach? Or loading a 3rd party component like a Google Map, with all its additional assets needed to render the thing?</p><p>A code coverage report, like <a href="https://developers.google.com/web/updates/2017/04/devtools-release-notes#coverage" target="_blank" rel="noopener">the one Google Chrome provides</a> <strong>won‚Äôt help us much</strong>. The JS code will be executed and the CSS applied to elements that aren‚Äôt visible.</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1522995652/observer/chrome-coverage.png 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1522995652/observer/chrome-coverage.png 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1522995652/observer/chrome-coverage.png 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1522995652/observer/chrome-coverage.png 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1522995652/observer/chrome-coverage.png" alt="Code coverage tab on Google Chrome"></p><p><small class="caption">Code coverage tab on Google Chrome (<a href="https://developers.google.com/web/updates/2017/04/devtools-release-notes#coverage" target="_blank" rel="noopener">source</a>)</small></p><p>As with everything else, <strong>there are trade-offs with lazy-loading</strong>. We don‚Äôt want to apply lazy-loading to everything. Here are some points to take into account.</p><ul><li><strong>Don‚Äôt lazy load above the fold</strong>. In most cases we want the above-the-fold content to be rendered as soon as possible. Every lazy-loading technique will introduce a delay. The browser has to run the JS that injects the HTML to the document, parse it and start requesting the referenced assets.</li></ul><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1522995652/observer/fold.png 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1522995652/observer/fold.png 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1522995652/observer/fold.png 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1522995652/observer/fold.png 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1522995652/observer/fold.png" alt="Don't lazy load above the fold"></p><p>Where to set the fold? This is tricky, and it will depend on the user‚Äôs device, which varies greatly, and your layout.</p><ul><li><strong>Lazy load a bit earlier than when it‚Äôs needed</strong>. You want to avoid showing void areas to the user. For this, you can load an asset that is needed when it‚Äôs closed enough to the visible area. For instance, a user scrolls down and if the image to load is, let‚Äôs say, 100px below the bottom of the viewport, start requesting it.</li></ul><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1522995652/observer/preloading.png 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1522995652/observer/preloading.png 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1522995652/observer/preloading.png 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1522995652/observer/preloading.png 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1522995652/observer/preloading.png" alt="Lazy load a bit earlier than when it's needed"></p><ul><li><p></p><p><strong>Invisible content in some scenarios</strong>. You need to take into account that lazy-loaded content won‚Äôt be shown in some situations:</p><p></p><ul><li>If the lazy-loaded content hasn‚Äôt been loaded it won‚Äôt show up when printing the page.</li><li>The same can happen when the page is shown in RSS readers that might not execute the Javascript needed to load the content.</li><li>When it comes to SEO, you might have issues indexing lazy-loaded content on Google. At the time of writing this article, Googlebot supports IntersectionObserver and it invokes its callback with changes in the viewport above the fold. However, <strong>it won‚Äôt trigger the callback for content below the fold</strong>. Thus, <strong>that content won‚Äôt be seen nor indexed by Google</strong>. If you content is important you can, for instance, render the text and lazy-load components like images and other widgets (eg maps).</li></ul><p>Here I‚Äôm rendering <a href="https://jmperezperez.com/lazy-load/89b6f20e1d79e9fb902242ab84217b12.html">a test page</a> (you can see the source <a href="https://github.com/JMPerez/lazy-load/blob/master/text-above-fold.js" target="_blank" rel="noopener">here</a>) using Google Webmaster Tools‚Äô ‚ÄúFetch as Google‚Äù. Googlebot renders the content in the box shown within the viewport, but not the content below it.</p><p><div class="videoWrapper"><iframe width="1764" height="1080" src="https://www.youtube.com/embed/YEWaufLXX_Q" frameborder="0" allowfullscreen></iframe></div><small class="caption">Rendering <a href="https://jmperezperez.com/lazy-load/89b6f20e1d79e9fb902242ab84217b12.html">a test page</a> using Google Webmaster Tools‚Äô ‚ÄúFetch as Google‚Äù.</small></p></li></ul><div class="callout"><strong>Update May 10th 2019</strong>: Google announced during I/O 2019 that <a href="https://webmasters.googleblog.com/2019/05/the-new-evergreen-googlebot.html" target="_blank" rel="noopener">they will use an evergreen Googlebot</a>. This puts an end to using Chrome 41 to render pages and it adds support for IntersectionObserver. If you are using Google Search Console to test how Google renders one of your URLs, you will still get the Chrome 41 result. This is because <a href="https://youtu.be/Ey0N1Ry0BPM?t=381" target="_blank" rel="noopener">Google hasn‚Äôt updated their testing tools to use an evergreen Chrome</a>.</div><h2 id="A-small-component-to-detect-when-an-area-is-visible"><a href="#A-small-component-to-detect-when-an-area-is-visible" class="headerlink" title="A small component to detect when an area is visible"></a>A small component to detect when an area is visible</h2><p>I have talked in the past about <a href="/lazy-loading-images/">lazy-loading images</a>. This is just a type of asset that we can lazy-load, but we can apply the technique to other elements.</p><p>Let‚Äôs build a simple component that will detect when the section is visible in the viewport. For brevity I will use the <a href="https://developer.mozilla.org/docs/Web/API/Intersection_Observer_API" target="_blank" rel="noopener">Intersection Observer API</a>, an experimental technology with <a href="https://caniuse.com/#search=intersectionobserver" target="_blank" rel="noopener">quite good support</a>.</p><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> isVisible<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>io <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>container <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>io <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token punctuation">[</span>entry<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> isVisible<span class="token punctuation">:</span> entry<span class="token punctuation">.</span>isIntersecting <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>io<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>      <span class="token comment" spellcheck="true">// we create a div to get a reference.</span>      <span class="token comment" spellcheck="true">// It's possible to use findDOMNode() to avoid</span>      <span class="token comment" spellcheck="true">// creating extra elements, but findDOMNode is discouraged</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>        <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>div <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>container <span class="token operator">=</span> div<span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">}</span></span>      <span class="token punctuation">></span></span>        <span class="token punctuation">{</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">)</span>          <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>child <span class="token operator">=</span><span class="token operator">></span> <span class="token function">child</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>isVisible<span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>isVisible<span class="token punctuation">)</span><span class="token punctuation">}</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>The component uses IntersectionObserver to detect that the container intersects with the viewport, that is, it‚Äôs visible. We take advantage of React‚Äôs lifecycle methods to clean up the IntersectionObserver <a href="https://developer.mozilla.org/docs/Web/API/IntersectionObserver/disconnect" target="_blank" rel="noopener">disconnecting it</a> when unmounting.</p><p>This basic component could be extended with extra properties passed as <a href="https://developer.mozilla.org/docs/Web/API/Intersection_Observer_API#Intersection_observer_options" target="_blank" rel="noopener">options to IntersectionObserver</a> like margins or thresholds, so we can detect elements close to but not intersecting with the viewport. The options are set in the constructor, and they are read-only. Thus, adding support for options means that we would need to reinstantiate the IntersectionObserver with new options when they change, adding some extra logic in <code>componentWillReceiveProps</code> that we are not going to cover here.</p><p>Now, we can use this component to lazy load two of our components, <code>Gallery</code> and <code>Map</code>:</p><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">const</span> Page <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Header</span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Observer</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>isVisible <span class="token operator">=</span><span class="token operator">></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Gallery</span> <span class="token attr-name">isVisible</span> <span class="token punctuation">/></span></span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Observer</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Observer</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>isVisible <span class="token operator">=</span><span class="token operator">></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Map</span> <span class="token attr-name">isVisible</span> <span class="token punctuation">/></span></span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Observer</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Footer</span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>In the code above I‚Äôm just passing the <code>isVisible</code> property to the <code>Gallery</code> and <code>Map</code> components so they handle it. Alternatively we could return the component if visible, or an empty element otherwise.</p><p>In any case <strong>make sure that you reserve the area for the lazy-loaded component</strong>. You don‚Äôt want content to jump around, so if you know that your <code>Map</code> is 400px height, render a 400px height empty container before the map is rendered.</p><p>How do the <code>Map</code> and <code>Gallery</code> components use the <code>isVisible</code> property? Let‚Äôs take a look at the <code>Map</code>:</p><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Map</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> initialized<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>map <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">initializeMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> initialized<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// loadScript loads an external script, its definition is not included here.</span>    <span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token string">'https://maps.google.com/maps/api/js?key=&lt;your_key>'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token keyword">const</span> latlng <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">google<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>LatLng</span><span class="token punctuation">(</span><span class="token number">38.34</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.48</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">const</span> myOptions <span class="token operator">=</span> <span class="token punctuation">{</span> zoom<span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span> center<span class="token punctuation">:</span> latlng <span class="token punctuation">}</span><span class="token punctuation">;</span>      <span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">google<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">,</span> myOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>isVisible<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initializeMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token function">componentWillReceiveProps</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>initialized <span class="token operator">&amp;&amp;</span> nextProps<span class="token punctuation">.</span>isVisible<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initializeMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>        <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>div <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>map <span class="token operator">=</span> div<span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">}</span></span>      <span class="token punctuation">/></span></span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>When the container is displayed in the viewport we make a request to inject Google Map‚Äôs script, and once loaded we create the map. This is a good example of lazy-loading JavaScript that is not needed from the beginning, and the rest of resources needed to display the map.</p><p>The component has a state to avoid reinjecting the Google Map‚Äôs script.</p><p>Let‚Äôs have a look at the <code>Gallery</code> component:</p><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Gallery</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> hasBeenVisible<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>isVisible<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hasBeenVisible<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token function">componentWillReceiveProps</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasBeenVisible <span class="token operator">&amp;&amp;</span> nextProps<span class="token punctuation">.</span>isVisible<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hasBeenVisible<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Some pictures<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>        Picture <span class="token number">1</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasBeenVisible <span class="token operator">?</span> <span class="token punctuation">(</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://example.com/image01.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>300<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>300<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>placeholder<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token punctuation">)</span><span class="token punctuation">}</span>        Picture <span class="token number">2</span>        <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasBeenVisible <span class="token operator">?</span> <span class="token punctuation">(</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://example.com/image02.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>300<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>300<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>placeholder<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token punctuation">)</span><span class="token punctuation">}</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>The above example defines another stateful component. In fact, we are storing in the state the same information as we did with the <code>Map</code>.</p><p>If the Gallery is shown within the viewport, and afterwards it is outside the viewport, the images will remain in the DOM. In most cases this is what we want when working with images.</p><h3 id="Stateless-Child-Components"><a href="#Stateless-Child-Components" class="headerlink" title="Stateless Child Components"></a>Stateless Child Components</h3><p>A stateless component could also be interesting. It would allow us to unload images that are not visible anymore, showing back the placeholders:</p><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">const</span> Gallery <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> isVisible <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Some pictures<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>    Picture <span class="token number">1</span><span class="token punctuation">{</span>isVisible <span class="token operator">?</span> <span class="token punctuation">(</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://example.com/image01.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>300<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>300<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>placeholder<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token punctuation">)</span><span class="token punctuation">}</span>    Picture <span class="token number">2</span>    <span class="token punctuation">{</span>isVisible <span class="token operator">?</span> <span class="token punctuation">(</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://example.com/image02.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>300<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>300<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>placeholder<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token punctuation">)</span><span class="token punctuation">}</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>If you do this, <strong>make sure that the images have the right cache response headers</strong> so subsequent requests from the browser hit the cache and it doesn‚Äôt download the images again.</p><p>If you see yourself making your lazy-loaded components stateful only to track that they have been visible at least once, you can add this logic to the <code>Observer</code> component. After all, <code>Observer</code> is already stateful and it can easily call its children with an additional <code>hasBeenVisible</code> argument.</p><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">const</span> Page <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token operator">...</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Observer</span><span class="token punctuation">></span></span>    <span class="token punctuation">{</span><span class="token punctuation">(</span>isVisible<span class="token punctuation">,</span> hasBeenVisible<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Gallery</span> <span class="token attr-name">hasBeenVisible</span> <span class="token punctuation">/></span></span> <span class="token comment" spellcheck="true">// Gallery can be now stateless</span>    <span class="token punctuation">}</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Observer</span><span class="token punctuation">></span></span>  <span class="token operator">...</span><span class="token punctuation">}</span></code></pre><p>Another option is to have a variant of the <code>Observer</code> component that only passes a prop like <code>hasBeenVisible</code>. This has the advantage that we can disconnect the IntersectionObserver as soon as the element is in view, since we are not going to change its value. We will call this component <code>ObserverOnce</code>:</p><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">ObserverOnce</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> hasBeenVisible<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>io <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>container <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>io <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span>entries <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      entries<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>entry <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">.</span>isIntersecting<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hasBeenVisible<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>io<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>        <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>div <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>container <span class="token operator">=</span> div<span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">}</span></span>      <span class="token punctuation">></span></span>        <span class="token punctuation">{</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">)</span>          <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>child <span class="token operator">=</span><span class="token operator">></span> <span class="token function">child</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasBeenVisible<span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasBeenVisible<span class="token punctuation">)</span><span class="token punctuation">}</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="More-use-cases"><a href="#More-use-cases" class="headerlink" title="More use cases"></a>More use cases</h2><p>We have used the <code>Observer</code> component to load resources on-demand. We can also use it to start animating a component as soon as a user sees it.</p><p>Here is an example taken from the React Alicante website. It animates some conference numbers as soon as the user scrolls to that section.</p><div style="text-align:center"><video width="1064" height="618" controls src="https://res.cloudinary.com/jmperez/video/upload/dpr_auto,f_auto,q_auto/v1522995652/observer/react-alicante.mp4"></video></div><p>We could recreate it like this (see <a href="https://codepen.io/jmperez/pen/LQXjYv" target="_blank" rel="noopener">example on Codepen</a>):</p><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">ConferenceData</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> progress<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>interval <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>animationDuration <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>startAnimation <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">componentWillReceiveProps</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>      <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>isVisible <span class="token operator">&amp;&amp;</span>      nextProps<span class="token punctuation">.</span>isVisible <span class="token operator">&amp;&amp;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>progress <span class="token operator">!==</span> <span class="token number">1</span>    <span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>startAnimation <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">const</span> tick <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> progress <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>          <span class="token number">1</span><span class="token punctuation">,</span>          <span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>startAnimation<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animationDuration        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> progress<span class="token punctuation">:</span> progress <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>progress <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>tick<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>      <span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>        <span class="token punctuation">{</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>progress <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">}</span> days ¬∑        <span class="token punctuation">{</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>progress <span class="token operator">*</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">}</span> talks ¬∑        <span class="token punctuation">{</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>progress <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">}</span> workshops ¬∑        <span class="token punctuation">{</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>progress <span class="token operator">*</span> <span class="token number">350</span><span class="token punctuation">)</span><span class="token punctuation">}</span> attendees      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>Then, we would use it exactly as the rest of components. This shows the power of abstracting the visibility detection logic outside the components that need them.</p><h2 id="Polyfilling-IntersectionObserver-on-demand"><a href="#Polyfilling-IntersectionObserver-on-demand" class="headerlink" title="Polyfilling IntersectionObserver on-demand"></a>Polyfilling IntersectionObserver on-demand</h2><p>So far we have been using IntersectionObserver to detect when an element becomes visible. At the time of this writing some browsers (eg Safari) don‚Äôt have support for it, so the instantiation of IntersectionObserver will fail.</p><p>An option would be to set <code>isVisible</code> to <code>true</code> when IntersectionObserver is not available, which in practice would disable lazy-loading. In a way we would consider lazy-loading as a progressive enhancement:</p><pre class=" language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// isVisible is initialized to true if the browser</span>    <span class="token comment" spellcheck="true">// does not support IntersectionObserver API</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> isVisible<span class="token punctuation">:</span> <span class="token operator">!</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>IntersectionObserver<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>io <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>container <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// only initialize the IntersectionObserver if supported</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>IntersectionObserver<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>io <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span>entries <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token operator">...</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>Another option, which I prefer, is to include a polyfill like <a href="https://github.com/w3c/IntersectionObserver/tree/master/polyfill" target="_blank" rel="noopener">w3c‚Äôs IntersectionObserver polyfill</a>. This way IntersectionObserver will work in all browsers.</p><p>Following with the topic of loading resources on demand, and to lead by example, we will take advantage of code-splitting to only request the polyfill if needed. That way browsers supporting the API don‚Äôt need to fetch the polyfill:</p><pre class=" language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>  <span class="token operator">...</span>  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">(</span>window<span class="token punctuation">.</span>IntersectionObserver      <span class="token operator">?</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">:</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'intersection-observer'</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>io <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">window<span class="token punctuation">.</span>IntersectionObserver</span><span class="token punctuation">(</span>entries <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        entries<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>entry <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> isVisible<span class="token punctuation">:</span> entry<span class="token punctuation">.</span>isIntersecting <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token operator">...</span><span class="token punctuation">}</span></code></pre><p>You can see <a href="https://react-intersection-observer.stackblitz.io/" target="_blank" rel="noopener">a demo here</a> (check <a href="https://stackblitz.com/edit/react-intersection-observer" target="_blank" rel="noopener">the code source</a>). Safari will make an extra request to load the <code>intersection-observer</code> npm package, since it doesn‚Äôt support IntersectionObserver.</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1522995652/observer/safari-intersection-observer-2.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1522995652/observer/safari-intersection-observer-2.jpg 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1522995652/observer/safari-intersection-observer-2.jpg 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1522995652/observer/safari-intersection-observer-2.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1522995652/observer/safari-intersection-observer-2.jpg" alt="Screenshot of the network panel in Safari, displaying a request for the polyfill"></p><p><small class="caption">Safari requests the polyfill for intersection-observer on demand. No need to ship it to browsers that support it natively.</small></p><p>This is achieved thanks to code splitting. There are tools like <a href="https://parceljs.org/code_splitting.html" target="_blank" rel="noopener">Parcel</a> or <a href="https://webpack.js.org/guides/code-splitting/" target="_blank" rel="noopener">Webpack</a> that will create a bundle for that imported package, and the logic needed to request the file.</p><h2 id="Code-Splitting-and-CSS-in-JS"><a href="#Code-Splitting-and-CSS-in-JS" class="headerlink" title="Code Splitting and CSS-in-JS"></a>Code Splitting and CSS-in-JS</h2><p>So far we have seen how to use a HOC to detect that an element is within the viewport. We have also seen how to load extra JavaScript when needed.</p><p>Code-splitting is quite common and straightforward to implement at route level, so the browser loads additional bundles as the user navigates across different URLs on the site. Tools like <a href="https://github.com/ReactTraining/react-router" target="_blank" rel="noopener">react-router</a> and <a href="https://github.com/zeit/next.js/" target="_blank" rel="noopener">Next.js</a> have made this straightforward to implement.</p><p>Through the examples on this post we have seen that the same can be achieved within the same route, loading the code for components on-demand. This is very useful if we have components that need a lot of specific code, not only JavaScript.</p><p>A component could link to other resources or even inline them. Think of SVGs or CSS styles.</p><p>There is no point in requesting styles that aren‚Äôt going to be applied to any element. Dynamically requesting and injecting CSS causes a FOUC (Flash of Unstyled Content). The browser shows the HTML elements with the existing style, and once the additional styles are injected it re-styles the content. With the advent of CSS-in-JS (or JSS) solutions this is no longer a problem. CSS is inlined within the component, and we get true code splitting for our components. <strong>With CSS-in-JS we take code splitting further, loading CSS on demand.</strong></p><h2 id="Useful-implementations"><a href="#Useful-implementations" class="headerlink" title="Useful implementations"></a>Useful implementations</h2><p>In this post I have explained how to implement a basic Observer component. There are existing implementations of similar components that have been more battle-tested, support more options and extra ways to integrate in your project.</p><p>I definitely recommend you to check out these 2 libraries:</p><ul><li><a href="https://github.com/thebuilder/react-intersection-observer" target="_blank" rel="noopener">thebuilder/react-intersection-observer</a></li><li><a href="https://github.com/researchgate/react-intersection-observer" target="_blank" rel="noopener">researchgate/react-intersection-observer</a></li></ul><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Hopefully I have shown how componentization can make code-splitting and loading resources on demand easier than ever. Define what your code depends on and leverage bundlers and modern tools to request the dependencies as needed when the user navigates to new paths or new components are shown on the page.</p><hr><p>I would like to thank <a href="https://twitter.com/alexjoverm" target="_blank" rel="noopener">@alexjoverm</a>, <a href="https://twitter.com/aarongarciah" target="_blank" rel="noopener">@aarongarciah</a> and <a href="https://twitter.com/FlavioCorpa" target="_blank" rel="noopener">@FlavioCorpa</a> for reviewing the post, researching similar topics and recommending tools to provide the examples on the page.</p><p><em>This post is also available <a href="/es/high-performance-lazy-loading/">in Spanish</a></em></p><p>Did you see any typo or wrong information? In that case, <a href="https://twitter.com/jmperezperez" target="_blank" rel="noopener">drop me a line</a>.</p>]]></content>
    
    <summary type="html">
    
      Using a High Order Component to detect visibility and lazy-load components and sections on our pages. Just serve what is needed.
    
    </summary>
    
    
      <category term="performance" scheme="https://jmperezperez.com/tags/performance/"/>
    
      <category term="lazy-loading" scheme="https://jmperezperez.com/tags/lazy-loading/"/>
    
  </entry>
  
  <entry>
    <title>C√≥mo mejorar la performance de una web usando lazy-loading y code-splitting</title>
    <link href="https://jmperezperez.com/es/high-performance-lazy-loading/"/>
    <id>https://jmperezperez.com/es/high-performance-lazy-loading/</id>
    <published>2018-04-06T04:00:00.000Z</published>
    <updated>2019-05-10T21:19:39.428Z</updated>
    
    <content type="html"><![CDATA[<p>El desarrollo basado en componentes ha marcado un antes y un despu√©s en el desarrollo web. Las principales ventajas que suelen mencionarse son la reutilizaci√≥n y la modularizaci√≥n. Componentes bien definidos y encapsulados que podemos usar para construir nuestros sitios, como ladrillos de Legos. Una ventaja adicional es que esta estructura de componentes proporciona una base s√≥lida para mejorar la performance de nuestras webs.</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1522995807/high-performance_mbjoct.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1522995807/high-performance_mbjoct.jpg 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1522995807/high-performance_mbjoct.jpg 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1522995807/high-performance_mbjoct.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1522995807/high-performance_mbjoct.jpg" alt></p><p>Nuestras dependencias son expl√≠citas, por lo que sabemos qu√© c√≥digo necesitamos ejecutar para cargar un componente espec√≠fico. Lazy-loading y bundle-splitting pueden tener un gran impacto en el rendimiento de la p√°gina: requests con menos payload, c√≥digo parseado y ejecutado. Y esto no solo se aplica a JavaScript, sino a cualquier tipo de asset.</p><p>Creo que muchas webs pueden aprovecharse de estas t√©cnicas, y me gustar√≠a mostrar algunos ejemplos b√°sicos para solicitar recursos cuando sean necesarios.</p><a id="more"></a><p>En este post usaremos Preact/React, pero la idea se puede aplicar a cualquier otra librer√≠a basada en componentes.</p><p>Vamos a cubrir varios temas:</p><ol><li><a href="#Patrones-de-composicion">Patrones de composici√≥n</a>: Descripci√≥n general de dos patrones que podemos usar para construir componentes complejos.</li><li><a href="#Mejorando-el-rendimiento-de-nuestras-webs-cargando-solo-lo-necesario">Mejorando el rendimiento de nuestras webs cargando s√≥lo lo necesario</a>: Un caso pr√°ctico donde aplicaremos lazy-loading.</li><li><a href="#Un-pequeno-componente-para-detectar-cuando-una-area-es-visible">Un peque√±o componente para detectar visibilidad</a>: Un componente sencillo que contiene la l√≥gica para notificar cu√°ndo aparece un elemento en la pantalla.</li><li><a href="#Mas-casos-de-uso">M√°s casos de uso</a>: Veremos que un componente para detectar la visibilidad tambi√©n puede ser √∫til en otras situaciones.</li><li><a href="#Haciendo-polyfill-de-IntersectionObserver-bajo-demanda">Haciendo un polyfill de IntersectionObserver bajo demanda</a>: c√≥mo podemos incluir un polyfill solo cuando sea necesario.</li><li><a href="#Code-Splitting-y-CSS-in-JS">Code Splitting y CSS-in-JS</a>: c√≥mo CSS-in-JS nos permite extender el code-splitting y lazy-loading a CSS, SVGs y otros recursos.</li><li><a href="#Implementaciones-utiles">Implementaciones √∫tiles</a>: librer√≠as npm existentes que implementan el patr√≥n que hemos explicado.</li></ol><p>¬°Comencemos!</p><h2 id="Patrones-de-composicion"><a href="#Patrones-de-composicion" class="headerlink" title="Patrones de composici√≥n"></a>Patrones de composici√≥n</h2><p>En el desarrollo web basado en componentes √©stos no se usan s√≥lo para renderizar p√≠xeles en la pantalla. Tambi√©n pueden encapsular una funcionalidad o comportamiento que se pasa a los componentes hijo.</p><p>Para esto se suelen utilizar <a href="https://reactjs.org/docs/higher-order-components.html" target="_blank" rel="noopener">High Order Components (HOC)</a>. Estos componentes reciben otro componente y aumentan su funcionalidad.</p><p>Si has usado redux, la funci√≥n <code>connect</code> es un HOC que recibe otro componente. Puedes encontrar m√°s ejemplos en ‚Äú<a href="https://medium.com/@franleplant/react-higher-order-components-in-depth-cf9032ee6c3e" target="_blank" rel="noopener">React Higher Order Components in depth</a>‚Äú de Fran Guijarro.</p><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">const</span> MyComponent <span class="token operator">=</span> props <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>    <span class="token punctuation">{</span>props<span class="token punctuation">.</span>id<span class="token punctuation">}</span> <span class="token operator">-</span> <span class="token punctuation">{</span>props<span class="token punctuation">.</span>name<span class="token punctuation">}</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ...</span><span class="token keyword">const</span> ConnectedComponent <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>  mapStateToProps<span class="token punctuation">,</span>  mapDispatchToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>MyComponent<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Function as Child Component (tambi√©n llamado ‚Äú<a href="https://reactpatterns.com/#render-callback" target="_blank" rel="noopener">Render Callback</a>‚Äú) es otro patr√≥n que se usa en situaciones similares. Cada vez es m√°s popular, y puede que lo hayas visto en librer√≠as como <a href="https://github.com/ReactTraining/react-media" target="_blank" rel="noopener">react-media</a> o <a href="https://github.com/jamiebuilds/unstated" target="_blank" rel="noopener">unstated</a>.</p><p>Veamos este ejemplo tomado de react-media:</p><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">const</span> MyComponent <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Media</span> <span class="token attr-name">query</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(max-width:</span> <span class="token attr-name">599px)"</span><span class="token punctuation">></span></span>    <span class="token punctuation">{</span>matches <span class="token operator">=</span><span class="token operator">></span>      matches <span class="token operator">?</span> <span class="token punctuation">(</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>The document is less than 600px wide<span class="token punctuation">.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>      <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>The document is at least 600px wide<span class="token punctuation">.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>      <span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Media</span><span class="token punctuation">></span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>El componente <code>Media</code> llama a sus hijos pasando un argumento <code>matches</code>. De esta forma los componentes hijos no necesitan saber sobre la media query. La componentizaci√≥n suele hacer m√°s f√°cil el testeo y mantenimiento del c√≥digo.</p><h2 id="Mejorando-el-rendimiento-de-nuestras-webs-cargando-solo-lo-necesario"><a href="#Mejorando-el-rendimiento-de-nuestras-webs-cargando-solo-lo-necesario" class="headerlink" title="Mejorando el rendimiento de nuestras webs cargando s√≥lo lo necesario"></a>Mejorando el rendimiento de nuestras webs cargando s√≥lo lo necesario</h2><p>Imagina una p√°gina web t√≠pica. Puedes echar un ojo a <a href="https://css-tricks.com/website-sameness/" target="_blank" rel="noopener">Website Sameness</a> o <a href="https://www.friday.ie/journal/why-do-all-websites-look-the-same/" target="_blank" rel="noopener">Web Design Trends: Why Do All Websites Look The Same?</a> para m√°s inspiraci√≥n :) . La p√°gina de ejemplo que vamos a usar contiene varias secciones o bloques:</p><ul><li>una cabecera (estos d√≠as, una imagen grande o ‚Äúhero image‚Äù que ocupa toda el √°rea por encima del fold)</li><li>una secci√≥n con algunas im√°genes</li><li>otra secci√≥n con un componente pesado como un mapa</li><li>un footer</li></ul><p style="max-width:300px;display:block;margin-left:auto;margin-right:auto"><img style="max-width:100%" sizes="300px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:300,f_auto/v1523084060/observer/site.png 300w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:600,f_auto/v1523084060/observer/site.png 600w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:900,f_auto/v1523084060/observer/site.png 900w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1523084060/observer/site.png 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:300,f_auto/v1523084060/observer/site.png" alt="Una web t√≠pica"> <small class="caption">La estructura b√°sica de una p√°gina que estaremos usando como ejemplo.</small></p><p>Mapeado a componentes React ser√≠a algo como esto:</p><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">const</span> Page <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Header</span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Gallery</span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Map</span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Footer</span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>Cuando el usuario visita la p√°gina, es muy probable que vea la cabecera en la pantalla. Es menos probable que vea la galer√≠a, el mapa y el pie de p√°gina, a menos que haga scroll.</p><p>Seguramente sueles incluir todos los scripts y CSS necesarios para renderizar todas las secciones cuando el usuario carga la p√°gina. Hasta hace poco, era dif√≠cil definir las dependencias de un m√≥dulo y cargar s√≥lo lo que se necesitaba.</p><p>Hace a√±os, antes de ES6, algunas empresas con webs grandes crearon soluciones propias para definir dependencias y cargarlas bajo demanda. Yahoo cre√≥ <a href="https://books.google.com/books?id=E7p-07kNfXYC&amp;pg=PA65&amp;lpg=PA65&amp;dq=yahoo+yui+loader&amp;source=bl&amp;ots=UOcpQHdaRp&amp;sig=AGTHNZvPYXWdU9lkj9klzTEa3ys&amp;hl=en&amp;sa=X&amp;ved=0ahUKEwjn26Wti8PZAhUJDSwKHQOsCbIQ6AEIVDAG#v=onepage&amp;q=yahoo%20yui%20loader&amp;f=false" target="_blank" rel="noopener">YUI Loader</a> y Facebook hizo lo propio con <a href="/facebook-frontend-javascript/">Haste, Bootloader y Primer</a>.</p><p>Cuando env√≠as c√≥digo innecesario al usuario se desperdician tus recursos y los suyos. M√°s ancho de banda para transferir los datos, m√°s CPU para parsearlos y ejecutarlos, y m√°s memoria utilizada. Y esos assets robar√°n los recursos limitados de otros assets cr√≠ticos que lo necesitan con m√°s urgencia.</p><p>¬øDe qu√© sirve hacer peticiones innecesarias, como im√°genes que el usuario nunca ver√°? ¬øO cargar un componente de terceros como un mapa de Google, con todas sus peticiones adicionales necesarias para procesar?</p><p>Un informe de cobertura de c√≥digo, como <a href="https://developers.google.com/web/updates/2017/04/devtools-release-notes#coverage" target="_blank" rel="noopener">el que proporciona Google Chrome</a> <strong>no nos ser√° de mucha ayuda</strong>. El c√≥digo JS ser√° ejecutado y el CSS aplicado a elementos que no est√°n visibles.</p><img style="max-width:100%" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1522995652/observer/chrome-coverage.png 400w,        https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1522995652/observer/chrome-coverage.png 800w,        https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1522995652/observer/chrome-coverage.png 1200w,        https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1522995652/observer/chrome-coverage.png 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1522995652/observer/chrome-coverage.png" alt="La pesta√±a de Cobertura en Google Chrome"><p><small class="caption">Pesta√±a de cobertura de c√≥digo en Google Chrome (<a href="https://developers.google.com/web/updates/2017/04/devtools-release-notes#coverage" target="_blank" rel="noopener">fuente</a>)</small></p><p>Como en todo, <strong>hay pros y contras cuando se usa lazy-loading</strong>. No queremos aplicar lazy-loading a todos los elementos. Debemos tener en cuenta algunas cosas.</p><ul><li><strong>No usar lazy-loading por encima del fold</strong>. En la mayor√≠a de casos queremos que el contenido por encima del fold se renderice tan pronto como sea posible. Todas las t√©cnicas de lazy-loading introducen un retraso. El navegador tiene que ejecutar el JS que inyecta el HTML en el documento, parsearlo y comenzar a pedir los assets referenciados.</li></ul><img style="max-width:100%" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1522995652/observer/fold.png 400w,        https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1522995652/observer/fold.png 800w,        https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1522995652/observer/fold.png 1200w,        https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1522995652/observer/fold.png 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1522995652/observer/fold.png" alt="No hagas lazy-loading por encima del fold"><p>¬øC√≥mo sabemos d√≥nde queda el fold? La verdad es que es dif√≠cil y depende del dispositivo del usuario y de tu layout.</p><ul><li><strong>Si usas lazy-loading, carga los elementos un poco antes de cuando se necesitan</strong>. Es buena idea evitar mostrar √°reas vac√≠as en tu web. Para ello, puedes cargar un elemento cuando est√© lo suficientemente cerca del √°rea visible. Por ejemplo, cuando el usuario hace scroll hacia abajo y la imagen a cargar est√° 100px m√°s abajo, empieza a solicitarla.</li></ul><img style="max-width:100%" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1522995652/observer/preloading.png 400w,        https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1522995652/observer/preloading.png 800w,        https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1522995652/observer/preloading.png 1200w,        https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1522995652/observer/preloading.png 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1522995652/observer/preloading.png" alt="Comienza a cargar un poco antes de cuando se necesite"><ul><li><p></p><p><strong>Contenido invisible en algunos casos</strong>. Debes tener en cuenta que el contenido cargado usando lazy-loading no se mostrar√° en estas situaciones:</p><p></p><ul><li>Si el contenido cargado lazy-loading no se ha cargado no se mostrar√° al intentar imprimir la p√°gina.</li><li>Lo mismo ocurre cuando la p√°gina se muestra en lectores RSS que no ejecuten el JS necesario para cargar el contenido.</li><li>Puedes tener problemas con SEO al indexar contenido cargado con lazy-loading en Google. En el momento de escribir este art√≠culo, Googlebot soporta IntersectionObserver e invoca su callback con cambios en el viewport por encima del fold. Sin embargo, <strong>no invoca el callback para contenido por debajo del fold</strong>. Por lo tanto, <strong>ese contenido no ser√° visto ni indexado por Google</strong>. Si tu contenido es importante puedes renderizar el texto y dejar lazy-loading para componentes como im√°genes y otros widgets (por ejemplo mapas).</li></ul><p>Aqu√≠ estoy cargando <a href="https://jmperezperez.com/lazy-load/89b6f20e1d79e9fb902242ab84217b12.html">una p√°gina de test</a> (puedes ver el c√≥digo fuente <a href="https://github.com/JMPerez/lazy-load/blob/master/text-above-fold.js" target="_blank" rel="noopener">aqu√≠</a>) usando la funci√≥n ‚ÄúFetch as Google‚Äù de Google Webmaster Tools. Googlebot renderiza el contenido que queda dentro del viewport, pero no el que se cargar√≠a debajo.</p><p><div class="videoWrapper"><iframe width="1764" height="1080" src="https://www.youtube.com/embed/YEWaufLXX_Q" frameborder="0" allowfullscreen></iframe></div><small class="caption">Renderizando <a href="https://jmperezperez.com/lazy-load/89b6f20e1d79e9fb902242ab84217b12.html">una p√°gina de prueba</a> usando ‚ÄúFetch as Google‚Äù de Google Webmaster Tools.</small></p></li></ul><div class="callout"><strong>Actualizaci√≥n a 10 de mayo de 2019</strong>: Google anunci√≥ durante el I/O 2019 que <a href="https://webmasters.googleblog.com/2019/05/the-new-evergreen-googlebot.html" target="_blank" rel="noopener">actualizar√°n Googlebot para usar la √∫ltima versi√≥n de Chrome</a>. Esto acaba con el problema de que Googlebot use Chrome 41 para renderizar p√°ginas, y a√±ade soporte para IntersectionObserver. Si utilizas Google Search Console para comprobar c√≥mo Google renderiza una de tus URLs, todav√≠a recibir√°s el resultado de renderizar usando Chrome 41. Esto es porque <a href="https://youtu.be/Ey0N1Ry0BPM?t=381" target="_blank" rel="noopener">Google a√∫n no ha actualizado sus herramientas de testeo para utilizar un Chrome <em>evergreen</em>.</a></div><h2 id="Un-pequeno-componente-para-detectar-cuando-una-area-es-visible"><a href="#Un-pequeno-componente-para-detectar-cuando-una-area-es-visible" class="headerlink" title="Un peque√±o componente para detectar cuando una √°rea es visible"></a>Un peque√±o componente para detectar cuando una √°rea es visible</h2><p>En el pasado habl√© sobre <a href="/lazy-loading-images/">lazy-load de im√°genes</a>. La misma t√©cnica se puede aplicar a otros elemetos.</p><p>Vamos a escribir un componente sencillo que detectar√° cuando una secci√≥n es visible en el viewport. Para hacerlo m√°s breve usar√© la <a href="https://developer.mozilla.org/docs/Web/API/Intersection_Observer_API" target="_blank" rel="noopener">Intersection Observer API</a>, una tecnolog√≠a experimental con <a href="https://caniuse.com/#search=intersectionobserver" target="_blank" rel="noopener">bastante buen soporte</a>.</p><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> isVisible<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>io <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>container <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>io <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token punctuation">[</span>entry<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> isVisible<span class="token punctuation">:</span> entry<span class="token punctuation">.</span>isIntersecting <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>io<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>      <span class="token comment" spellcheck="true">// creamos un div para obtener una referencia.</span>      <span class="token comment" spellcheck="true">// Es posible usar findDOMNode() para evitar</span>      <span class="token comment" spellcheck="true">// crear elementos extras, pero findDOMNode est√° desaconsejado</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>        <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>div <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>container <span class="token operator">=</span> div<span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">}</span></span>      <span class="token punctuation">></span></span>        <span class="token punctuation">{</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">)</span>          <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>child <span class="token operator">=</span><span class="token operator">></span> <span class="token function">child</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>isVisible<span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>isVisible<span class="token punctuation">)</span><span class="token punctuation">}</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>El componente usa IntersectionObserver para detectar si el contenedor intersecta con el viewport, es decir, si est√° visible. Aprovechamos los m√©todos del lifecycle de React para limpiar el IntersectionObserver <a href="https://developer.mozilla.org/docs/Web/API/IntersectionObserver/disconnect" target="_blank" rel="noopener">desconect√°ndolo</a> al desmontar.</p><p>Este componente b√°sico puede extenderse con propiedades adicionales pasadas como <a href="https://developer.mozilla.org/docs/Web/API/Intersection_Observer_API#Intersection_observer_options" target="_blank" rel="noopener">opciones para el IntersectionObserver</a> como m√°rgenes o umbrales. As√≠, podr√≠amos detectar elementos cercanos pero que no intersectan con el viewport. Las opciones se establecen en el constructor y son de s√≥lo lectura. A√±adir soporte para opciones requerir√≠a reinstanciar el IntersectionObserver con nuevas opciones cuando cambien, a√±adiendo l√≥gica extra en <code>componentWillReceiveProps</code> que no vamos a cubrir aqu√≠.</p><p>Podemos usar este componente para hacer lazy-loading de dos de nuestros componentes, <code>Gallery</code> y <code>Map</code>:</p><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">const</span> Page <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Header</span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Observer</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>isVisible <span class="token operator">=</span><span class="token operator">></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Gallery</span> <span class="token attr-name">isVisible</span> <span class="token punctuation">/></span></span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Observer</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Observer</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>isVisible <span class="token operator">=</span><span class="token operator">></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Map</span> <span class="token attr-name">isVisible</span> <span class="token punctuation">/></span></span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Observer</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Footer</span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>En el c√≥digo anterior paso la propiedad <code>isVisible</code> a los componentes <code>Gallery</code> y <code>Map</code> para que ellos la gestionen. Otra forma de hacerlo es devolver el componente si est√° visible, o un elemento vac√≠o en caso contrario.</p><p>En cualquier caso <strong>aseg√∫rate de que reservas el √°rea para el componente</strong>. No es buena idea que el contenido ‚Äúsalte‚Äù cuando el componente se carga, as√≠ que si sabes que tu <code>Map</code> tiene un alto de 400px, renderiza un contenedor vac√≠o de 400px de altura antes de que el mapa se cargue.</p><p>¬øC√≥mo usan los componentes <code>Map</code> y <code>Gallery</code> la propiedad <code>isVisible</code>? Veamos el componente <code>Map</code>:</p><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Map</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> initialized<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>map <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">initializeMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> initialized<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// loadScript carga un script externo, su definici√≥n no se incluye aqu√≠.</span>    <span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token string">'https://maps.google.com/maps/api/js?key=&lt;your_key>'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token keyword">const</span> latlng <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">google<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>LatLng</span><span class="token punctuation">(</span><span class="token number">38.34</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.48</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">const</span> myOptions <span class="token operator">=</span> <span class="token punctuation">{</span> zoom<span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span> center<span class="token punctuation">:</span> latlng <span class="token punctuation">}</span><span class="token punctuation">;</span>      <span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">google<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">,</span> myOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>isVisible<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initializeMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token function">componentWillReceiveProps</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>initialized <span class="token operator">&amp;&amp;</span> nextProps<span class="token punctuation">.</span>isVisible<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initializeMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>        <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>div <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>map <span class="token operator">=</span> div<span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">}</span></span>      <span class="token punctuation">/></span></span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>Cuando se muestra el contenedor en el viewport, hacemos una petici√≥n para inyectar el script de Google Maps, y una vez cargado instanciamos el mapa. √âste es un buen ejemplo de c√≥digo JavaScript que no se necesita al principio y podemos cargar bajo demanda, y por consiguiente el resto de recursos necesarios para mostrar el mapa.</p><p>El componente tiene estado propio para evitar volver a inyectar el script de Google Maps.</p><p>Veamos el componente <code>Gallery</code>:</p><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Gallery</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> hasBeenVisible<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>isVisible<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hasBeenVisible<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token function">componentWillReceiveProps</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasBeenVisible <span class="token operator">&amp;&amp;</span> nextProps<span class="token punctuation">.</span>isVisible<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hasBeenVisible<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Some pictures<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>        Picture <span class="token number">1</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasBeenVisible <span class="token operator">?</span> <span class="token punctuation">(</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://example.com/image01.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>300<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>300<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>placeholder<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token punctuation">)</span><span class="token punctuation">}</span>        Picture <span class="token number">2</span>        <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasBeenVisible <span class="token operator">?</span> <span class="token punctuation">(</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://example.com/image02.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>300<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>300<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>placeholder<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token punctuation">)</span><span class="token punctuation">}</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>El ejemplo anterior define otro componente con estado. De hecho, estamos almacenando en el estado la misma informaci√≥n que almacena <code>Map</code>.</p><p>Si la galer√≠a se muestra dentro del viewport y m√°s tarde el usuario hace scroll y la galer√≠a deja de estar visible, las im√°genes permanecer√°n en el DOM. En la mayor√≠a de los casos, esto es lo que queremos cuando trabajamos con im√°genes.</p><h3 id="Componentes-hijo-sin-estado"><a href="#Componentes-hijo-sin-estado" class="headerlink" title="Componentes hijo sin estado"></a>Componentes hijo sin estado</h3><p>Un componente sin estado (stateless) tambi√©n resulta interesante. Nos permitir√≠a quitar de la memoria las im√°genes que ya no est√©n visibles, mostrando placeholders:</p><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">const</span> Gallery <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> isVisible <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Some pictures<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>    Picture <span class="token number">1</span><span class="token punctuation">{</span>isVisible <span class="token operator">?</span> <span class="token punctuation">(</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://example.com/image01.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>300<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>300<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>placeholder<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token punctuation">)</span><span class="token punctuation">}</span>    Picture <span class="token number">2</span>    <span class="token punctuation">{</span>isVisible <span class="token operator">?</span> <span class="token punctuation">(</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://example.com/image02.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>300<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>300<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>placeholder<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token punctuation">)</span><span class="token punctuation">}</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Si haces esto, <strong>aseg√∫rate de que las im√°genes tienen las cabeceras de respuesta adecuadas</strong> para que las peticiones subsecuentes usen la cach√© y no descarguen las im√°genes otra vez.</p><p>Puedes mover la l√≥gica al componente <code>Observer</code> si ves que creas componentes con estado s√≥lo para almacenar si se han mostrado al menos una vez. <code>Observer</code> ya tiene estado y puede llamar a sus hijos f√°cilmente con un argumento adicional <code>hasBeenVisible</code>.</p><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">const</span> Page <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token operator">...</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Observer</span><span class="token punctuation">></span></span>    <span class="token punctuation">{</span><span class="token punctuation">(</span>isVisible<span class="token punctuation">,</span> hasBeenVisible<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Gallery</span> <span class="token attr-name">hasBeenVisible</span> <span class="token punctuation">/></span></span> <span class="token comment" spellcheck="true">// Gallery ya no necesita estado</span>    <span class="token punctuation">}</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Observer</span><span class="token punctuation">></span></span>  <span class="token operator">...</span><span class="token punctuation">}</span></code></pre><p>Otra opci√≥n es tener una variaci√≥n del componente <code>Observer</code> que s√≥lo pase una prop como <code>hasBeenVisible</code>. Esto tiene la ventaja de que podemos desconectar el IntersectionObserver tan pronto como el elemento se muestre, ya que no vamos a cambiar su valor. Llamaremos a este componente <code>ObserverOnce</code>:</p><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">ObserverOnce</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> hasBeenVisible<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>io <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>container <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>io <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span>entries <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      entries<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>entry <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">.</span>isIntersecting<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hasBeenVisible<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>io<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>        <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>div <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>container <span class="token operator">=</span> div<span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">}</span></span>      <span class="token punctuation">></span></span>        <span class="token punctuation">{</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">)</span>          <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>child <span class="token operator">=</span><span class="token operator">></span> <span class="token function">child</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasBeenVisible<span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasBeenVisible<span class="token punctuation">)</span><span class="token punctuation">}</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="Mas-casos-de-uso"><a href="#Mas-casos-de-uso" class="headerlink" title="M√°s casos de uso"></a>M√°s casos de uso</h2><p>Hemos utilizado el componente <code>Observer</code> para cargar recursos bajo demanda. Tambi√©n lo podemos utilizar para comenzar la animaci√≥n de un componente cuando se muestre en pantalla.</p><p>En este ejemplo tomado de la web de React Alicante se animan unas cifras cuando el usuario hace scroll hasta esa secci√≥n.</p><div style="text-align:center"><video width="1064" height="618" controls src="https://res.cloudinary.com/jmperez/video/upload/dpr_auto,f_auto,q_auto/v1522995652/observer/react-alicante.mp4"></video></div><p>Podemos recrearlo con este c√≥digo (puedes verlo y editarlo <a href="https://codepen.io/jmperez/pen/LQXjYv" target="_blank" rel="noopener">en Codepen</a>):</p><pre class=" language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">ConferenceData</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> progress<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>interval <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>animationDuration <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>startAnimation <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">componentWillReceiveProps</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>      <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>isVisible <span class="token operator">&amp;&amp;</span>      nextProps<span class="token punctuation">.</span>isVisible <span class="token operator">&amp;&amp;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>progress <span class="token operator">!==</span> <span class="token number">1</span>    <span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>startAnimation <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">const</span> tick <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> progress <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>          <span class="token number">1</span><span class="token punctuation">,</span>          <span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>startAnimation<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animationDuration        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> progress<span class="token punctuation">:</span> progress <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>progress <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>tick<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>      <span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>        <span class="token punctuation">{</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>progress <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">}</span> days ¬∑        <span class="token punctuation">{</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>progress <span class="token operator">*</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">}</span> talks ¬∑        <span class="token punctuation">{</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>progress <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">}</span> workshops ¬∑        <span class="token punctuation">{</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>progress <span class="token operator">*</span> <span class="token number">350</span><span class="token punctuation">)</span><span class="token punctuation">}</span> attendees      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>Una vez definido podemos utilizarlo de la misma forma que el resto de componentes. Esta es una muestra del potencial de abstraer la l√≥gica para detectar la visibilidad fuera de los componentes que la necesitan.</p><h2 id="Haciendo-polyfill-de-IntersectionObserver-bajo-demanda"><a href="#Haciendo-polyfill-de-IntersectionObserver-bajo-demanda" class="headerlink" title="Haciendo polyfill de IntersectionObserver bajo demanda"></a>Haciendo polyfill de IntersectionObserver bajo demanda</h2><p>Hasta ahora hemos utilizado IntersectionObserver para detectar cu√°ndo un elemento se muestra en pantalla. En el momento de escribir este art√≠culo algunos navegadores, como Safari, no soportan IntersecionObserver. Si lo intentamos instanciar el navegador lanzar√° un error.</p><p>Podr√≠amos establecer <code>isVisible</code> a <code>true</code> cuando IntersectionObserver no est√© disponible, lo que en la pr√°ctica desactivar√≠a el lazy-loading. En cierta manera considerar√≠amos lazy-loading como un progressive enhancement:</p><pre class=" language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// isVisible se inicializa a true si el</span>    <span class="token comment" spellcheck="true">// navegador no soporta IntersectionObserver</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> isVisible<span class="token punctuation">:</span> <span class="token operator">!</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>IntersectionObserver<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>io <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>container <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// s√≥lo inicializamos IntersectionObserver si est√° soportado</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>IntersectionObserver<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>io <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span>entries <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token operator">...</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>Mi opci√≥n favorita es incluir un polyfill como el <a href="https://github.com/w3c/IntersectionObserver/tree/master/polyfill" target="_blank" rel="noopener">polyfill para IntersectionObserver de w3c</a>. As√≠, IntersectionObserver funciona en todos los navegadores.</p><p>Como estamos hablando de cargar assets bajo demanda, qu√© mejor que aplicarlo a este caso. Usaremos code-splitting para hacer la petici√≥n del polyfill s√≥lo si nos hace falta, es decir, si el navegador no tiene soporte para IntersectionObserver:</p><pre class=" language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>  <span class="token operator">...</span>  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">(</span>window<span class="token punctuation">.</span>IntersectionObserver      <span class="token operator">?</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">:</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'intersection-observer'</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>io <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">window<span class="token punctuation">.</span>IntersectionObserver</span><span class="token punctuation">(</span>entries <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        entries<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>entry <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> isVisible<span class="token punctuation">:</span> entry<span class="token punctuation">.</span>isIntersecting <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token operator">...</span><span class="token punctuation">}</span></code></pre><p>Puedes ver <a href="https://react-intersection-observer.stackblitz.io/" target="_blank" rel="noopener">una demostraci√≥n aqu√≠</a> (<a href="https://stackblitz.com/edit/react-intersection-observer" target="_blank" rel="noopener">c√≥digo fuente</a>). Safari har√° una petici√≥n extra para cargar el paquete npm <code>intersection-observer</code> dado que no soporta IntersectionObserver.</p><img style="max-width:100%" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1522995652/observer/safari-intersection-observer-2.jpg 400w,        https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1522995652/observer/safari-intersection-observer-2.jpg 800w,        https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1522995652/observer/safari-intersection-observer-2.jpg 1200w,        https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1522995652/observer/safari-intersection-observer-2.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1522995652/observer/safari-intersection-observer-2.jpg" alt="Captura de pantalla del panel de Red en Safari, mostrando la petici√≥n para el polyfill"><p><small class="caption">Safari hace una request para el polyfill de intersection-observer bajo demanda. No necesitamos cargarlo en navegadores que lo soportan nativamente.</small></p><p>La soluci√≥n se basa en code splitting. Hay herramientas como <a href="https://parceljs.org/code_splitting.html" target="_blank" rel="noopener">Parcel</a> o <a href="https://webpack.js.org/guides/code-splitting/" target="_blank" rel="noopener">Webpack</a> que crear√°n un bundle para ese paquete importado, as√≠ como la l√≥gica para hacer la petici√≥n para ese fichero.</p><h2 id="Code-Splitting-y-CSS-in-JS"><a href="#Code-Splitting-y-CSS-in-JS" class="headerlink" title="Code Splitting y CSS-in-JS"></a>Code Splitting y CSS-in-JS</h2><p>Hasta ahora hemos visto c√≥mo usar un HOC para detectar que un elemento est√° en el viewport. Tambi√©n hemos aprendido c√≥mo cargar JavaScript adicional cuando hace falta.</p><p>Code-splitting es bastante com√∫n y f√°cil de implementar a nivel de ruta. El navegador carga bundles adicionales cuando el usuario va navegando a trav√©s de diferentes URLs de la web. Herramientas como <a href="https://github.com/ReactTraining/react-router" target="_blank" rel="noopener">react-router</a> y <a href="https://github.com/zeit/next.js/" target="_blank" rel="noopener">Next.js</a> han popularizado code-splitting, integr√°ndolo como parte de dynamic imports.</p><p>A trav√©s de varios ejemplos hemos visto que se puede implementar code-splitting dentro de una misma ruta, cargando el c√≥digo para los componentes bajo demanda. Esto es muy √∫til si tenemos componentes que necesitan mucho c√≥digo espec√≠fico, no s√≥lo JavaScript.</p><p>Un componente puede referenciar otros recursos o incluso contenerlos ‚Äúinline‚Äù. Un ejemplo son SVGs o estilos CSS.</p><p>No tiene sentido solicitar estilos que no se van a aplicar a ning√∫n elemento. Solicitar estilos e inyectarlos din√°micamente causa un FOUC (Flash of Unstyled Content). El navegador muestra los elementos HTML con el estilo existente, y una vez que los estilos adicionales son inyectados re-estila el contenido. Con la aparici√≥n de soluciones CSS-in-KS (o JSS) esto ya no es un problema. El CSS se incluye inline en el componente, y conseguimos code-splitting verdadero para nuestros componentes. <strong>Con CSS-in-JS llevamos code-splitting m√°s all√°, cargando CSS bajo demanda.</strong></p><h2 id="Implementaciones-utiles"><a href="#Implementaciones-utiles" class="headerlink" title="Implementaciones √∫tiles"></a>Implementaciones √∫tiles</h2><p>En este post he explicado c√≥mo implementar un componente Observer b√°sico. Existing implementaciones de componentes similares que han sido probadas en muchas aplicaciones y soportan m√°s opciones y formas de integrarse en tu proyecto.</p><p>Recomiendo echar un vistazo a estas dos librer√≠as:</p><ul><li><a href="https://github.com/thebuilder/react-intersection-observer" target="_blank" rel="noopener">thebuilder/react-intersection-observer</a></li><li><a href="https://github.com/researchgate/react-intersection-observer" target="_blank" rel="noopener">researchgate/react-intersection-observer</a></li></ul><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusi√≥n"></a>Conclusi√≥n</h2><p>La componentizaci√≥n hace el code-splitting y la carga de recursos bajo demanda m√°s f√°cil que nunca. Define las dependencias de tu c√≥digo y usa los bundlers y otras herramientas modernas para hacer peticiones para las dependencias cuando el usuario navegue a nuevas rutas o se muestren nuevos componentes en la p√°gina.</p><hr><p>Me gustar√≠a dar las gracias a <a href="https://twitter.com/alexjoverm" target="_blank" rel="noopener">@alexjoverm</a>, <a href="https://twitter.com/aarongarciah" target="_blank" rel="noopener">@aarongarciah</a> y <a href="https://twitter.com/FlavioCorpa" target="_blank" rel="noopener">@FlavioCorpa</a> por revisar este art√≠culo, investigar lazy-loading desde varios puntos de vista, y recomendar herramientas para crear los ejemplos.</p><p>Si encuentras alguna errata o informaci√≥n err√≥nea, <a href="https://twitter.com/jmperezperez" target="_blank" rel="noopener">no dudes en escribirme</a>.</p>]]></content>
    
    <summary type="html">
    
      C√≥mo usar un High Order Component para detectar cu√°ndo un elemento est√° visible y hacer lazy-loading de componentes y secciones de nuestras p√°ginas. Manda al navegador s√≥lo lo que es necesario.
    
    </summary>
    
    
      <category term="performance" scheme="https://jmperezperez.com/tags/performance/"/>
    
      <category term="lazy-loading" scheme="https://jmperezperez.com/tags/lazy-loading/"/>
    
  </entry>
  
  <entry>
    <title>Displaying Page Load Metrics on Your Site</title>
    <link href="https://jmperezperez.com/page-load-footer/"/>
    <id>https://jmperezperez.com/page-load-footer/</id>
    <published>2018-03-30T05:00:00.000Z</published>
    <updated>2019-03-19T08:12:57.818Z</updated>
    
    <content type="html"><![CDATA[<p>I was browsing <a href="https://timkadlec.com" target="_blank" rel="noopener">Tim Kadlec‚Äôs website</a> and I noticed he had added page load time metrics in the footer.</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1522388675/load-time/tim-kadlec-load-time.png 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1522388675/load-time/tim-kadlec-load-time.png 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1522388675/load-time/tim-kadlec-load-time.png 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1522388675/load-time/tim-kadlec-load-time.png 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1522388675/load-time/tim-kadlec-load-time.png" alt="Tim Kadlec's site shows how long the page took to load in the footer"> <small class="caption">Tim Kadlec‚Äôs site shows how long the page took to load in the footer.</small></p><p>Stoyan Stefanov also realized and wrote <a href="http://www.phpied.com/this-page-loaded-in-x-seconds/" target="_blank" rel="noopener">‚ÄúThis page loaded in X seconds‚Äù</a>, a blog post describing the code used for this. Stoyan also created a bookmark that shows an alert with the load time of the current page. The data is obtained from <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/performance" target="_blank" rel="noopener"><code>window.performance</code></a>.</p><p>I liked the idea and added a similar snippet that shows the page load time in the footer (you should see it if you scroll to the bottom). If your browser supports the <a href="https://css-tricks.com/paint-timing-api/" target="_blank" rel="noopener">Paint Timing API</a> you will see a couple of extra metrics: First Paint and First Contentful Paint.</p><a id="more"></a><h2 id="First-Paint-and-First-Contentful-Paint"><a href="#First-Paint-and-First-Contentful-Paint" class="headerlink" title="First Paint and First Contentful Paint"></a>First Paint and First Contentful Paint</h2><p>Page load time is a metric that tells us part of the story. Yet it might not reflect how fast the visible area loads. For instance, a page with lots of images will report a large page load time, since the <code>load</code> event will be triggered when all of them are fetched, even though the above-the-fold content might load way earlier. It is still a good idea, since it forces us to think about lazy-loading the resources when needed.</p><p>I have written before about <a href="https://www.smashingmagazine.com/2018/02/progressive-image-loading-user-perceived-performance/" target="_blank" rel="noopener">user perceived performance</a> and metrics that tell how long it takes to render something on the page. Using the <a href="/paint-timing-api/">Paint Timing API</a> we can get the <a href="https://w3c.github.io/paint-timing/#sec-terminology" target="_blank" rel="noopener">First Paint and First Contentful Paint metrics</a>.</p><p>My code snippet extends Tim‚Äôs and Stoyan‚Äôs to report these metrics, obtained running <code>performance.getEntriesByType(&#39;paint&#39;)</code>:</p><pre class=" language-js"><code class="language-js">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> t <span class="token operator">=</span> window<span class="token punctuation">.</span>performance <span class="token operator">&amp;&amp;</span> performance<span class="token punctuation">.</span>timing<span class="token punctuation">;</span>    <span class="token keyword">const</span> round2 <span class="token operator">=</span> num <span class="token operator">=</span><span class="token operator">></span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>num <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">const</span> timingStats <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.timing-stats'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">const</span> loadTime <span class="token operator">=</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>loadEventEnd <span class="token operator">-</span> t<span class="token punctuation">.</span>navigationStart<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span>      <span class="token keyword">let</span> timingStatsHTML <span class="token operator">=</span> <span class="token template-string"><span class="token string">`This page loaded in </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">round2</span><span class="token punctuation">(</span>loadTime<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> seconds. `</span></span><span class="token punctuation">;</span>      <span class="token keyword">const</span> perfEntries <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">getEntriesByType</span><span class="token punctuation">(</span><span class="token string">'paint'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      perfEntries<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>perfEntry<span class="token punctuation">,</span> i<span class="token punctuation">,</span> entries<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        timingStatsHTML <span class="token operator">+</span><span class="token operator">=</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>perfEntry<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> was </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">round2</span><span class="token punctuation">(</span>          perfEntry<span class="token punctuation">.</span>startTime <span class="token operator">/</span> <span class="token number">1000</span>        <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> seconds. `</span></span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      timingStats<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> timingStatsHTML<span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>In the future I would like to extend the reported metrics to include <a href="https://developers.google.com/web/tools/lighthouse/audits/first-meaningful-paint" target="_blank" rel="noopener">First Meaningful Paint</a> (whenever it is implemented, see <a href="https://docs.google.com/document/d/1BR94tJdZLsin5poeet0XoTW60M0SjvOJQttKT-JK8HI/view" target="_blank" rel="noopener">a description of the heuristics here</a>) and <a href="https://developers.google.com/web/tools/lighthouse/audits/first-interactive" target="_blank" rel="noopener">Time to Interactive</a> (using <a href="https://github.com/GoogleChromeLabs/tti-polyfill" target="_blank" rel="noopener">GoogleChromeLabs/tti-polyfill</a>).</p><p><img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto,c_scale/v1522388641/load-time/performance-metrics.jpg" sizes="(max-width: 768px) 100vw, 684px"> <small class="caption">Slide from <a href="https://www.youtube.com/watch?v=6Ljq-Jn-EgU" target="_blank" rel="noopener">Web Performance: Leveraging the Metrics that Most Affect User Experience from Google I/O ‚Äò17</a> showing different key moments during a page load.</small></p><p><a href="https://twitter.com/Zizzamia" target="_blank" rel="noopener">Leonardo Zizzamia</a> has been working on <a href="http://zizzamia.github.io/perfume/" target="_blank" rel="noopener">Perfume.js</a>, a library to measure these metrics, annotate them to the dev tools timeline and optionally reporting them to Google Analytics. It also has a fallback for browsers that do not support the Paint Timing API.</p><p>You can read more about the library on his posts ‚Äú<a href="https://medium.com/@zizzamia/first-contentful-paint-with-a-touch-of-perfume-js-cd11dfd2e18f" target="_blank" rel="noopener">First (Contentful) Paint with a touch of Perfume(.js)</a> and ‚Äú<a href="https://medium.com/@zizzamia/time-to-interactive-with-rum-862ba874392c" target="_blank" rel="noopener">Time to Interactive with RUM</a>‚Äú.</p><p>If you are into this topic, I also recommend you to watch the talk <a href="https://www.youtube.com/watch?v=6Ljq-Jn-EgU" target="_blank" rel="noopener">Web Performance: Leveraging the Metrics that Most Affect User Experience from Google I/O ‚Äò17</a>.</p><h2 id="How-to-Calculate-the-Transfer-Size"><a href="#How-to-Calculate-the-Transfer-Size" class="headerlink" title="How to Calculate the Transfer Size"></a>How to Calculate the Transfer Size</h2><p>The Resource Timing API allows to <a href="https://developer.mozilla.org/docs/Web/API/Resource_Timing_API/Using_the_Resource_Timing_API#Size_matters" target="_blank" rel="noopener">know the transfer size of the assets fetched by the page</a>. For CORS requests is necessary to <a href="https://developer.mozilla.org/docs/Web/API/Resource_Timing_API/Using_the_Resource_Timing_API#Coping_with_CORS" target="_blank" rel="noopener">include the <code>timing-allow-origin</code> header</a> set up properly to return the transfer size. Otherwise they will report 0 as the transfer size.</p><p>Another caveat is that there doesn‚Äôt seem to be a way to know the transfer size of the page itself. One could calculate the length of the document‚Äôs innerHTML, but that won‚Äôt match the transfer size if the response was compressed (which hopefully was).</p><p>Let‚Äôs have a look at an example:</p><p><img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto,c_scale,dpr_auto/v1522831856/load-time/resource-timing-api-page-size.jpg" sizes="(max-width: 768px) 100vw, 684px" alt="Calculating the transferred size of the requests using Resource Timing API."> <small class="caption">Calculating the transferred size of the request susing Resource Timing API.</small></p><p>The page that I‚Äôm loading, served from jmperezperez.com, makes requests to fetch assets from res.cloudinary.com and <a href="http://www.google-analytics.com" target="_blank" rel="noopener">www.google-analytics.com</a>, which are external domains. Once loaded, I run this code to calculate the transferred size:</p><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> totalBytes <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">getEntriesByType</span><span class="token punctuation">(</span><span class="token string">'resource'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> a <span class="token operator">+</span> r<span class="token punctuation">.</span>transferSize<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Page size is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>totalBytes <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> kB`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The reported transferred size according to the dev tools is 113 kB, while the calculated using the code above (Resource Timing API) is 107 kB. Both res.cloudinary.com and <a href="http://www.google-analytics.com" target="_blank" rel="noopener">www.google-analytics.com</a> set the <code>timing-allow-origin: *</code> response header, which let us get the right <code>transferSize</code>.</p><p>You can read more about Cloudinary‚Äôs usage of Server Timing on their recent post ‚Äú<a href="https://cloudinary.com/blog/inside_the_black_box_with_server_timing" target="_blank" rel="noopener">Inside the Black Box with Server-Timing</a>‚Äù.</p><p>Although we can‚Äôt get the exact page load size, using these APIs get us way closer.</p><h2 id="Reporting-Metrics-Inline-and-RUM"><a href="#Reporting-Metrics-Inline-and-RUM" class="headerlink" title="Reporting Metrics Inline and RUM"></a>Reporting Metrics Inline and RUM</h2><p>These new browser APIs allow us to access metrics from JavaScript, which previously could only be accessed manually using the developer tools. Access from the browser means we can show them to the user or report them to a Real User Monitoring solution to track and optimize user‚Äôs experience.</p><p>Displaying these metrics on our sites is a way to communicate publicly that we are taking performance seriously.</p>]]></content>
    
    <summary type="html">
    
      Showing page load, First Paint, and First Contentful Paint Displaying on your site to prove you care about web performance.
    
    </summary>
    
    
      <category term="performance" scheme="https://jmperezperez.com/tags/performance/"/>
    
  </entry>
  
  <entry>
    <title>Sketchy SVGs with RoughJS</title>
    <link href="https://jmperezperez.com/roughjs/"/>
    <id>https://jmperezperez.com/roughjs/</id>
    <published>2018-03-25T20:50:00.000Z</published>
    <updated>2019-03-19T08:12:57.818Z</updated>
    
    <content type="html"><![CDATA[<p>I love hand-drawn graphs and I have always fantasized about applying it to vector images. That‚Äôs why I was very happy to find out about <a href="https://roughjs.com/" target="_blank" rel="noopener">RoughJS</a>, a library that draws SVG primitives like lines, curves, arcs, polygons, circles, ellipses and paths on a Canvas in a hand-drawn style.</p><a id="more"></a><div class="codepen-aspect-ratio" style="margin-bottom: 10px; padding-bottom: 75%; position: relative; width: 100%"><iframe id="cp_embed_RMVGbd" src="//codepen.io/milesmanners/embed/RMVGbd?height=513&theme-id=0&slug-hash=RMVGbd&default-tab=full" scrolling="no" frameborder="no" height="513" allowtransparency="true" allowfullscreen="true" class="cp_embed_iframe" data-amp-width="684" style="width: 684; overflow: hidden"></iframe></div><p><small class="caption">Applying RoughJS to some icons from <a href="https://fontawesome.com/" target="_blank" rel="noopener">Font Awesome</a></small></p><p>The tool can be very handy for given an informal look to diagrams and charts in some slides or presentations. Do check their <a href="https://github.com/pshihn/rough/wiki/Examples" target="_blank" rel="noopener">examples page</a>, which is very impressive.</p><p>If you have a SVG you can draw the primitives that compose it. In the next example I‚Äôm applying RoughJS to <a href="https://twitter.com/javivelasco" target="_blank" rel="noopener">Javi Velasco</a>‚Äòs SF Palace of Fine Arts SVG from <a href="https://zeit.co/day" target="_blank" rel="noopener">Zeit‚Äôs Day</a>, going through its paths.</p><div class="codepen-aspect-ratio" style="margin-bottom: 10px; padding-bottom:75%; position: relative; width: 100%"><iframe id="cp_embed_QmqdwQ" src="//codepen.io/jmperez/embed/QmqdwQ?height=513&theme-id=0&slug-hash=QmqdwQ&default-tab=full" scrolling="no" frameborder="no" height="513" allowtransparency="true" allowfullscreen="true" class="cp_embed_iframe" data-amp-width="684" style="width: 684; overflow: hidden"></iframe></div><p><small class="caption">RoughJS applied to a SVG of the Palace of Fine Arts in San Francisco created by Zeit (<a href="https://zeit.co/day" target="_blank" rel="noopener">source</a>).</small></p><h4 id="Contour-RoughJS"><a href="#Contour-RoughJS" class="headerlink" title="Contour + RoughJS"></a>Contour + RoughJS</h4><p>In the past I worked on a tool called <a href="https://github.com/JMPerez/contour" target="_blank" rel="noopener">Contour</a> that creates a SVG based on the edges detected on a bitmap image (more info on <a href="/drawing-edges-svg/">this blog post</a>).</p><p>I wanted to test the combination of Contour and RoughJS, so I took the output of Contour for 3 music album artworks. Contour outputs a SVG with polylines, which doesn‚Äôt seem to be supported by RoughJS at the moment, but <a href="https://codepen.io/jakealbaugh/pen/GZwgzV" target="_blank" rel="noopener">it‚Äôs straightforward to convert to paths</a>.</p><div class="codepen-aspect-ratio" style="margin-bottom: 10px; padding-bottom: 100%; position: relative; width: 100%"><iframe id="cp_embed_dmzdeb" src="//codepen.io/jmperez/embed/dmzdeb?height=684&theme-id=0&slug-hash=dmzdeb&default-tab=full" scrolling="no" frameborder="no" height="684" allowtransparency="true" allowfullscreen="true" class="cp_embed_iframe" data-amp-width="684" style="width: 684; overflow: hidden"></iframe></div><p><small class="caption">RoughJS drawing the above SVGs with some custom options</small></p><p>The effect is very subtle, in part because Contour generates lots of short lines, but gives the drawing a sketchy style in some traces. Changing the ‚Äúsimplification‚Äù and ‚Äúroughness‚Äù <a href="https://github.com/pshihn/rough/wiki" target="_blank" rel="noopener">options</a> allows to tweak the result.</p><h4 id="Related-Content"><a href="#Related-Content" class="headerlink" title="Related Content"></a>Related Content</h4><p>If you have read this far you probably like vector images and hand drawing. <a href="https://twitter.com/etportis" target="_blank" rel="noopener">Eric Portis</a> shared with me recently a SIGGRAPH 2011 paper called ‚Äú<a href="http://graphics.stanford.edu/~niloy/research/animated_construction_line_drawing/animatedConstructionLineDrawing_sigga11.html" target="_blank" rel="noopener">Animated Construction of Line Drawings</a>‚Äù, where they infer a plausible stroke order of a static input drawing.</p><div class="videoWrapper"><iframe width="720" height="405" src="https://www.youtube.com/embed/kme8xbb0sug" frameborder="0" allowfullscreen></iframe></div><p>The predicted stroke is comparable to the order used by human artists. I think it‚Äôs really interesting, though I haven‚Äôt found any actual implementation of the algorithm on a website.</p><h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>RoughJS is another tool that pushes vector images forward, adding an artistic hand-drawn touch to them. I‚Äôm looking forward to see how the project evolves and how it is applied in different use cases.</p>]]></content>
    
    <summary type="html">
    
      Applying RoughJS to vector images to get a hand-drawn effect.
    
    </summary>
    
    
      <category term="svg" scheme="https://jmperezperez.com/tags/svg/"/>
    
  </entry>
  
  <entry>
    <title>Choosing a Platform for Blogging</title>
    <link href="https://jmperezperez.com/choosing-platform-blogging/"/>
    <id>https://jmperezperez.com/choosing-platform-blogging/</id>
    <published>2018-01-04T11:30:00.000Z</published>
    <updated>2019-03-19T08:12:57.818Z</updated>
    
    <content type="html"><![CDATA[<p>Or why no single platform is the best one.</p><p>As a web developer I consider <strong><a href="https://jmperezperez.com">my personal website</a> part of my portfolio</strong>. It‚Äôs the canonical site where I write about the topics I care about. <a href="https://jmperezperez.com/personal-projects/">It helps me remembering ideas and resources</a>. It also gives me a public presence on Internet beyond <a href="https://www.linkedin.com/in/jmperezperez" target="_blank" rel="noopener">LinkedIn</a> and <a href="https://twitter.com/jmperezperez" target="_blank" rel="noopener">Twitter</a>.</p><p>But It‚Äôs not only about the contents. <strong>It‚Äôs also about how they are delivered</strong>. My blog is my playground, a space where I can play with browser APIs and put in practice ideas about accessibility and performance.</p><a id="more"></a><p>Several years ago I would use Wordpress to create the content, and wouldn‚Äôt care so much about low-level stuff. After all, I was focused on doing .NET and Java applications development, and didn‚Äôt care much about the web. Nobody read my blog, and scalability or performance were topics that felt far.</p><h3 id="My-Workflow"><a href="#My-Workflow" class="headerlink" title="My Workflow"></a>My Workflow</h3><p>Fast-forward to these days I use a different workflow:</p><ol><li>I write my posts on my personal blog using Markdown. The blog uses <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> behind the scenes, but this isn‚Äôt really important. Most <a href="https://www.staticgen.com/" target="_blank" rel="noopener">static site generators</a> support Markdown these days.</li><li>Posts and pages are exported to a static HTML pages. As a bonus, an <a href="https://www.ampproject.org/" target="_blank" rel="noopener">AMP</a> version is also generated. I use a <a href="https://github.com/tea3/hexo-generator-amp" target="_blank" rel="noopener">hexo generator</a> that does the heavy lifting to create an AMP-compatible version.</li><li>After publishing it, I <a href="https://help.medium.com/hc/en-us/articles/214550207-Import-post" target="_blank" rel="noopener">import the post on Medium</a>. Imported stories include a <a href="https://support.google.com/webmasters/answer/139066?hl=en" target="_blank" rel="noopener">canonical URL</a> pointing to the original post on my blog. This is important so search engines don‚Äôt see it as duplicated content. In other words, this is good for SEO.</li></ol><p>This workflow seems a good compromise to me.</p><p>First, <strong>I want to keep my blog as the canonical place where users will find the content</strong>. All publishing platforms I have used are still up and running today, so this is not the issue. I like keeping a link back to my site, where I have full control of what is delivered, and visitors can know more about me and my projects.</p><p>Second, <strong>I think AMP can be good for users to identify content that loads fast</strong> (more on this later). I have been following closely some runts about the AMP format. I‚Äôm not a big fan of it, and I would prefer that Google displayed somehow that a page result is fast enough, without having to be an AMP page.</p><p>Third, I don‚Äôt want to miss the network effect of a platform like Medium. Until recently, very few visitors would access my site. When Google is your main source you need to rank very well. I know enough about SEO to firmly belief <strong>that the best tip is to create useful content.</strong></p><p>Medium posts look beautiful with very little effort. More importantly, <strong>Medium has a great network effect</strong>. It makes it easy for people to follow editors (at least easier than having to subscribe to a RSS feed using some external app or web) and the content can be showcased through tags. I definitely think that using Medium has been key to get a higher exposure.</p><p>Medium also has <a href="https://toppub.xyz/" target="_blank" rel="noopener">publications</a> where you can submit your stories. An example is <a href="https://medium.freecodecamp.org/how-to-get-published-in-the-freecodecamp-medium-publication-9b342a22400e" target="_blank" rel="noopener">Free Code Camp</a> and <a href="https://hackernoon.com/" target="_blank" rel="noopener">Hacker Noon</a>. They can give you feedback to improve your post, and will also do minor editings to make it more compelling.</p><p><img style="margin:0 auto; max-width:300px" src="https://res.cloudinary.com/jmperez/image/upload/w_auto,f_auto,c_scale/v1514724301/medium-stats_dko2nz.png" sizes="(max-width: 768px) 100vw, 684px"> <small class="caption">A screenshot of my posts stats a little after I published that SVG post.</small></p><p>I‚Äôm not trying to get as many visits as possible for the sake of it. I have received lots of interesting comments about my posts on Twitter and Medium. And these posts have opened me the doors to speak at conferences, give interviews and write guest posts. And I hope my posts have inspired and helped other developers, the same way their contributions have shaped my knowledge.</p><h4 id="A-Word-about-Performance"><a href="#A-Word-about-Performance" class="headerlink" title="A Word about Performance"></a>A Word about Performance</h4><p>As a web developer who likes to talk about Web Performance Optimization, I can‚Äôt help keeping an eye on the platforms where I‚Äôm posting my content.</p><p>Interestingly, I‚Äôm not the only one who cares about it. Some users <a href="https://medium.com/@jmperezperez/using-svg-as-placeholders-more-image-loading-techniques-bed1b810ab2c" target="_blank" rel="noopener">discussed the performance of the SVG placeholders post on Medium</a>:</p><blockquote><p>Am I the only person who finds it ironic that a web page about keeping web pages small comes with multiple megabytes of Javascript?</p></blockquote><blockquote><p>It doesn‚Äôt need it, folks. It‚Äôs a static blog page.</p></blockquote><blockquote><p><a href="https://news.ycombinator.com/item?id=15699302" target="_blank" rel="noopener">Hacker News comment on Using SVG as image placeholders</a></p></blockquote><p>In my defense I will say I have little control on Medium.com‚Äôs web performance. Also, Medium‚Äôs strong point is not performance, as I‚Äôll show in a moment.</p><p>I said earlier that I‚Äôm not a big fan of AMP. It is marketed as a project that ‚Äúenables the creation of websites and ads that are consistently fast, beautiful and high-performing across devices and distribution platforms‚Äù.</p><p>Here‚Äôs a quick test I recorded using Webpagetest to measure how quickly the page loaded on the 3 platforms:</p><p><img src="https://res.cloudinary.com/jmperez/image/upload/w_auto,f_auto,c_scale/v1515069420/webpagetest-blog-amp-medium_ktuuib.jpg" sizes="(max-width: 768px) 100vw, 684px"><small class="caption"><a href="http://www.webpagetest.org/video/compare.php?tests=180104_QD_5bacc8fc6eddec2cd66f1d5709164188,180104_YD_da5b176b352b4a2ea79154003240653a,180104_G7_9de5273b03f346f1e9e71bb7cd21420e" target="_blank" rel="noopener">WebPageTest run</a> of the same post on 3 different formats/platforms.</small></p><p>As with Medium, AMP is a matter of trade-offs. I really like that the format enforces good practices, and for most sites it will mean a faster experience. And the fact that users can identify an AMP site with the thunder icon. T<strong>he biggest win for AMP is in organizations that would prioritize ads and tracking pixels over performance.</strong> In <a href="https://adactio.com/journal/9646" target="_blank" rel="noopener">Jeremy Keith</a>‚Äôs words:</p><blockquote><p>Now when the boss says ‚ÄúSlap a three megabyte JavaScript library on it so we can show a carousel‚Äù, the developers can only respond with ‚ÄúGoogle says No.‚Äù</p></blockquote><blockquote><p>When the boss says ‚ÄúSlap a ton of third-party trackers on it so we can monetise those eyeballs‚Äù, the developers can only respond with ‚ÄúGoogle says No.‚Äù</p></blockquote><p>Of course, if you are a performance geek you can make things faster. Just keep in mind that AMP is not a silver bullet. If you want to read more about AMP I recommend you to check out <a href="https://css-tricks.com/need-catch-amp-debate/" target="_blank" rel="noopener">Chris Coyier‚Äôs ‚ÄúNeed to Catch Up on the AMP Debate?‚Äù</a>.</p><h4 id="Choose-what-is-best-for-you"><a href="#Choose-what-is-best-for-you" class="headerlink" title="Choose what is best for you"></a>Choose what is best for you</h4><p>As with everything in this life, <strong>every platform has its pros and cons</strong>. Hopefully my workflow can help you getting a more informed decision on where you publish your content.</p>]]></content>
    
    <summary type="html">
    
      Why I keep my personal blog, use AMP, and cross-publish to Medium.
    
    </summary>
    
    
      <category term="hexo" scheme="https://jmperezperez.com/tags/hexo/"/>
    
      <category term="medium" scheme="https://jmperezperez.com/tags/medium/"/>
    
      <category term="amp" scheme="https://jmperezperez.com/tags/amp/"/>
    
  </entry>
  
  <entry>
    <title>My 2017</title>
    <link href="https://jmperezperez.com/my-2017/"/>
    <id>https://jmperezperez.com/my-2017/</id>
    <published>2017-12-31T11:50:00.000Z</published>
    <updated>2019-03-19T08:12:57.817Z</updated>
    
    <content type="html"><![CDATA[<p>This year has been a ride. More blogging and speaking at events than ever, and the feeling that it was well worth it.<a id="more"></a></p><h2 id="Blogging"><a href="#Blogging" class="headerlink" title="Blogging"></a>Blogging</h2><p>During 2017 I wrote 18 blog posts. This is a high increase respect <a href="/my-2016/">2016</a>.</p><p>My post <a href="/svg-placeholders/">Using SVG as placeholders‚Ää‚Äî‚ÄäMore Image Loading Techniques</a> was an unprecedented success. It was widely shared and got the attention of <a href="https://medium.freecodecamp.org/" target="_blank" rel="noopener">freeCodeCamp</a>, which spread it even further.</p><p><img style="margin:0 auto; max-width:300px" src="https://res.cloudinary.com/jmperez/image/upload/w_auto,f_auto,c_scale/v1514724301/medium-stats_dko2nz.png" sizes="(max-width: 768px) 100vw, 684px"></p><p><small class="caption">That escalated quickly. From a couple hundred views a day, suddenly it went up to +40k.</small></p><p>The post made it to <a href="https://news.ycombinator.com/item?id=15696596" target="_blank" rel="noopener">the top of Hacker News</a>, renowned sites about frontend articles (<a href="https://css-tricks.com/svg-as-a-placeholder/" target="_blank" rel="noopener">CSS Tricks</a>, <a href="https://www.webdesignerdepot.com/2017/11/popular-design-news-of-the-week-november-13-2017-november-19-2017/" target="_blank" rel="noopener">Webdesigner Depot</a>, <a href="https://adactio.com/links/13108" target="_blank" rel="noopener">Adactio</a>), and newsletters (<a href="http://css-weekly.com/issue-290/" target="_blank" rel="noopener">CSS Weekly</a>, <a href="http://mailchi.mp/smashingmagazine/smashing-194-big-bang-relaunch-ux-and-fighting-scammers-1131597" target="_blank" rel="noopener">Smashing Magazine</a>, <a href="http://reactnativecoach.com/issues/16" target="_blank" rel="noopener">React Native Coach</a>).</p><p>Most of my work to write that post was about ollecting ideas and examples from very talented developers. I‚Äôm happy that lots of developers have found out about them through this post, and I hope this serves to give more attention to their impressive work.</p><p>Not only was the SVG post published in the sites I love reading. Some other posts of mine got referenced from <a href="https://images.guide/#-a-id-lazy-load-non-critical-images-href-lazy-load-non-critical-images-lazy-load-non-critical-images-a-" target="_blank" rel="noopener">Addy Osmani‚Äôs excellent images.guide</a>, <a href="http://calendar.perfplanet.com/2017/progressive-image-loading-using-intersection-observer-and-sqip/" target="_blank" rel="noopener">Perfplanet‚Äôs calendar</a>, and <a href="https://cloudinary.com/blog/an_introduction_to_progressive_image_rendering" target="_blank" rel="noopener">Cloudinary</a>.</p><p>This is definitely a push for me to continue documenting techniques to improve website performance.</p><p>On a broader note, I continued making improvements to this blog. I moved many images to <a href="https://cloudinary.com" target="_blank" rel="noopener">Cloudinary</a>, which scales and reencodes the images to tailor them to the user‚Äôs device. This resulted in shorter load times, <a href="https://twitter.com/jmperezperez/status/929039257808916480" target="_blank" rel="noopener">especially in 3G</a>. I should strive for good performance on a site that promotes it.</p><h2 id="Open-source-projects"><a href="#Open-source-projects" class="headerlink" title="Open source projects"></a>Open source projects</h2><p>I built a couple of open-source projects related with Spotify. The first one is a library to interact with Spotify‚Äôs Connect API called <a href="https://github.com/JMPerez/spotify-player" target="_blank" rel="noopener">spotify-player</a> which I described on <a href="/spotify-connect-api/">Playing with the Spotify Connect API</a>. The second one is <a href="https://github.com/JMPerez/c" target="_blank" rel="noopener">C - Collaborative listening</a>, a collaborative room where users can propose, vote and listen to music.</p><h2 id="Conferences-and-interviews"><a href="#Conferences-and-interviews" class="headerlink" title="Conferences and interviews"></a>Conferences and interviews</h2><p>This year I spoke at <a href="/render-conf-oxford-2017/">RenderConf in Oxford</a>, <a href="/jsdayes-madrid-2017/">JSDayES in Madrid</a>, <a href="/speaking-alicante-frontend/">Alicante Frontend</a>, and <a href="/frontfest-moscow-2017/">Frontfest in Moscow</a>. I also attended <a href="/react-alicante-2017/">React Alicante</a>‚Äòs first edition, in my home town, which I enjoyed a lot.</p><p>I was interviewed by <a href="https://twitter.com/c_isabelromero" target="_blank" rel="noopener">Isabel Romero</a>, who works at <a href="https://ulab.es" target="_blank" rel="noopener">ULab</a>, the coworking space in Alicante that hosts the meetup <a href="https://www.meetup.com/Alicante-Frontend/" target="_blank" rel="noopener">Alicante Frontend</a>. You can <a href="https://www.youtube.com/watch?v=HLczq5ay8H0" target="_blank" rel="noopener">watch the recording on Youtube</a>.</p><p>Something new this year was <a href="/wecodesign-pwa/">a podcast I recorded about PWAs</a> with Ignacio and Carmen from <a href="http://wecodesignpodcast.com" target="_blank" rel="noopener">Wecodesign</a>, a Spanish podcast about web development and design. I realised I talk too much and I need to sort my ideas a bit better :)</p><h2 id="Work"><a href="#Work" class="headerlink" title="Work"></a>Work</h2><p>I kept having fun at Spotify working in a fabulous team that builds <a href="https://open.spotify.com/" target="_blank" rel="noopener">Spotify‚Äôs web player</a> amongst other projects.</p><h2 id="What‚Äôs-next-in-2018"><a href="#What‚Äôs-next-in-2018" class="headerlink" title="What‚Äôs next in 2018?"></a>What‚Äôs next in 2018?</h2><p>My priorities for 2018 are shifting. I‚Äôll spend more time with my family and less time coding and writing. I would like to read more about leading change in organizations and soft skills, and less about the latest CSS and JS news.</p>]]></content>
    
    <summary type="html">
    
      Wrapping up 2017 - A summary of what I have done during this year.
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Speaking at FrontFest 2017 in Moscow, Russia</title>
    <link href="https://jmperezperez.com/frontfest-moscow-2017/"/>
    <id>https://jmperezperez.com/frontfest-moscow-2017/</id>
    <published>2017-12-03T16:00:00.000Z</published>
    <updated>2019-05-10T21:16:18.118Z</updated>
    
    <content type="html"><![CDATA[<p>A couple of weeks ago I attended <a href="https://2017.frontfest.ru/" target="_blank" rel="noopener">FrontFest 2017</a> in Moscow. There were around 200 attendees at Digital October, an impressive venue. I had a lot of fun and met many local developers.</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1512318752/frontfest/frontfest-01.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1512318752/frontfest/frontfest-01.jpg 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1512318752/frontfest/frontfest-01.jpg 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1512318752/frontfest/frontfest-01.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1512318752/frontfest/frontfest-01.jpg" alt="Jose M. Perez speaking at Frontfest Moscow 2017"></p><a id="more"></a><p>FrontFest is one of the several JS conferences that take place in Moscow, which has a healthy web community with several meetups that host up to 500 people.</p><p>This single-day event was comprised of 5 tracks filled with talks and workshops. Most of the talks and workshops were in Russian, though there was always one talk or workshop in English at a given time.</p><p>I especially liked <a href="https://2017.frontfest.ru/lecture/3/" target="_blank" rel="noopener">Blaine Cook‚Äôs talk</a> about UX and developer responsibility managing user authentication. I also enjoyed Mathieu‚Äôs <a href="https://2017.frontfest.ru/lecture/15/" target="_blank" rel="noopener">live-coding</a> and following workshop, where we coded <a href="https://github.com/p01/twinStickShooter" target="_blank" rel="noopener">a simple yet very fun game</a>.</p><h2 id="My-talk-about-‚ÄúProgressive-Image-Rendering‚Äù"><a href="#My-talk-about-‚ÄúProgressive-Image-Rendering‚Äù" class="headerlink" title="My talk about ‚ÄúProgressive Image Rendering‚Äù"></a>My talk about ‚ÄúProgressive Image Rendering‚Äù</h2><div class="videoWrapper"><iframe width="720" height="405" src="https://www.youtube.com/embed/rmq1iEKsmBc" frameborder="0" allowfullscreen></iframe></div><p>I had been playing with SVG techniques during the weeks before the event, which I had documented on <a href="/svg-placeholders/">Using SVG as placeholders‚Ää‚Äî‚ÄäMore Image Loading Techniques</a>. Thus, it was a great opportunity to include them in the talk.</p><p>I also mentioned the <a href="https://www.chromestatus.com/feature/5637156160667648" target="_blank" rel="noopener">Image Decode API</a>. I first knew about it through <a href="https://twitter.com/p01/" target="_blank" rel="noopener">Mathieu ‚Äòp01‚Äô Henri</a>, who told me there were early discussions to implement it when we met at <a href="/render-conf-oxford-2017/">RenderConf Oxford</a>. Even though it‚Äôs not widely supported I thought it was a good opportunity to talk about it.</p><p>This API prevents the browser from blocking the UI when decoding an image, and can be handy when doing lazy-load. Check also <a href="https://medium.com/dailyjs/image-loading-with-image-decode-b03652e7d2d2" target="_blank" rel="noopener">this post</a> for an example on how to use it.</p><h3 id="Slides"><a href="#Slides" class="headerlink" title="Slides"></a>Slides</h3><p>The slides are available on <a href="https://slides.com/jmperez/pir-frontfest" target="_blank" rel="noopener">slides.com/jmperez/pir-frontfest</a> and you can also see them right here embedded:</p><div class="videoWrapper"><iframe src="//slides.com/jmperez/pir-frontfest/embed" width="576" height="420" scrolling="no" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>]]></content>
    
    <summary type="html">
    
      I attended FrontFest 2017 conference and talked about image performance, lazy-loading, placeholders and creative SVGs.
    
    </summary>
    
    
      <category term="talks" scheme="https://jmperezperez.com/tags/talks/"/>
    
  </entry>
  
  <entry>
    <title>How to use SVG as a Placeholder, and Other Image Loading Techniques</title>
    <link href="https://jmperezperez.com/svg-placeholders/"/>
    <id>https://jmperezperez.com/svg-placeholders/</id>
    <published>2017-10-29T21:30:00.000Z</published>
    <updated>2019-06-01T06:22:17.611Z</updated>
    
    <content type="html"><![CDATA[<p>I‚Äôm passionate about image performance optimisation and making images load fast on the web. One of the most interesting areas of exploration is placeholders: what to show when the image hasn‚Äôt loaded yet.</p><p>During the last days I have come across some loading techniques that use SVG, and I would like to describe them in this post.</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1509278557/jmperez-composition-primitive_j8zyfn.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1509278557/jmperez-composition-primitive_j8zyfn.jpg 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1509278557/jmperez-composition-primitive_j8zyfn.jpg 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1509278557/jmperez-composition-primitive_j8zyfn.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1509278557/jmperez-composition-primitive_j8zyfn.jpg" alt="Example of a SVG generated using 10 and 100 triangles based on a bitmap image"></p><p><small class="caption">Generating SVGs from images can be used for placeholders. Keep reading!</small></p><a id="more"></a><p>In this post we will go through these topics:</p><ul><li>Overview of different types of placeholders</li><li>SVG-based placeholders (edges, shapes and silhouettes)</li><li>Automating the process.</li></ul><h3 id="Overview-of-different-types-of-placeholders"><a href="#Overview-of-different-types-of-placeholders" class="headerlink" title="Overview of different types of placeholders"></a>Overview of different types of placeholders</h3><p>In the past <a href="/lazy-loading-images">I have written about placeholders and lazy-load of images</a>, and also <a href="https://www.youtube.com/watch?v=szmVNOnkwoU" target="_blank" rel="noopener">talked about it</a>. When doing lazy-loading of images it‚Äôs a good idea to think about what to render as a placeholder, since it can have a big impact in user‚Äôs perceived performance. In the past I described several options:</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1509278557/placeholder-options_vtwp6b.png 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1509278557/placeholder-options_vtwp6b.png 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1509278557/placeholder-options_vtwp6b.png 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1509278557/placeholder-options_vtwp6b.png 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1509278557/placeholder-options_vtwp6b.png" alt="Several strategies to fill the area of an image before it loads"></p><p><small class="caption">Several strategies to fill the area of an image before it loads.</small></p><ul><li><strong>Keeping the space empty for the image</strong>: In a world of responsive design, this prevents content from jumping around. Those layout changes are bad from a user‚Äôs experience point of view, but also for performance. The browser is forced to do layout re calculations every time it fetches the dimensions of an image, leaving space for it.</li><li><strong>Placeholder</strong>: Imagine that we are displaying a user‚Äôs profile image. We might want to display a silhouette in the background. This is shown while the main image is loaded, but also when that request failed or when the user didn‚Äôt set any profile picture at all. These images are usually vector-based, and due to their small size are a good candidate to be inlined.</li><li><strong>Solid colour</strong>: Take a colour from the image and use it as the background colour for the placeholder. This can be the dominant colour, the most vibrant‚Ä¶ The idea is that it is based on the image you are loading and should help making the transition between no image to image loaded smoother.</li><li><strong>Blurry image</strong>: Also called blur-up technique. You render a tiny version of the image and then transition to the full one. The initial image is tiny both in pixels and kBs. To remove artifacts the image is scaled up and blurred. I have written previously about this on <a href="/medium-image-progressive-loading-placeholder">How Medium does progressive image loading</a>, <a href="/webp-placeholder-images">Using WebP to create tiny preview images</a>, and <a href="/more-progressive-image-loading">More examples of Progressive Image Loading</a>.</li></ul><p>Turns out there are many other variations and lots of smart people are developing other techniques to create placeholders.</p><p>One of them is having gradients instead of solid colours. The gradients can create a more accurate preview of the final image, with very little overhead (increase in payload).</p><p><img style="max-width:100%; border: 0" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1509278575/gradient-background_jyymty.jpg 400w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1509278575/gradient-background_jyymty.jpg 800w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1509278575/gradient-background_jyymty.jpg 1200w, https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1509278575/gradient-background_jyymty.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1509278575/gradient-background_jyymty.jpg" alt="Using gradients as backgrounds. Screenshot from Gradify"></p><p><small class="caption">Using gradients as backgrounds. Screenshot from Gradify, which is not online anymore. Code <a href="https://github.com/fraser-hemp/gradify" target="_blank" rel="noopener">on GitHub</a>.</small></p><p>Another technique is using SVGs based on the image, which is getting some traction with recent experiments and hacks.</p><h3 id="SVG-based-placeholders"><a href="#SVG-based-placeholders" class="headerlink" title="SVG-based placeholders"></a>SVG-based placeholders</h3><p>We know SVGs are ideal for vector images. In most cases we want to load a bitmap one, so the question is how to vectorise an image. Some options are using edges, shapes and areas.</p><h4 id="Edges"><a href="#Edges" class="headerlink" title="Edges"></a>Edges</h4><p>In <a href="/drawing-edges-svg">a previous post</a> I explained how to find out the edges of an image and create an animation. My initial goal was to try to draw regions, vectorising the image, but I didn‚Äôt know how to do it. I realised that using the edges could also be innovative and I decided to animate them creating a ‚Äúdrawing‚Äù effect.</p><div class="codepen-aspect-ratio" style="margin-bottom: 10px; padding-bottom: 100%; position: relative; width: 100%"><iframe id="cp_embed_oogqdp" src="//codepen.io/jmperez/embed/oogqdp?height=600&theme-id=0&slug-hash=oogqdp&default-tab=result" scrolling="no" frameborder="no" height="600" allowtransparency="true" allowfullscreen="true" class="cp_embed_iframe" data-amp-width="600" style="width: 600; overflow: hidden"></iframe></div><h4 id="Shapes"><a href="#Shapes" class="headerlink" title="Shapes"></a>Shapes</h4><p>SVG can also be used to draw areas from the image instead of edges/borders. In a way, we would vectorise a bitmap image to create a placeholder.</p><p>Back in the days I tried to do something similar with triangles. You can see the result in my talks <a href="/cssconfau16/#/45">at CSSConf</a> and <a href="/renderconf17/#/46">Render Conf</a>.</p><div class="codepen-aspect-ratio" style="margin-bottom: 10px; padding-bottom: 74%; position: relative; width: 100%"><iframe id="cp_embed_BmaWmQ" src="//codepen.io/jmperez/embed/BmaWmQ?height=444&theme-id=0&slug-hash=BmaWmQ&default-tab=result" scrolling="no" frameborder="no" height="444" allowtransparency="true" allowfullscreen="true" class="cp_embed_iframe" data-amp-width="600" style="width: 600; overflow: hidden"></iframe></div><p>The codepen above is a proof of concept of a SVG-based placeholder composed of 245 triangles. The generation of the triangles is based on <a href="https://en.wikipedia.org/wiki/Delaunay_triangulation" target="_blank" rel="noopener">Delaunay triangulation</a> using <a href="https://github.com/possan/polyserver" target="_blank" rel="noopener">Possan‚Äôs polyserver</a>. As expected, the more triangles the SVG uses, the bigger the file size.</p><h4 id="Primitive-and-SQIP-a-SVG-based-LQIP-technique"><a href="#Primitive-and-SQIP-a-SVG-based-LQIP-technique" class="headerlink" title="Primitive and SQIP, a SVG-based LQIP technique"></a>Primitive and SQIP, a SVG-based LQIP technique</h4><p>Tobias Baldauf has been working on another Low-Quality Image Placeholder technique using SVGs called <a href="https://github.com/technopagan/sqip" target="_blank" rel="noopener">SQIP</a>. Before digging into SQIP itself I will give an overview of <a href="https://github.com/fogleman/primitive" target="_blank" rel="noopener">Primitive</a>, a library on which SQIP is based.</p><p>Primitive is quite fascinating and I definitely recommend you to check it out. It converts a bitmap image into a SVG composed of overlapping shapes. Its small size makes it suitable for inlining it straight into the page. One less roundtrip, and a meaningful placeholder within the initial HTML payload.</p><p>Primitive generates an image based on shapes like triangles, rectangles and circles (and a few others). In every step it adds a new one. The more steps, the resulting image looks closer to the original one. If your output is SVG it also means the size of the output code will be larger.</p><p>In order to understand how Primitive works, I ran it through a couple of images. I generated SVGs for the pictures using 10 shapes and 100 shapes:</p><div><img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:228,f_auto,c_scale,w_500/v1509367394/pexels-photo-281184-square-10.svg_ifiu2z.png" sizes="(max-width: 768px) 33vw, 228px" alt="Processing a picture through Primitive using 10 shapes" style="width:32%;float:left;margin-right:2%;padding-bottom:10px"><img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:228,f_auto,c_scale,w_500/v1509367394/pexels-photo-281184-square-100.svg_tkr8el.png" sizes="(max-width: 768px) 33vw, 228px" alt="Processing a picture through Primitive using 100 shapes" style="width:32%;float:left;margin-right:2%;padding-bottom:10px"><img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:228,f_auto,c_scale,w_500/v1509367395/pexels-photo-281184-square_tuhvso.jpg" sizes="(max-width: 768px) 33vw, 228px" alt="Original picture" style="width:32%;float:left;padding-bottom:10px"></div><p><small class="caption">Processing <a href="/assets/images/posts/svg-placeholders/pexels-photo-281184-square.jpg">this picture</a> using Primitive, using <a href="/assets/images/posts/svg-placeholders/pexels-photo-281184-square-10.svg">10 shapes</a> and <a href="/assets/images/posts/svg-placeholders/pexels-photo-281184-square-100.svg">100 shapes</a>.</small></p><div><img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:228,f_auto,c_scale,w_500/v1509367394/pexels-photo-618463-square-10.svg_aeonon.png" sizes="(max-width: 768px) 33vw, 228px" alt="Processing a picture through Primitive using 10 shapes" style="width:32%;float:left;margin-right:2%;padding-bottom:10px"><img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:228,f_auto,c_scale,w_500/v1509367394/pexels-photo-618463-square-100.svg_t6pwcv.png" sizes="(max-width: 768px) 33vw, 228px" alt="Processing a picturethrough Primitive using 100 shapes" style="width:32%;float:left;margin-right:2%;padding-bottom:10px"><img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:228,f_auto,c_scale,w_500/v1509367395/pexels-photo-618463-square_pmbi9x.jpg" sizes="(max-width: 768px) 33vw, 228px" alt="Original picture" style="width:32%;float:left;padding-bottom:10px"></div><p><small class="caption">Processing <a href="/assets/images/posts/svg-placeholders/pexels-photo-618463-square.jpg">this picture</a> using Primitive, using <a href="/assets/images/posts/svg-placeholders/pexels-photo-618463-square-10.svg">10 shapes</a> and <a href="/assets/images/posts/svg-placeholders/pexels-photo-618463-square-100.svg">100 shapes</a>.</small></p><p>When using 10 shapes the images we start getting a grasp of the original image. In the context of image placeholders there is potential to use this SVG as the placeholder. Actually, the code for the SVG with 10 shapes is really small, around 1030 bytes, which goes down to ~640 bytes when passing the output through SVGO.</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/2000/svg<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1024<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1024<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#817c70<span class="token punctuation">"</span></span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M0 0h1024v1024H0z<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>g</span> <span class="token attr-name">fill-opacity</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>.502<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#03020f<span class="token punctuation">"</span></span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M178 994l580 92L402-62<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#f2e2ba<span class="token punctuation">"</span></span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M638 894L614 6l472 440<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#fff8be<span class="token punctuation">"</span></span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M-62 854h300L138-62<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#76c2d9<span class="token punctuation">"</span></span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M410-62L154 530-62 38<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#62b4cf<span class="token punctuation">"</span></span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M1086-2L498-30l484 508<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#010412<span class="token punctuation">"</span></span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M430-2l196 52-76 356<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#eb7d3f<span class="token punctuation">"</span></span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M598 594l488-32-308 520<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#080a18<span class="token punctuation">"</span></span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M198 418l32 304 116-448<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#3f201d<span class="token punctuation">"</span></span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M1086 1062l-344-52 248-148<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#ebd29f<span class="token punctuation">"</span></span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M630 658l-60-372 516 320<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>g</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">></span></span></code></pre><p>The images generated with 100 shapes are larger, as expected, weighting ~5kB after SVGO (8kB before). They have a great level of detail with a still small payload. The decision of how many triangles to use will depend largely on the type of image (eg contrast, amount of colours, complexity) and level of detail.</p><p>It would be possible to create a script similar to <a href="https://github.com/technopagan/cjpeg-dssim" target="_blank" rel="noopener">cpeg-dssim</a> that tweaks the amount of shapes used until a <a href="https://en.wikipedia.org/wiki/Structural_similarity" target="_blank" rel="noopener">structural similarity</a> threshold is met (or a maximum number of shapes in the worst case).</p><p>These resulting SVGs are great also to use as background images. Being size-constrained and vector-based they are a good candidate for hero images and large backgrounds that otherwise would show artifacts.</p><h4 id="SQIP"><a href="#SQIP" class="headerlink" title="SQIP"></a>SQIP</h4><p>In <a href="https://github.com/technopagan/sqip" target="_blank" rel="noopener">Tobias‚Äô own words</a>:</p><blockquote><p>SQIP is an attempt to find a balance between these two extremes: it makes use of <a href="https://github.com/fogleman/primitive" target="_blank" rel="noopener">Primitive</a> to generate a SVG consisting of several simple shapes that approximate the main features visible inside the image, optimizes the SVG using <a href="https://github.com/svg/svgo" target="_blank" rel="noopener">SVGO</a> and adds a Gaussian Blur filter to it. This produces a SVG placeholder which weighs in at only ~800‚Äì1000 bytes, looks smooth on all screens and provides an visual cue of image contents to come.</p></blockquote><p>The result is similar to using a tiny placeholder image for the blur-up technique (what <a href="/medium-image-progressive-loading-placeholder">Medium</a> and <a href="/more-progressive-image-loading">other sites</a> do). The difference is that instead of using a bitmap image, eg JPG or WebP, the placeholder is SVG.</p><p>If we run SQIP against the original images we‚Äôll get this:</p><div><img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:342,f_auto,c_scale,w_670/v1509370309/pexels-photo-281184-square-sqip.svg_zspgb0.png" sizes="(max-width: 768px) 50vw, 342px" alt="SQIP applied to an image" style="width:49%;float:left;margin-right:2%;padding-bottom:10px"><img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:342,f_auto,c_scale,w_670/v1509370308/pexels-photo-618463-square-sqip.svg_qjrexh.png" sizes="(max-width: 768px) 50vw, 342px" alt="SQIP applied to an image" style="width:49%;float:left;padding-bottom:10px"></div><p><small class="caption">The output images using SQIP for <a href="/assets/images/posts/svg-placeholders/pexels-photo-281184-square-sqip.svg">the first picture</a> and <a href="/assets/images/posts/svg-placeholders/pexels-photo-618463-square-sqip.svg">the second one</a>.</small></p><p>The output SVG is ~900 bytes, and inspecting the code we can spot the <code>feGaussianBlur</code> filter applied to the group of shapes:</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/2000/svg<span class="token punctuation">"</span></span> <span class="token attr-name">viewBox</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0 0 2000 2000<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>b<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>feGaussianBlur</span> <span class="token attr-name">stdDeviation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>12<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#817c70<span class="token punctuation">"</span></span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M0 0h2000v2000H0z<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>g</span> <span class="token attr-name">filter</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>url(#b)<span class="token punctuation">"</span></span> <span class="token attr-name">transform</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>translate(4 4) scale(7.8125)<span class="token punctuation">"</span></span> <span class="token attr-name">fill-opacity</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>.5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ellipse</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#000210<span class="token punctuation">"</span></span> <span class="token attr-name">rx</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">ry</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">transform</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>matrix(50.41098 -3.7951 11.14787 148.07886 107 194.6)<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ellipse</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#eee3bb<span class="token punctuation">"</span></span> <span class="token attr-name">rx</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">ry</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">transform</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>matrix(-56.38179 17.684 -24.48514 -78.06584 205 110.1)<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ellipse</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#fff4bd<span class="token punctuation">"</span></span> <span class="token attr-name">rx</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">ry</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">transform</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>matrix(35.40604 -5.49219 14.85017 95.73337 16.4 123.6)<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ellipse</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#79c7db<span class="token punctuation">"</span></span> <span class="token attr-name">cx</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>21<span class="token punctuation">"</span></span> <span class="token attr-name">cy</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>39<span class="token punctuation">"</span></span> <span class="token attr-name">rx</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>65<span class="token punctuation">"</span></span> <span class="token attr-name">ry</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>65<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ellipse</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#0c1320<span class="token punctuation">"</span></span> <span class="token attr-name">cx</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>117<span class="token punctuation">"</span></span> <span class="token attr-name">cy</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>38<span class="token punctuation">"</span></span> <span class="token attr-name">rx</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>34<span class="token punctuation">"</span></span> <span class="token attr-name">ry</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>47<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ellipse</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#5cb0cd<span class="token punctuation">"</span></span> <span class="token attr-name">rx</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">ry</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">transform</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>matrix(-39.46201 77.24476 -54.56092 -27.87353 219.2 7.9)<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#e57339<span class="token punctuation">"</span></span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M271 159l-123-16 43 128z<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ellipse</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#47332f<span class="token punctuation">"</span></span> <span class="token attr-name">cx</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>214<span class="token punctuation">"</span></span> <span class="token attr-name">cy</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>237<span class="token punctuation">"</span></span> <span class="token attr-name">rx</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>242<span class="token punctuation">"</span></span> <span class="token attr-name">ry</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>19<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>g</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">></span></span></code></pre><p>SQIP can also output an image tag with the SVG contents Base 64 encoded:</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>640<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>640<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>example.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Add descriptive alt text<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">background-size</span><span class="token punctuation">:</span> cover<span class="token punctuation">;</span> <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url">url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAw...&lt;stripped base 64>...PjwvZz48L3N2Zz4=)</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code></pre><h4 id="Silhouettes"><a href="#Silhouettes" class="headerlink" title="Silhouettes"></a>Silhouettes</h4><p>We just had a look at using SVGs for edges and primitive shapes. Another possibility is to vectorise the images ‚Äútracing‚Äù them. <a href="https://twitter.com/mikaelainalem" target="_blank" rel="noopener">Mikael Ainalem</a> shared <a href="https://codepen.io/ainalem/full/aLKxjm/" target="_blank" rel="noopener">a codepen</a> a few days ago showing how to use a 2-colour silhouette as a placeholder. The result is really pretty:</p><video controls style="max-width:100%" width="690" height="459"><source src="https://res.cloudinary.com/jmperez/video/upload/dpr_auto,f_auto,q_auto,c_scale/v1509278615/silhouette-lazy-loading_evq9xq.mp4" type="video/mp4"></video><p>The SVGs in this case were hand drawn, but the technique quickly spawned integrations with tools to automate the process.</p><ul><li><a href="https://www.gatsbyjs.org" target="_blank" rel="noopener">Gatsby</a>, a static site generator using React supports these traced SVGs now. It uses <a href="https://www.npmjs.com/package/potrace" target="_blank" rel="noopener">a JS port of potrace</a> to vectorise the images.</li></ul><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">Excited to announce that Gatsby now has super simple support for traced SVG!<br><br>Thanks to <a href="https://twitter.com/fk?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@fk</a> for his great work!<a href="https://t.co/XfgEDbSILA" target="_blank" rel="noopener">https://t.co/XfgEDbSILA</a> <a href="https://t.co/wTwOgT8C5V" target="_blank" rel="noopener">pic.twitter.com/wTwOgT8C5V</a></p>&mdash; Gatsby (@gatsbyjs) <a href="https://twitter.com/gatsbyjs/status/923304195666485248?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">25 October 2017</a></blockquote><ul><li><a href="https://craftcms.com" target="_blank" rel="noopener">Craft 3 CMS</a>, which also added support for silhouettes. It uses <a href="https://github.com/nystudio107/craft3-imageoptimize/blob/master/src/lib/Potracio.php" target="_blank" rel="noopener">a PHP port of potrace</a>.</li></ul><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">Cool video of using inline SVG images as lazy loading placeholders w/ ImageOptimize &amp; Craft 3 from <a href="https://twitter.com/slebbo?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@slebbo</a> <a href="https://t.co/E1dYA4ayow" target="_blank" rel="noopener">https://t.co/E1dYA4ayow</a> <a href="https://twitter.com/hashtag/craftcms?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#craftcms</a> <a href="https://t.co/ruf8i6URCT" target="_blank" rel="noopener">pic.twitter.com/ruf8i6URCT</a></p>&mdash; nystudio107 (@nystudio107) <a href="https://twitter.com/nystudio107/status/920673966091534338?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">18 October 2017</a></blockquote><ul><li><a href="https://github.com/EmilTholin/image-trace-loader" target="_blank" rel="noopener">image-trace-loader</a>, a Webpack loader that uses potrace to process the images.</li></ul><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">I just released image-trace-loader, a <a href="https://twitter.com/hashtag/webpack?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#webpack</a> loader that exports traced outlines as image/svg+xml data.<a href="https://t.co/2VZaKVaE4p" target="_blank" rel="noopener">https://t.co/2VZaKVaE4p</a> <a href="https://t.co/vRma67R7zb" target="_blank" rel="noopener">pic.twitter.com/vRma67R7zb</a></p>&mdash; Emil Tholin (@Tholle1234) <a href="https://twitter.com/Tholle1234/status/920423596346019840?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">17 October 2017</a></blockquote><p>It‚Äôs also interesting to see a comparison of the output between Emil‚Äôs webpack loader (based on potrace) and Mikael‚Äôs hand-drawn SVGs.</p><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">Comparison of <a href="https://twitter.com/mikaelainalem?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@mikaelainalem</a> &#39;s SVG lazy-loading technique <a href="https://t.co/mbqVpxzn72" target="_blank" rel="noopener">https://t.co/mbqVpxzn72</a> with @Tholle123&#39;s webpack loader <a href="https://t.co/3jxjtNP8dm" target="_blank" rel="noopener">https://t.co/3jxjtNP8dm</a> <a href="https://t.co/tChcPK0mIK" target="_blank" rel="noopener">pic.twitter.com/tChcPK0mIK</a></p>&mdash; Yuriy Nemtsov (@nemtsovy) <a href="https://twitter.com/nemtsovy/status/920647706799955970?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">18 October 2017</a></blockquote><p>I assume the output generated by potrace is using the default options. However, it‚Äôs possible to tweak them. Check <a href="https://github.com/EmilTholin/image-trace-loader#options" target="_blank" rel="noopener">the options for image-trace-loader</a>, which are pretty much <a href="https://www.npmjs.com/package/potrace#parameters" target="_blank" rel="noopener">the ones passed down to potrace</a>.</p><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>We have seen different tools and techniques to generate SVGs from images and use them as placeholders. The same way <a href="/webp-placeholder-images/">WebP is a fantastic format for thumbnails</a>, SVG is also an interesting format to use in placeholders. We can control the level of detail (and thus, size), it‚Äôs highly compressible and easy to manipulate with CSS and JS.</p><h2 id="Extra-Resources"><a href="#Extra-Resources" class="headerlink" title="Extra Resources"></a>Extra Resources</h2><p>This post made it to <a href="https://news.ycombinator.com/item?id=15696596" target="_blank" rel="noopener">the top of Hacker News and got a lot of points and comments</a>. I‚Äôm very grateful for that, and for all the links to other resources that have been shared in the comments on that page. Here are a few of them!</p><ul><li><a href="https://github.com/Tw1ddle/geometrize-haxe" target="_blank" rel="noopener">Geometrize</a> is a port of Primitive written in Haxe. There is also <a href="https://github.com/Tw1ddle/geometrize-haxe-web" target="_blank" rel="noopener">a JS implementation</a> that you can try out directly <a href="http://www.samcodes.co.uk/project/geometrize-haxe-web/" target="_blank" rel="noopener">on your browser</a>.</li><li><a href="https://github.com/ondras/primitive.js" target="_blank" rel="noopener">Primitive.js</a>, which is a port of Primitive in JS. Also, <a href="https://github.com/cielito-lindo-productions/primitive.nextgen" target="_blank" rel="noopener">primitive.nextgen</a>, which is a port of the Primitive desktop app using Primitive.js and Electron.</li><li>There are a couple of Twitter accounts where you can see examples of images generated with Primitive and Geometrize. Check out <a href="https://twitter.com/PrimitivePic" target="_blank" rel="noopener">@PrimitivePic</a> and <a href="https://twitter.com/Geometrizer" target="_blank" rel="noopener">@Geometrizer</a>.</li><li><a href="https://github.com/jankovicsandras/imagetracerjs" target="_blank" rel="noopener">imagetracerjs</a>, which is a raster image tracer and vectorizer written in JavaScript. There are also ports for <a href="https://github.com/jankovicsandras/imagetracerjava" target="_blank" rel="noopener">Java</a> and <a href="https://github.com/jankovicsandras/imagetracerandroid" target="_blank" rel="noopener">Android</a>.</li></ul><h2 id="Related-Posts"><a href="#Related-Posts" class="headerlink" title="Related Posts"></a>Related Posts</h2><p>If you have enjoyed this post, check out these other posts I have written about techniques loading images:</p><ul><li><a href="/medium-image-progressive-loading-placeholder">How Medium does progressive image loading</a></li><li><a href="/webp-placeholder-images">Using WebP to create tiny preview images</a></li><li><a href="/more-progressive-image-loading">More examples of Progressive Image Loading</a></li></ul><p><em>This post is also available <a href="/es/svg-placeholders/">in Spanish</a></em></p><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>]]></content>
    
    <summary type="html">
    
      Web Performance Optimisation by lazy-loading images using SVGs as placeholders, representing edges, shapes and silhouettes.
    
    </summary>
    
    
      <category term="svg" scheme="https://jmperezperez.com/tags/svg/"/>
    
  </entry>
  
  <entry>
    <title>Usando SVG como placeholders‚Ää‚Äî‚ÄäM√°s t√©cnicas de carga de im√°genes</title>
    <link href="https://jmperezperez.com/es/svg-placeholders/"/>
    <id>https://jmperezperez.com/es/svg-placeholders/</id>
    <published>2017-10-29T21:30:00.000Z</published>
    <updated>2019-03-19T08:12:57.817Z</updated>
    
    <content type="html"><![CDATA[<p>Me apasiona la optimizaci√≥n del rendimiento de im√°genes y hacer que las im√°genes carguen r√°pido. Una de las √°reas de estudio m√°s interesantes es el placeholder: qu√© mostrar cuando la imagen todav√≠a no se ha cargado.</p><p>Durante los √∫ltimos d√≠as me he encontrado con algunas t√©cnicas de carga que usan SVG, y me gustar√≠a describirlas en este post.</p><p><img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto,c_scale/v1509278557/jmperez-composition-primitive_j8zyfn.jpg" sizes="(max-width: 768px) 100vw, 684px" alt="Ejemplo de un SVG generado utilizando 10 y 100 tri√°ngulos basado en una imagen de mapa de bits"> <small class="caption">Los SVGs generados a partir de im√°genes pueden ser usados como placeholders. ¬°Sigue leyendo!</small></p><a id="more"></a><p>En esta publicaci√≥n hablar√© sobre estos temas:</p><ul><li>Descripci√≥n general de los diferentes tipos de placeholders</li><li>Placeholders basados en SVG (contornos, formas y siluetas)</li><li>Automatizaci√≥n del proceso.</li></ul><h3 id="Descripcion-general-de-los-diferentes-tipos-de-placeholders"><a href="#Descripcion-general-de-los-diferentes-tipos-de-placeholders" class="headerlink" title="Descripci√≥n general de los diferentes tipos de placeholders"></a>Descripci√≥n general de los diferentes tipos de placeholders</h3><p>En el pasado <a href="/lazy-loading-images">he escrito sobre placeholders y lazy-load de im√°genes</a>, y tambi√©n <a href="https://www.youtube.com/watch?v=szmVNOnkwoU" target="_blank" rel="noopener">he dado charlas sobre ello</a>. Cuando se hace lazy-load de im√°genes es conveniente pensar en qu√© renderizar como placeholder, dado que puede tener un gran impacto en el rendimiento percibido por el usuario. Hace un tiempo describ√≠ algunas opciones:</p><p><img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto,c_scale/v1509278557/placeholder-options_vtwp6b.png" sizes="(max-width: 768px) 100vw, 684px"> <small class="caption">Diferentes estrategias para rellenar el √°rea de una imagen mientras √©sta carga.</small></p><ul><li><strong>Mantener el espacio vac√≠o para las im√°genes</strong>: En un mundo de dise√±o responsive, reservar el √°rea para la imagen evita que el contenido salte. Los cambios de layout son malos desde el punto de vista de la experiencia de usuario, pero tambi√©n son nefastos en cuanto al rendimiento. El navegador debe recalcular el layout cada vez que obtiene las dimensiones de una imagen, para dejar espacio para la misma.</li><li><strong>Placeholder</strong>: Imagina que estamos mostrando la imagen de perfil de un usuario. Quiz√°s queremos mostrar una silueta como imagen de background. Esta imagen se muestra mientras la imagen principal est√° cargando, pero tambi√©n si la petici√≥n falla o si el usuario no ha establecido ninguna imagen de perfil. Habitualmente estas im√°genes son vectoriales, y dado su peque√±o tama√±o son excelentes candidatas para ser servidas inline.</li><li><strong>Color s√≥lido</strong>: Podemos tomar un color de la imagen y usarlo como color de fondo en el placeholder. Puede ser el color dominante, el m√°s vibrante‚Ä¶ La idea es que est√° basado o extra√≠do de la imagen que se desea cargar, y el resultado deber√≠a ayudar a suavizar la transici√≥n entre ‚Äúno imagen‚Äù e ‚Äúimagen cargada‚Äù.</li><li><strong>Imagen desenfocada</strong>: Tambi√©n llamada t√©cnica <em>blur up</em>. Se renderiza una versi√≥n muy peque√±a de la imagen y se hace la transici√≥n a la imagen completa. La imagen inicial es peque√±a tanto en p√≠xeles como en kBs. Para eliminar artefactos de compresi√≥n la imagen se ampl√≠a y se desenfoca. He escrito previamente sobre este tema en <a href="/medium-image-progressive-loading-placeholder">C√≥mo Medium hacer carga progresiva de im√°genes</a>, <a href="/webp-placeholder-images">Usando WebP para crear previsualizaciones peque√±as</a>, y <a href="/more-progressive-image-loading">M√°s ejemplos de carga progresiva de im√°genes</a>.</li></ul><p>Resulta que hay muchas otras variaciones y mucha gente inteligente desarrollando otras t√©cnicas para crear placeholders.</p><p>Una de ellas es generar gradientes o degradados en vez de colores s√≥lidos. Los gradientes pueden crear una previsualizaci√≥n de la imagen final m√°s precisa, con unos pocos bytes extra.</p><p><img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto,c_scale,w_1368/v1509278575/gradient-background_jyymty.jpg" sizes="(max-width: 768px) 100vw, 684px" alt="Usando gradientes como fondos. Captura tomada de Gradify"> <small class="caption">Usando gradientes como fondos. Captura de Gradify, que ya no est√° disponible on-line. El c√≥digo <a href="https://github.com/fraser-hemp/gradify" target="_blank" rel="noopener">est√° en GitHub</a>.</small></p><p>Otra t√©cnica consiste en utilizar SVGs basados en la imagen, que est√° populariz√°ndose gracias a algunos hacks y experimentos recientes.</p><h3 id="Placeholders-basados-en-SVG"><a href="#Placeholders-basados-en-SVG" class="headerlink" title="Placeholders basados en SVG"></a>Placeholders basados en SVG</h3><p>Sabemos que los SVGs son ideales para im√°genes vectoriales. En la mayor√≠a de casos queremos cargar una imagen de mapa de bits (JPG, PNG‚Ä¶), as√≠ que la cuesti√≥n es c√≥mo vectorizar la imagen. Podemos utilizar contornos, formas y √°reas.</p><h4 id="Contornos"><a href="#Contornos" class="headerlink" title="Contornos"></a>Contornos</h4><p>En <a href="/drawing-edges-svg">un post anterior</a> expliqu√© c√≥mo calcular los contornos de una imagen y animarlos. Mi objetivo inicial era intentar dibujar regiones, vectorizando la imagen, pero no sab√≠a c√≥mo hacerlo. Me di cuenta de que usando los contornos tambi√©n pod√≠a ser innovador y decid√≠ animarlos para crear un efecto de ‚Äúdibujado‚Äù.</p><div class="codepen-aspect-ratio" style="margin-bottom: 10px; padding-bottom: 100%; position: relative; width: 100%"><iframe id="cp_embed_oogqdp" src="//codepen.io/jmperez/embed/oogqdp?height=600&theme-id=0&slug-hash=oogqdp&default-tab=result" scrolling="no" frameborder="no" height="600" allowtransparency="true" allowfullscreen="true" class="cp_embed_iframe" data-amp-width="600" style="width: 600; overflow: hidden"></iframe></div><h4 id="Formas"><a href="#Formas" class="headerlink" title="Formas"></a>Formas</h4><p>Tambi√©n podemos usar SVG para dibujar √°reas de la imagen en lugar de contornos o bordes. De alguna manera estar√≠amos vectorizando una imagen de mapa de bits para crear un placeholder.</p><p>En su d√≠a intent√© hacer algo similar con tri√°ngulos. Puedes ver el resultado en mis charlas <a href="/cssconfau16/#/45">en CSSConf</a> y <a href="/renderconf17/#/46">Render Conf</a>.</p><div class="codepen-aspect-ratio" style="margin-bottom: 10px; padding-bottom: 74%; position: relative; width: 100%"><iframe id="cp_embed_BmaWmQ" src="//codepen.io/jmperez/embed/BmaWmQ?height=444&theme-id=0&slug-hash=BmaWmQ&default-tab=result" scrolling="no" frameborder="no" height="444" allowtransparency="true" allowfullscreen="true" class="cp_embed_iframe" data-amp-width="600" style="width: 600; overflow: hidden"></iframe></div><p>Este codepen es una prueba de concepto de un placeholder basado en SVG compuesto por 245 tri√°ngulos. La generaci√≥n de los tri√°ngulos utiliza la <a href="https://es.wikipedia.org/wiki/Triangulaci%C3%B3n_de_Delaunay" target="_blank" rel="noopener">triangulaci√≥n de Delaunay</a> a partir del proyecto <a href="https://github.com/possan/polyserver" target="_blank" rel="noopener">polyserver de Possan</a>. Como es de esperar, a mayor n√∫mero de tri√°ngulos, mayor es el tama√±o del fichero resultante.</p><h4 id="Primitive-y-SQIP-una-tecnica-LQIP-basada-en-SVG"><a href="#Primitive-y-SQIP-una-tecnica-LQIP-basada-en-SVG" class="headerlink" title="Primitive y SQIP, una t√©cnica LQIP basada en SVG"></a>Primitive y SQIP, una t√©cnica LQIP basada en SVG</h4><p>Tobias Baldauf ha estado trabajando en otra t√©cnica LQIP (<em>Low-Quality Image Placeholder</em>) usando SVGs llamada <a href="https://github.com/technopagan/sqip" target="_blank" rel="noopener">SQIP</a>. Antes de adentrarnos en SQIP, me gustar√≠a describir <a href="https://github.com/fogleman/primitive" target="_blank" rel="noopener">Primitive</a>, una librer√≠a que SQIP utiliza internamente.</p><p>Primitive es fascinante y recomiendo definitivamente que le eches un ojo. Convierte una imagen de mapa de bits en un SVG compuesto por formas que se solapan. Su peque√±o tama√±o lo hace ideal para incluirlo de forma inline en la p√°gina. As√≠ se consigue reducir una petici√≥n, a la vez que se renderiza un placeholder bastante cercano a la imagen final incrustada en el cuerpo del HTML inicial.</p><p>Primitive genera una imagen basada en figuras como tri√°ngulos, rect√°ngulos y c√≠rculos entre otros. En cada paso a√±ade una figura. A m√°s pasos, la imagen resultante se va pareciendo m√°s a la imagen original. Si el formato de salida elegido es SVG, tambi√©n significa que el fichero ser√° m√°s grande cuantas m√°s figuras contenga.</p><p>Para comprender c√≥mo funciona Primitive lo ejecut√© tomando un par de im√°genes de prueba. Gener√© SVGs a partir de las im√°genes usando 10 y 100 tri√°ngulos:</p><div><img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:228,f_auto,c_scale,w_500/v1509367394/pexels-photo-281184-square-10.svg_ifiu2z.png" sizes="(max-width: 768px) 33vw, 228px" alt="Procesando una imagen usando Primitive con 10 tri√°ngulos" style="width:32%;float:left;margin-right:2%;padding-bottom:10px"><img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:228,f_auto,c_scale,w_500/v1509367394/pexels-photo-281184-square-100.svg_tkr8el.png" sizes="(max-width: 768px) 33vw, 228px" alt="Procesando una imagen usando Primitive con 100 tri√°ngulos" style="width:32%;float:left;margin-right:2%;padding-bottom:10px"><img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:228,f_auto,c_scale,w_500/v1509367395/pexels-photo-281184-square_tuhvso.jpg" sizes="(max-width: 768px) 33vw, 228px" alt="Imagen original" style="width:32%;float:left;padding-bottom:10px"></div><p><small class="caption">Procesando <a href="/assets/images/posts/svg-placeholders/pexels-photo-281184-square.jpg">esta imagen</a> con Primitive, usando <a href="/assets/images/posts/svg-placeholders/pexels-photo-281184-square-10.svg">10 tri√°ngulos</a> y <a href="/assets/images/posts/svg-placeholders/pexels-photo-281184-square-100.svg">100 tri√°ngulos</a>.</small></p><div><img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:228,f_auto,c_scale,w_500/v1509367394/pexels-photo-618463-square-10.svg_aeonon.png" sizes="(max-width: 768px) 33vw, 228px" alt="Procesando una imagen usando Primitive con 10 tri√°ngulos" style="width:32%;float:left;margin-right:2%;padding-bottom:10px"><img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:228,f_auto,c_scale,w_500/v1509367394/pexels-photo-618463-square-100.svg_t6pwcv.png" sizes="(max-width: 768px) 33vw, 228px" alt="Procesando una imagen usando Primitive con 100 tri√°ngulos" style="width:32%;float:left;margin-right:2%;padding-bottom:10px"><img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:228,f_auto,c_scale,w_500/v1509367395/pexels-photo-618463-square_pmbi9x.jpg" sizes="(max-width: 768px) 33vw, 228px" alt="Imagen original" style="width:32%;float:left;padding-bottom:10px"></div><p><small class="caption">Procesando <a href="/assets/images/posts/svg-placeholders/pexels-photo-618463-square.jpg">esta imagen</a> con Primitive, usando <a href="/assets/images/posts/svg-placeholders/pexels-photo-618463-square-10.svg">10 tri√°ngulos</a> y <a href="/assets/images/posts/svg-placeholders/pexels-photo-618463-square-100.svg">100 tri√°ngulos</a>.</small></p><p>Usando 10 tri√°ngulos las im√°genes empiezan a parecerse a la versi√≥n original. Estas im√°genes SVG pueden ser adecuadas como placeholders. De hecho el c√≥digo del SVG de 10 tri√°ngulos es muy peque√±o, unos 1.030 bytes, que pueden reducirse hasta unos 640 bytes si pasamos la salida por SVGO.</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/2000/svg<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1024<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1024<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#817c70<span class="token punctuation">"</span></span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M0 0h1024v1024H0z<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>g</span> <span class="token attr-name">fill-opacity</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>.502<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#03020f<span class="token punctuation">"</span></span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M178 994l580 92L402-62<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#f2e2ba<span class="token punctuation">"</span></span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M638 894L614 6l472 440<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#fff8be<span class="token punctuation">"</span></span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M-62 854h300L138-62<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#76c2d9<span class="token punctuation">"</span></span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M410-62L154 530-62 38<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#62b4cf<span class="token punctuation">"</span></span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M1086-2L498-30l484 508<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#010412<span class="token punctuation">"</span></span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M430-2l196 52-76 356<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#eb7d3f<span class="token punctuation">"</span></span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M598 594l488-32-308 520<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#080a18<span class="token punctuation">"</span></span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M198 418l32 304 116-448<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#3f201d<span class="token punctuation">"</span></span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M1086 1062l-344-52 248-148<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#ebd29f<span class="token punctuation">"</span></span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M630 658l-60-372 516 320<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>g</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">></span></span></code></pre><p>Las im√°genes generadas con 100 tri√°ngulos son m√°s grandes, en kB, como es de esperar. En esta prueba las im√°genes ocupan unos 5kB tras aplicar SVGO (8kB antes). Tienen un gran nivel de detalle en un tama√±o comedido. La decisi√≥n de cu√°ntos tri√°ngulos usar depende mucho del tipo de imagen (por ejemplo contraste, cantidad de colores, complejidad de la forma) y el nivel de detalle deseado.</p><p>Ser√≠a posible crear un script similar a <a href="https://github.com/technopagan/cjpeg-dssim" target="_blank" rel="noopener">cpeg-dssim</a> que ajusta la cantidad de formas hasta llegar a un umbral de <a href="https://en.wikipedia.org/wiki/Structural_similarity" target="_blank" rel="noopener">similaridad estructural</a>, o un m√°ximo n√∫mero de formas en el peor caso.</p><p>Los SVGs resultantes son una buena opci√≥n tambi√©n como im√°genes de fondo. Dado que son vectoriales y tienen un tama√±o limitado, son un buen candidato para im√°genes <em>hero</em> y fondos de gran tama√±o que de otro modo mostrar√≠an artefactos de compresi√≥n.</p><h4 id="SQIP"><a href="#SQIP" class="headerlink" title="SQIP"></a>SQIP</h4><p>En <a href="https://github.com/technopagan/sqip" target="_blank" rel="noopener">palabras de Tobias</a>:</p><blockquote><p>SQIP es un intento de encontrar un balance entre estos dos extremos: hace uso de <a href="https://github.com/fogleman/primitive" target="_blank" rel="noopener">Primitive</a> para generar un SVG consistente en varias formas sencillas que aproximan las principales caracter√≠sticas visibles dentro de la imagen, optimiza el SVG utilizando <a href="https://github.com/svg/svgo" target="_blank" rel="noopener">SVGO</a> y le a√±ade un filtro de desenfoque gaussiano. Esto produce un placeholder SVG que pesa s√≥lo ~800‚Äì1000 bytes, se ve bien en todas las pantallas y proporciona una pista visual del contenido de la imagen que se va a cargar.</p></blockquote><p>El resultado es similar a utilizar una imagen peque√±a como placeholder en la t√©cnica blur-up (lo que <a href="/medium-image-progressive-loading-placeholder">Medium</a> y <a href="/more-progressive-image-loading">otros sitios</a> hacen). La diferencia es que, en lugar de utilizar una imagen bitmap como JPG o WebP, el placeholder usa SVG.</p><p>Si ejecutamos SQIP con las im√°genes originales obtenemos esto:</p><div><img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:342,f_auto,c_scale,w_670/v1509370309/pexels-photo-281184-square-sqip.svg_zspgb0.png" sizes="(max-width: 768px) 50vw, 342px" alt="SQIP aplicado a una imagen" style="width:49%;float:left;margin-right:2%;padding-bottom:10px"><img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:342,f_auto,c_scale,w_670/v1509370308/pexels-photo-618463-square-sqip.svg_qjrexh.png" sizes="(max-width: 768px) 50vw, 342px" alt="SQIP aplicado a una imagen" style="width:49%;float:left;padding-bottom:10px"></div><p><small class="caption">Las im√°genes resultantes tras aplicar SQIP sobre <a href="/assets/images/posts/svg-placeholders/pexels-photo-281184-square-sqip.svg">la primera imagen</a> y <a href="/assets/images/posts/svg-placeholders/pexels-photo-618463-square-sqip.svg">la segunda</a>.</small></p><p>El SVG resultante ocupa ~900 bytes. Inspeccionando el c√≥digo podemos observar el filtro <code>feGaussianBlur</code> aplicado al grupo de formas:</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/2000/svg<span class="token punctuation">"</span></span> <span class="token attr-name">viewBox</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0 0 2000 2000<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>b<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>feGaussianBlur</span> <span class="token attr-name">stdDeviation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>12<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#817c70<span class="token punctuation">"</span></span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M0 0h2000v2000H0z<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>g</span> <span class="token attr-name">filter</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>url(#b)<span class="token punctuation">"</span></span> <span class="token attr-name">transform</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>translate(4 4) scale(7.8125)<span class="token punctuation">"</span></span> <span class="token attr-name">fill-opacity</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>.5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ellipse</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#000210<span class="token punctuation">"</span></span> <span class="token attr-name">rx</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">ry</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">transform</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>matrix(50.41098 -3.7951 11.14787 148.07886 107 194.6)<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ellipse</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#eee3bb<span class="token punctuation">"</span></span> <span class="token attr-name">rx</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">ry</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">transform</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>matrix(-56.38179 17.684 -24.48514 -78.06584 205 110.1)<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ellipse</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#fff4bd<span class="token punctuation">"</span></span> <span class="token attr-name">rx</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">ry</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">transform</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>matrix(35.40604 -5.49219 14.85017 95.73337 16.4 123.6)<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ellipse</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#79c7db<span class="token punctuation">"</span></span> <span class="token attr-name">cx</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>21<span class="token punctuation">"</span></span> <span class="token attr-name">cy</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>39<span class="token punctuation">"</span></span> <span class="token attr-name">rx</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>65<span class="token punctuation">"</span></span> <span class="token attr-name">ry</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>65<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ellipse</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#0c1320<span class="token punctuation">"</span></span> <span class="token attr-name">cx</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>117<span class="token punctuation">"</span></span> <span class="token attr-name">cy</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>38<span class="token punctuation">"</span></span> <span class="token attr-name">rx</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>34<span class="token punctuation">"</span></span> <span class="token attr-name">ry</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>47<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ellipse</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#5cb0cd<span class="token punctuation">"</span></span> <span class="token attr-name">rx</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">ry</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">transform</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>matrix(-39.46201 77.24476 -54.56092 -27.87353 219.2 7.9)<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#e57339<span class="token punctuation">"</span></span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>M271 159l-123-16 43 128z<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ellipse</span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#47332f<span class="token punctuation">"</span></span> <span class="token attr-name">cx</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>214<span class="token punctuation">"</span></span> <span class="token attr-name">cy</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>237<span class="token punctuation">"</span></span> <span class="token attr-name">rx</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>242<span class="token punctuation">"</span></span> <span class="token attr-name">ry</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>19<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>g</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">></span></span></code></pre><p>SQIP tambi√©n puede imprimir como resultado una etiqueta <code>img</code> con el contenido del SVG codificado en Base 64:</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>640<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>640<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>example.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Add descriptive alt text<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">background-size</span><span class="token punctuation">:</span> cover<span class="token punctuation">;</span> <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url">url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAw...&lt;stripped base 64>...PjwvZz48L3N2Zz4=)</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code></pre><h4 id="Siluetas"><a href="#Siluetas" class="headerlink" title="Siluetas"></a>Siluetas</h4><p>Acabamos de ver c√≥mo usar SVGs para contornos y formas b√°sicas. Otra posibilidad es vectorizar las im√°genes ‚Äútraz√°ndolas‚Äù. <a href="https://twitter.com/mikaelainalem" target="_blank" rel="noopener">Mikael Ainalem</a> comparti√≥ <a href="https://codepen.io/ainalem/full/aLKxjm/" target="_blank" rel="noopener">un codepen</a> hace unos d√≠as mostrando c√≥mo usar una silueta con 2 colores como placeholder. El resultado es muy bonito:</p><video controls style="max-width:100%" width="690" height="459"><source src="https://res.cloudinary.com/jmperez/video/upload/dpr_auto,f_auto,q_auto,c_scale/v1509278615/silhouette-lazy-loading_evq9xq.mp4" type="video/mp4"></video><p>En este caso los SVGs est√°n dibujados a mano, pero la t√©cnica inspir√≥ r√°pidamente a desarrolladores que crearon integraciones con herramientas que automatizaban el proceso.</p><ul><li><a href="https://www.gatsbyjs.org" target="_blank" rel="noopener">Gatsby</a>, un generador de sitios est√°ticos basado en React, soporta estos SVGs trazados. Utiliza <a href="https://www.npmjs.com/package/potrace" target="_blank" rel="noopener">un port de potrace a JavaScript</a> para vectorizar las im√°genes.</li></ul><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">Excited to announce that Gatsby now has super simple support for traced SVG!<br><br>Thanks to <a href="https://twitter.com/fk?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@fk</a> for his great work!<a href="https://t.co/XfgEDbSILA" target="_blank" rel="noopener">https://t.co/XfgEDbSILA</a> <a href="https://t.co/wTwOgT8C5V" target="_blank" rel="noopener">pic.twitter.com/wTwOgT8C5V</a></p>&mdash; Gatsby (@gatsbyjs) <a href="https://twitter.com/gatsbyjs/status/923304195666485248?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">25 October 2017</a></blockquote><ul><li><a href="https://craftcms.com" target="_blank" rel="noopener">Craft 3 CMS</a>, que tambi√©n a√±adi√≥ soporte para siluetas. Utiliza <a href="https://github.com/nystudio107/craft3-imageoptimize/blob/master/src/lib/Potracio.php" target="_blank" rel="noopener">un port de potrace a PHP</a>.</li></ul><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">Cool video of using inline SVG images as lazy loading placeholders w/ ImageOptimize &amp; Craft 3 from <a href="https://twitter.com/slebbo?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@slebbo</a> <a href="https://t.co/E1dYA4ayow" target="_blank" rel="noopener">https://t.co/E1dYA4ayow</a> <a href="https://twitter.com/hashtag/craftcms?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#craftcms</a> <a href="https://t.co/ruf8i6URCT" target="_blank" rel="noopener">pic.twitter.com/ruf8i6URCT</a></p>&mdash; nystudio107 (@nystudio107) <a href="https://twitter.com/nystudio107/status/920673966091534338?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">18 October 2017</a></blockquote><ul><li><a href="https://github.com/EmilTholin/image-trace-loader" target="_blank" rel="noopener">image-trace-loader</a>, un loader de Webpack que utiliza potrace para procesar las im√°genes.</li></ul><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">I just released image-trace-loader, a <a href="https://twitter.com/hashtag/webpack?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#webpack</a> loader that exports traced outlines as image/svg+xml data.<a href="https://t.co/2VZaKVaE4p" target="_blank" rel="noopener">https://t.co/2VZaKVaE4p</a> <a href="https://t.co/vRma67R7zb" target="_blank" rel="noopener">pic.twitter.com/vRma67R7zb</a></p>&mdash; Emil Tholin (@Tholle1234) <a href="https://twitter.com/Tholle1234/status/920423596346019840?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">17 October 2017</a></blockquote><p>Tambi√©n es interesante ver una comparaci√≥n de la salida obtenida por el loader de webpack de Emil (basado en potrace) y los SVGs dibujados a mano de Mikael.</p><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">Comparison of <a href="https://twitter.com/mikaelainalem?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@mikaelainalem</a> &#39;s SVG lazy-loading technique <a href="https://t.co/mbqVpxzn72" target="_blank" rel="noopener">https://t.co/mbqVpxzn72</a> with @Tholle123&#39;s webpack loader <a href="https://t.co/3jxjtNP8dm" target="_blank" rel="noopener">https://t.co/3jxjtNP8dm</a> <a href="https://t.co/tChcPK0mIK" target="_blank" rel="noopener">pic.twitter.com/tChcPK0mIK</a></p>&mdash; Yuriy Nemtsov (@nemtsovy) <a href="https://twitter.com/nemtsovy/status/920647706799955970?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">18 October 2017</a></blockquote><p>Asumo que la salida generada por potrace utiliza las opciones por defecto. Adicionalmente, es posible ajustarlas. Lee <a href="https://github.com/EmilTholin/image-trace-loader#options" target="_blank" rel="noopener">las opciones para image-trace-loader</a>, que son pr√°cticamente <a href="https://www.npmjs.com/package/potrace#parameters" target="_blank" rel="noopener">las que se pasan a potrace</a>.</p><h2 id="Resumen"><a href="#Resumen" class="headerlink" title="Resumen"></a>Resumen</h2><p>Hemos visto diferentes herramientas y t√©cnicas para generar SVGs basados en im√°genes bitmap y utilizarlos como placeholders. De la misma forma que <a href="/webp-placeholder-images/">WebP es un formato fant√°stico para previsualizaciones</a>, SVG es tambi√©n un formato interesante para aplicar en los placeholders. Podemos controlar el nivel de detalle (y por consiguiente, su tama√±o), es altamente comprimible y es f√°cil de manipular con CSS y JS.</p><h2 id="Recursos-extra"><a href="#Recursos-extra" class="headerlink" title="Recursos extra"></a>Recursos extra</h2><p>Este post lleg√≥ a <a href="https://news.ycombinator.com/item?id=15696596" target="_blank" rel="noopener">lo alto de Hacker News, consiguiendo muchos puntos y comentarios</a>. Me siento orgulloso por ello, y por todos los enlaces a otros recursos que han sido compartidos en los comentarios de esa p√°gina. Aqu√≠ tienes algunos de ellos:</p><ul><li><a href="https://github.com/Tw1ddle/geometrize-haxe" target="_blank" rel="noopener">Geometrize</a> es un port de Primitive escrito en Haxe. Tambi√©n hay <a href="https://github.com/Tw1ddle/geometrize-haxe-web" target="_blank" rel="noopener">una implementaci√≥n en JavaScript</a> que puedes probar directamente <a href="http://www.samcodes.co.uk/project/geometrize-haxe-web/" target="_blank" rel="noopener">en tu navegador</a>.</li><li><a href="https://github.com/ondras/primitive.js" target="_blank" rel="noopener">Primitive.js</a>, que es un port de Primitive en JavaScript. Tambi√©n, <a href="https://github.com/cielito-lindo-productions/primitive.nextgen" target="_blank" rel="noopener">primitive.nextgen</a>, que es un port de la aplicaci√≥n de escritorio de Primitive utilizando Primitive.js y Electron.</li><li>Hay un par de cuentas de Twitter donde puedes ver ejemplos de im√°genes generadas con Primitive y Geometrize: <a href="https://twitter.com/PrimitivePic" target="_blank" rel="noopener">@PrimitivePic</a> y <a href="https://twitter.com/Geometrizer" target="_blank" rel="noopener">@Geometrizer</a>.</li><li><a href="https://github.com/jankovicsandras/imagetracerjs" target="_blank" rel="noopener">imagetracerjs</a>, que es un tracer de im√°genes r√°ster y vectorizador escrito en JavaScript. Tambi√©n hay ports para <a href="https://github.com/jankovicsandras/imagetracerjava" target="_blank" rel="noopener">Java</a> y <a href="https://github.com/jankovicsandras/imagetracerandroid" target="_blank" rel="noopener">Android</a>.</li></ul><h2 id="Posts-relacionados"><a href="#Posts-relacionados" class="headerlink" title="Posts relacionados"></a>Posts relacionados</h2><p>Si te ha gustado este post, echa un vistazo a estos otros en los que he escrito sobre t√©cnicas para cargar im√°genes:</p><ul><li><a href="/medium-image-progressive-loading-placeholder">C√≥mo Medium carga im√°genes de forma progresiva</a></li><li><a href="/webp-placeholder-images">Usando WebP para crear peque√±as previsualizaciones</a></li><li><a href="/more-progressive-image-loading">M√°s ejemplos de carga de im√°genes progresiva</a></li></ul><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>]]></content>
    
    <summary type="html">
    
      Optimizaci√≥n del rendimiento web utilizando carga diferida de im√°genes con SVGs como placeholders, representando contornos, formas y siluetas.
    
    </summary>
    
    
      <category term="svg" scheme="https://jmperezperez.com/tags/svg/"/>
    
  </entry>
  
  <entry>
    <title>Duotone using CSS blend modes</title>
    <link href="https://jmperezperez.com/duotone-using-css-blend-modes/"/>
    <id>https://jmperezperez.com/duotone-using-css-blend-modes/</id>
    <published>2017-10-26T04:15:00.000Z</published>
    <updated>2019-03-19T08:12:57.816Z</updated>
    
    <content type="html"><![CDATA[<p>In a past post I explained <a href="/duotone-using-fecolormatrix/">how to use SVG and a <code>feColorMatrix</code> filter</a> to apply a duotone effect to an image. This time I‚Äôm going to show how to achieve a similar effect with only CSS.</p><a id="more"></a><p>Demo &amp; Code: <a href="http://codepen.io/jmperez/pen/wrVxga" target="_blank" rel="noopener">https://codepen.io/jmperez/pen/wrVxga</a></p><iframe id="cp_embed_wrVxga" src="//codepen.io/jmperez/embed/wrVxga?height=367&theme-id=0&slug-hash=wrVxga&default-tab=result" scrolling="no" frameborder="no" height="367" allowtransparency="true" allowfullscreen="true" class="cp_embed_iframe" data-amp-width="100%" style="width: 100%; overflow: hidden"></iframe><p>The code consists of a <code>&lt;div/&gt;</code> that has an image set as a background. Then, we add a <code>::before</code> and an <code>::after</code> pseudo-elements with the colours we want to apply and the right blend modes.</p><p>Previously, my colleague Thodoris described how to achieve this effect <a href="http://blog.72lions.com/blog/2015/7/7/duotone-in-js" target="_blank" rel="noopener">in JS using Canvas</a> and <a href="http://blog.72lions.com/blog/2015/7/18/duotone-in-ios" target="_blank" rel="noopener">in iOS</a>. I also reproduced it using <a href="/duotone-using-fecolormatrix/">SVG and a <code>feColorMatrix</code> filter</a>.</p><p>This version is based on the technique described by Una Kravets:</p><p><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">Duotone images are so <a href="https://twitter.com/hashtag/trendy?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#trendy</a> right now üòé<br><br>Had some airport time so I drew out how to get this effect w/one div in CSS üòä <a href="https://twitter.com/hashtag/devdoodles?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#devdoodles</a> <a href="https://t.co/WENOWlwcUY" target="_blank" rel="noopener">pic.twitter.com/WENOWlwcUY</a></p>&mdash; Una Kravets üë©üèª‚Äçüíª (@Una) <a href="https://twitter.com/Una/status/923231326420922368?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">25 October 2017</a></blockquote></p><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><p>which is also what the <a href="http://lukyvj.github.io/colofilter.css/" target="_blank" rel="noopener">colofilter.css</a> library is based on to achieve the duotone effect.</p>]]></content>
    
    <summary type="html">
    
      Using CSS blend modes to apply a duotone effect to an image.
    
    </summary>
    
    
      <category term="svg" scheme="https://jmperezperez.com/tags/svg/"/>
    
  </entry>
  
  <entry>
    <title>Hablando sobre PWA en el podcast WeCodeSign</title>
    <link href="https://jmperezperez.com/wecodesign-pwa/"/>
    <id>https://jmperezperez.com/wecodesign-pwa/</id>
    <published>2017-10-03T16:00:00.000Z</published>
    <updated>2019-03-19T08:12:57.816Z</updated>
    
    <content type="html"><![CDATA[<p>Esta semana se ha publicado <a href="http://wecodesignpodcast.com/2017/10/03/progressive-web-apps/" target="_blank" rel="noopener">el podcast sobre Progressive Web Apps</a> que grab√© con Ignacio Villanueva y Carmen Ansio para WeCodeSign.</p><a id="more"></a><p>En √©l hablamos sobre qu√© son las PWA, c√≥mo se originaron y c√≥mo podemos implementarlas. Tambi√©n compartimos algunos recursos √∫tiles que nos har√°n m√°s f√°cil trabajar con Service Workers.</p><p><a href="http://wecodesignpodcast.com/2017/10/03/progressive-web-apps/" target="_blank" rel="noopener"><img src="/assets/images/posts/wecodesign-pwa.jpg" alt="WeCodeSign Progressive Web Apps"></a></p><p><a href="http://wecodesignpodcast.com" target="_blank" rel="noopener">WeCodeSign</a> es uno de los podcasts l√≠deres sobre desarrollo y dise√±o en espa√±ol, y ha sido un honor formar parte de √©l. Pod√©is escucharlo desde su web, en <a href="https://itunes.apple.com/es/podcast/wecodesign-podcast/id1113501272" target="_blank" rel="noopener">iTunes</a>, <a href="http://www.ivoox.com/escuchar-audios-wecodesign-podcast_al_5101204_1.html" target="_blank" rel="noopener">iVoox</a>, <a href="http://www.spreaker.com/user/8737490" target="_blank" rel="noopener">Spreaker</a> y <a href="https://www.podkas.com/directorio/weckdesign-podcast-de-httpstwitter-comwecodesign/" target="_blank" rel="noopener">Podkas</a>.</p><hr><h2 id="Transcripcion"><a href="#Transcripcion" class="headerlink" title="Transcripci√≥n"></a>Transcripci√≥n</h2><p><strong>[Ignacio Villanueva] En el programa de hoy hablaremos sobre las Progressive Web Apps ,que es un t√©rmino que se acu√±a a una nueva generaci√≥n de aplicaciones que se basa en las nuevas tecnolog√≠as web para incrementar su funcionalidad. Tenemos el placer de contar con Jos√© Manuel P√©rez, desarrollador web en Spotify.</strong></p><p><strong>Os dejamos con la entrevista, esperamos que la disfrut√©is, y como siempre nos vemos al final.</strong></p><p><strong>Una vez m√°s traemos a un invitado nuevo como siempre. Esta vez es un desarrollador que no trabaja en Espa√±a y nos contar√° un poco acerca del tema y vamos a hablar sobre Progressive Web Apps.</strong></p><p>As√≠ que bienvenido, Jos√© Manuel.</p><p>[Jos√© M. P√©rez] Hola, muchas gracias. Pues s√≠, soy un desarrollador web, llevo unos diez a√±os pr√°cticamente haciendo web. Estudi√© inform√°tica en la Universidad de Alicante. Por aquel entonces la web era un desconocido. Como parte del plan de estudios estudiabas c√≥mo hacer aplicaciones WAP. Pr√°cticamente hacer aplicaciones m√≥viles utilizando J2ME era lo √∫nico que hab√≠a y ten√≠as que luchar t√∫ un poquito para encontrar alguna asignatura optativa donde se utilizara web y, bueno, hoy en d√≠a la verdad es que la situaci√≥n ha cambiado bastante. Y nada, me alegro un mont√≥n de que la web sea mucho m√°s importante que antes. Llevo cinco a√±os trabajando en Spotify en Estocolmo trabajando haciendo web h√≠brida para m√≥vil, aplic√°ndolo a la aplicaci√≥n de m√≥vil aplicando web tambi√©n a la aplicaci√≥n h√≠brida de escritorio, utilizando web para implementar la aplicaci√≥n para televisi√≥n y para PlayStation y √∫ltimamente estoy trabajando en el reproductor web. As√≠ que nada, est√° s√∫perbien porque te das cuenta de que puedes desarrollar utilizando el mismo lenguaje y pr√°cticamente tienes acceso a cualquier plataforma. Esto viene un poco tambi√©n de cuando sol√≠a trabajar en Tuenti en el sitio m√≥vil de Tuenti, tambi√©n ah√≠ estuve haciendo cosillas para hacer una aplicaci√≥n h√≠brida. Tambi√©n se integraban ciertas vistas dentro de la aplicaci√≥n nativa.</p><p>Y nada, asegur√°ndote de que la web funcionara en Nintendo DS, en PSP (PlayStation Portable), en la Blackberry 8520 que es lo que utilizaba todo el mundo. Y la verdad es que en esos momentos es cuando te das cuenta de que no puedes asumir nada, que un navegador tenga Javascript no significa que vaya a tener la capacidad de funcionar como te esperas, que haya una funci√≥n declarada no significa que vaya a funcionar luego. As√≠ que aprend√≠ bastante a hacer lo que se llama Progressive Enhancement para asegurarte de que funciona con HTML y CSS y luego ya a√±adir funcionalidad con Javascript.</p><p>He sido bastante defensor de ese paradigma, aunque √∫ltimamente est√° siendo un poco complicado con todo el desarrollo de Javascript pr√°cticamente basado en el lado de cliente. Esto es un poco lo que he estado haciendo √∫ltimamente.</p><p><strong>[I] Bueno, una pasada, porque la verdad es que hasta ahora, por lo menos que nos hayan comentado, no hemos tenido ning√∫n invitado ni ninguna invitada que nos haya hablado sobre desarrollo Javascript para PSPs ni tecnolog√≠as un poco m√°s antiguas, en este caso consolas.</strong></p><p>[J] En aquel momento yo trabajaba en Tuenti y la mayor√≠a de usuarios eran j√≥venes, se conectaban a Internet con lo que pod√≠an, normalmente utilizaban wifi, no ten√≠an una conexi√≥n de datos. Se conectaban tarde, por la noche, pr√°cticamente a escondidas de los padres, utilizando la consola o lo que pod√≠an tener a mano. De hecho la misma aplicaci√≥n m√≥vil funcionaba tanto en estas consolas port√°tiles como en la PlayStation 3 por ejemplo. Era un desaf√≠o bastante grande porque adem√°s utilizaban Netfront como navegador, no era WebKit, y daban un mont√≥n de problemas. Una de las razones por las que me interes√≥ Spotify es porque ten√≠an una plataforma para desarrollar aplicaciones web dentro de la aplicaci√≥n de escritorio. Hoy en d√≠a es una cosa un poco m√°s normal. Los que usamos Slack sabemos que tiene una versi√≥n web y otra de escritorio que es pr√°cticamente lo mismo, Whatsapp tambi√©n tiene una versi√≥n web y Telegram lo mismo. Se est√°n viendo m√°s y m√°s ejemplos de aplicaciones que pueden correr tanto en webs como ser empaquetadas para poder instalarlas. En aquel entonces era una cosa bastante novedosa y es algo que me gustar√≠a tratar en el tema de hoy; esta moda de Progressive Web Apps y hablar un poco de lo que ten√≠amos antes y a lo que vienen a sustituir.</p><blockquote><p>PWA es un t√©rmino de marketing, no se corresponde con ninguna versi√≥n nueva del est√°ndar de Javascript. Muchas veces lo comparo con Web 2.0 o HTML5.</p></blockquote><p><strong>[Carmen Ansio] ¬øNos podr√≠as explicar as√≠ resumidamente que es una Progressive Web App?</strong></p><p>[J] Pues lo primero que voy a decir es que es un t√©rmino de marketing, no se corresponde con ninguna versi√≥n nueva del est√°ndar de Javascript, ni nada parecido. Muchas veces lo comparo con Web 2.0 o HTML5. HTML5 s√≠ era una versi√≥n nueva pero en realidad estamos hablando de todas estas APIs nuevas para poder desarrollar aplicaciones web o sitios web para los que les vamos a ir a√±adiendo alguna una funcionalidad.</p><p>El t√©rmino Progressive Web App lo acu√±√≥ Alex Russell y Frances Berriman que eran 2 desarrolladores de Google. Hace un par de a√±os escribieron <a href="https://infrequently.org/2015/06/progressive-apps-escaping-tabs-without-losing-our-soul/" target="_blank" rel="noopener">un post</a> y describ√≠an el t√©rmino como websites que son responsive, que se parecen a aplicaciones nativas, que se puede instalar en la pantalla de inicio y que en algunos casos soportan modo offline. Es bastante interesante porque Alex estuvo hace poco explicando, <a href="https://twitter.com/slightlylate/status/879458731519389697" target="_blank" rel="noopener">en una serie de tweets</a>, c√≥mo surgi√≥ el tema y el t√©rmino PWA.</p><p>Hay mucha gente a la que no le gusta lo de Progressive Web Apps y no entiende por qu√© es ‚Äúapp‚Äù y no es ‚Äúsite‚Äù. En cuanto lees sobre el tema b√°sicamente te dicen que PWA no es un t√©rmino ara los desarrolladores, sino para para tu jefe. Es un t√©rmino para el inversor, para el que va a hacer campa√±a de marketing de tu sitio. Es una forma de continuar construyendo proyectos en la web de forma abierta, que parezcan una aplicaci√≥n y que normalmente tu compa√±√≠a quiere hacer como aplicaci√≥n nativa y no como web. Y la quieren hacer tres veces: una vez para Android, otra para iOS y otra, si pueden para Windows Phone. Al final es otra forma de decir que tenemos una serie de APIs, vamos a llamarla de alguna forma y con eso a ver si la gente se siente atra√≠da y lo identifica como algo cool, algo novedoso, y que valga la pena verlo.</p><p>Esto lo escribieron ellos cuando estaban evaluando si ten√≠an que tender hacia desarrollar aplicaciones para Chrome utilizando su sistema propietario, o ten√≠an que ir m√°s hacia un sistema m√°s abierto, que es lo que defend√≠an Alex y Francis. Se sentaron y estuvieron hablando sobre c√≥mo unificar en un t√©rmino esa funcionalidad de a√±adir a la pantalla de inicio, ServiceWorkers, notificaciones push y dem√°s,</p><p>Cuando los desarrolladores escuchamos Progressive Web App tenemos que parar por un momento y pensar qu√© quiere decir, qu√© hay detr√°s. Google est√° promoviendo PWA y lo hace como una marca. Nosotros tenemos que verlo como un conjunto de herramientas que tenemos que tomar y aplicar a nuestras webs si as√≠ lo queremos. Muchas compa√±√≠as que estaban centradas en desarrollar aplicaciones nativas ahora ven la web como una alternativa v√°lida.</p><blockquote><p>Hay mucha gente nueva en Internet en muchos pa√≠ses emergentes que no quiere descargar. Las tarifas de datos son car√≠simas y quieren consumir contenido directamente, sin pasar por el proceso de instalaci√≥n.</p></blockquote><p><strong>[I] S√≠ porque adem√°s hace tiempo que se demuestra que muchos usuarios se instalan cinco aplicaciones en el m√≥vil y el resto no las abren nunca m√°s. Son las t√≠picas de mensajer√≠a instant√°nea, de redes sociales y las 2 extra de turno que se usen por el motivo que sea. Hay gente que obviamente s√≠ usa m√°s aplicaciones, los que estamos m√°s en la web porque somos desarrolladores o m√°s frikis, como queramos llamarlo. Supongo que depende un poco de cada perfil. Pero no hay que olvidar que la inmensa mayor√≠a no somos nosotros que es todo el resto de personas que usan muy muy muy muy poquitas cosas.</strong></p><p>[J] Hasta ahora, para las empresas el objetivo era estar en las tiendas de aplicaciones y √©sta era la √∫nica forma de obtener visibilidad. Si no estaban ah√≠ el usuario no iba a poder descubrir la aplicaci√≥n. Hubo un boom de aplicaciones que pr√°cticamente no serv√≠an para nada. Para usar una aplicaci√≥n tengo que pasar por todo el proceso de encontrar la aplicaci√≥n, descargarla e instalarla, ocupando un espacio en el tel√©fono. En occidente, que hemos crecido con smartphones y tenemos buenas tarifas de datos, tenemos todav√≠a la costumbre de estas aplicaciones. Pero hay mucha gente nueva en Internet en muchos pa√≠ses emergentes que no quiere descargar. Las tarifas de datos son car√≠simas y quieren consumir contenido directamente, sin pasar por el proceso de instalaci√≥n.</p><p>Es curioso porque yo trabajo en Spotify y siempre tenemos este dilema de si debemos promocionar las aplicaciones nativas (por ejemplo descargar la aplicaci√≥n de escritorio) y qu√© casos de uso cubre un reproductor web. ¬øPuede reemplazar un reproductor web a la aplicaci√≥n de escritorio? Este tipo de conversaciones las tenemos casi todos los d√≠as. Hay un mont√≥n de empresas que est√°n viendo que tienen que ir hacia web si quieren estar donde va a estar el pr√≥ximo bill√≥n (mil millones) de usuarios. Lo vemos con Twitter y Uber, que hace poco lanz√≥ su mobile site, y con muchos otros. Habitualmente son compa√±√≠as de India y de China las que m√°s est√°n empujando por este tipo de desarrollos.</p><p>Creo que es un buen momento para explicar que hay detr√°s de las PWAs y qu√© engloban.</p><p><strong>[I] Perfecto, cu√©ntanos un poco porque obviamente ya hemos dicho que no son tecnolog√≠as completamente nuevas. Es un Progressive Enhancement, que se ven√≠a haciendo desde hace ya mucho tiempo. Los que desarrollamos para web debemos tener en cuenta tecnolog√≠as m√°s antiguas y dispositivos m√°s antiguos para que tengan una m√≠nima experiencia. Luego vamos sumando funcionalidades para llegar a dar a nuestros usuarios lo que creemos que es mejor para ellos, o lo que creemos que ayuda al negocio en este caso.</strong></p><p>[J] Yo creo que al final eso es lo que tenemos que hacer. Nos tenemos que centrar en qu√© quiere el usuario y ver cu√°l es la soluci√≥n t√©cnica. Muchas veces cuando aparece este tipo de tecnolog√≠as todo el mundo quiere utilizarlas. Intentan un proyecto en el que aplicarlas, cuando en realidad deber√≠a ser al contrario.</p><p>Cuando hablamos de PWAs lo hacemos principalmente de ServiceWorkers. A veces tambi√©n de a√±adir un manifest.json y notificaciones push. ServiceWorker es un fichero Javascript que el navegador se va a descargar una vez cargada la p√°gina y es capaz de interceptar peticiones. Cualquier petici√≥n que se haga a tu dominio va a ser capturada por este ServiceWorker. Ah√≠ ya puedes hacer lo que quieras: puedes devolver tu respuesta personalizada, puedes acceder a una cach√© si quiere devolver datos cacheados, etc. En resumen, es un proxy, un fichero Javascript que se pone en medio. Hay un mont√≥n de ‚Äúrecetas‚Äù (cookbook). Si busc√°is en google encontrar√©is muchas cosas que puedes con ServiceWorkers.</p><p>Por ejemplo vas a tu p√°gina web o blog y quieres poder volver a ver el contenido cuando no haya conexi√≥n a internet. En este caso puedes tener un ServiceWorker que se descarga el contenido para tenerlo accesible offline. Otro ejemplo es hacer una petici√≥n para obtener una imagen y que el ServiceWorker se encargue de devolver el formato que soporta el navegador, como por ejemplo webp.</p><p>La principal caracter√≠stica es offline, que no la ten√≠amos bien implementada hasta ahora. S√≠ que exist√≠a una tecnolog√≠a llamada Application Cache que pr√°cticamente nadie utilizaba porque era muy dif√≠cil de implementar, y que est√° soportada todav√≠a en iOS. Cuando hablamos de soporte para estas APIs siempre iOS y Safari quedan un poco fuera. √âsta es la tecnolog√≠a que ServiceWorker intenta reemplazar.</p><blockquote><p>Debemos hacer un uso justo y limpio de estas tecnolog√≠as o si no va a resultar en problemas y habr√° que establecer l√≠mites, lo que no es bueno para nadie.</p></blockquote><p><strong>[I] De hecho ahora mismo es el √∫nico navegador moderno que no tiene ServiceWorker integrado, frente a Chrome, Firefox, Opera o Samsung Web Browser.</strong></p><p>[J] Para ser correcto, en Edge est√°n trabajando en implementarlo y Safari ha anunciado que hay cierto inter√©s en implementarlo en su plan de aqu√≠ a 5 a√±os, as√≠ que con suerte llegar√°. Tambi√©n podemos hablar de la pr√°ctica empresarial de Google promoviendo PWAs frente a Apple, que no lo hace. Podemos ver que hay quiz√°s ciertos intereses detr√°s de estas decisiones.</p><p>Algo que tambi√©n permiten los ServiceWorkers es la sincronizaci√≥n background, de tal forma que no necesitas ni siquiera tener la pesta√±a abierta de tu p√°gina para poder acceder al contenido. Si despliegas una nueva versi√≥n de tu web puedes comprobar en un ServiceWorker instalado si hay una nueva versi√≥n y descargarte los assets. As√≠, una nueva petici√≥n del usuario a tu web puede usar directamente esos nuevos assets, cargando m√°s r√°pido.</p><p>Un problema es que con el poder de un ServiceWorker viene tambi√©n una gran responsabilidad. Mucha gente ve el hecho de hacer que una p√°gina funcione offline con una excusa para poder descargar toda la web por si acaso el usuario quiera acceder a una de las p√°ginas. Es algo que a m√≠ personalmente no me gusta. Por ejemplo si accedo a tu blog quiz√°s est√© interesado en ver esa p√°gina offline pero no me gustar√≠a que utilizaras mi conexi√≥n a internet para descargar todo el contenido y todas las im√°genes de tu blog para hacerlo disponible offline. Hay un conjunto de buenas pr√°cticas como por ejemplo mostrar un bot√≥n para que el usuario pueda hacer cierto contenido offline. Debemos ser cuidadosos en este aspecto. Cuando instalas una aplicaci√≥n en iOS o en Android ves cu√°ntos MBs te est√°s descargando, al menos para la instalaci√≥n inicial. Cuando accedes a una p√°gina web t√∫ no lo sabes, Debemos hacer un uso justo y limpio de estas tecnolog√≠as o si no va a resultar en problemas y habr√° que establecer l√≠mites, lo que no es bueno para nadie.</p><p><strong>[C] ¬øHay otros mecanismos de almacenamiento?</strong></p><p>[J] Cuando interceptas estas peticiones almacenas los datos en una cach√© y hay una forma de hacer que el contenido se almacene de forma temporal o persistente. El navegador considera que todo lo que descargas lo puede eliminar si lo necesita, pero hay una cierta cantidad de datos para los que puedes decir que por favor lo mantenga. Esto se calcula como un porcentaje del total de espacio disponible, teniendo en cuenta tambi√©n cookies y localStorage. Antes hab√≠a por ejemplo un l√≠mite de 5MB en localStorage. Ahora el navegador dedica un porcentaje del espacio de disponible en disco duro para almacenar datos. As√≠ que en principio no hay l√≠mite, y √©se es el problema. Desde una web puedes hacer una descarga grande hasta que el navegador se quede sin espacio y lance una excepci√≥n.</p><p>A la hora de implementar ServiceWorkers se puede hacer o bien a mano o utilizando una librer√≠a. Google tiene un par de librer√≠as buenas que para incluir en proyectos: una se llama <a href="https://github.com/GoogleChromeLabs/sw-toolbox" target="_blank" rel="noopener">sw-toolbox</a> y la otra <a href="https://github.com/GoogleChromeLabs/sw-precache" target="_blank" rel="noopener">sw-precache</a>. Hay 3 p√°ginas que me gustan bastante sobre ServiceWorkers. Una es una p√°gina de ejemplos que hay en googlechrome/samples y Jake Archibald, que trabaja en Google, tiene tambi√©n un <a href="https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook/" target="_blank" rel="noopener">documento muy bueno que se llama The Offline Cookbook</a>, y por √∫ltimo Mozilla tiene en <a href="https://serviceworke.rs/" target="_blank" rel="noopener">serviceworke.rs</a> una lista de diferentes estrategias a la hora de implementar ServiceWorkers.</p><p><strong>[I] Pues luego las anotamos y las dejamos en el programa. Algo que has mencionado son las Push Notifications, que no s√© si van directamente ligadas con el hecho de usar una PWA, pero que es algo que va de la mano. Por ejemplo utilizando websockets, obtener informaci√≥n en directo y que vas recopilando en funci√≥n de cu√°ndo la env√≠as desde un servidor y el usuario va recibiendo ese feedback.</strong></p><p>[J] Todo esto se basa en ServiceWorkers porque al final necesitas tener algo corriendo. Si tu p√°gina no est√° en primer plano tienes que tener un ServiceWorker que es lo que se va a quedar ejecut√°ndose cuando el usuario cierra esa ventana o esa pesta√±a. Las notificaciones push son la misma notificaci√≥n push que se ve normalmente en una aplicaci√≥n. Va por otra v√≠a pero al final la parte visual es exactamente igual.</p><p>Las notificaciones push eran una de las razones principales por las que las empresas quer√≠an hacer aplicaci√≥n nativa. Una de las razones era el descubrir esa aplicaci√≥n, para lo cual necesitabas hacer una aplicaci√≥n nativa y ponerla en la tienda, la segunda era poder tener notificaciones push. Es √∫til para que el usuario vuelva a tu aplicaci√≥n y no es suficiente con que el usuario instale la aplicaci√≥n. Pr√°cticamente hoy tenemos acceso a todo lo que tiene acceso una aplicaci√≥n nativa.</p><p><strong>[I] Hay ciertas APIs que de momento funcionan ah√≠ ah√≠. Hablamos con tecnolog√≠as web sin tener algo de por medio como pueda ser PhoneGap o Ionic. Nosotros desarrollamos una plataforma con WebRTC y tuvimos un mont√≥n de problemas para implementarlo porque obviamente no est√° soportado en varios navegadores. Hasta Edge 14 √≥ 15 no funcionaba. Obviamente Internet Explorer tampoco. Safari no funcionaba hasta hace muy poquito o han dicho que lo van a implementar en la siguiente versi√≥n del sistema operativo y obviamente funcionaba en Chrome. Aunque Chrome es una gran mayor√≠a en uso a nivel mundial no hay que olvidar que hay muchos otros usuarios que no usan Chrome.</strong></p><p>[J] S√≠, y luego todos aquellos que usen iPhone est√°n fuera de momento de las PWAs. No es posible a√±adir una web a la pantalla de inicio y abrirlo a pantalla completa. Como dec√≠a, es un tema de marketing. PWA no deja de ser una web de toda la vida a la que le hemos a√±adido una funcionalidad extra para ponerlo en la pantalla de inicio y que no se abra el navegador, y soporte offline.</p><blockquote><p>ServiceWorker es un progressive enhancement, no puedes suponer que va a estar ah√≠.</p></blockquote><p><strong>[C] Hablando de ese soporte offline y de ServiceWorkers, he le√≠do el t√©rmino ‚Äúoffline first‚Äù. ¬øNos pod√≠as comentar un poco c√≥mo funciona?</strong></p><p>[J] Es gracioso porque estaba escuchando <a href="http://wecodesignpodcast.com/2017/07/04/mobile-first/" target="_blank" rel="noopener">el podcast que hicisteis con Diana sobre Mobile First</a>. A veces nos hablan de offline first, a veces nos hablan de mobile first y a veces de content first cuando se habla sobre response design. Al final como desarrollador dices ¬øqu√© tengo que hacer?</p><p>La idea de offline first est√° muy bien, no dar nada por hecho, que tu web pueda funcionar sin conexi√≥n a internet. Pero a la hora de implementarlo viene la parte dif√≠cil porque al introducir ServiceWorkers normalmente introduces el cacheo de fichero Javascript y tambi√©n un sistema de templates. Para esto funciona muy bien utilizar librer√≠as como Preact o Vue, donde tienes los templates y tienes el JS y no tienes nada server-side. Esto es muy f√°cil de cachear. Tambi√©n offline se pod√≠a conseguir hasta ahora utilizando unas buenas cabeceras de respuesta. Muchas veces no hace falta utilizar ServiceWorkers si quieres que tu p√°gina siga funcionando o que no repitas una request. Es cuesti√≥n de decirle al navegador que cachee el contenido durante m√°s tiempo. Cuando hablan de offline first se entiende que no hay que asumir cu√°les son las condiciones de la red. Sup√≥n que no hay red, ¬øc√≥mo va a comportarse tu p√°gina?</p><p>Uno de las caracter√≠sticas de ServiceWorkers es que la primera vez que visitas una p√°gina, √©sta no se va a renderizar utilizando ServiceWorkers. El SW se a√±ade despu√©s, lo descarga el navegador y s√≥lo funciona para las siguientes peticiones. Es un progressive enhancement, no puedes suponer que el Service Worker va a estar ah√≠. Para que tu contenido sea offline primero tienes que visitar la web y tienes que poder cargar este ServiceWorker, que descargar√° el contenido. Me gusta offline first, igual que se suele pensar sobre qu√© pasar√≠a si no se pudiera descargar o ejecutar Javascript, en cuyo caso habr√≠a que hacer, por ejemplo, Server Side Rendering. O ¬øqu√© pasar√≠a si el usuario tiene problemas de accesibilidad, qu√© va a ocurrir con el contenido, va a ser le√≠do por lectores de accesibilidad? Todo esto al final va sumando y tenemos que pensar en una experiencia buena para que luego le a√±adamos funcionalidad. Y offline first no deja de ser otra m√°s. Cuesta mucho decidir qu√© va primero ¬øcontenido, mobile, offline? Son metodolog√≠as diferentes. Como desarrolladores a veces estamos cansados, hay un poco de fatiga con todo lo que sale nuevo y hay que leerlo e intentar decir ‚Äúvale, esto lo sit√∫o aqu√≠ y forma parte de mis herramientas para en alg√∫n momento determinado poder aplicarlas‚Äù.</p><p><strong>[I] Hay una p√°gina web de una desarrolladora que se llama [inaudible] que tiene un botoncito para hacer offline un post determinado, como dec√≠as t√∫ al principio ‚Äúquiero que este post en concreto, que me interesa escuchar a lo mejor cuando no tenga conexi√≥n‚Äù, pues lo guarda y te cachea las im√°genes y todo lo que tiene ese post. Ella graba con voz cada uno de los art√≠culos que escribe y deja que los escuches de forma offline si quieres. Creo que es una manera muy buena para dejar que el usuario decida si quiere descargar ese episodio o en este caso un art√≠culo y que lo pueda leer cuando va en el metro sin conexi√≥n. No nos olvidemos que aunque vivimos en grandes ciudades en much√≠simas ocasiones tenemos eso que llaman Lo-Fi. No tienes conexi√≥n suficiente porque est√°s dentro de un t√∫nel y durante un per√≠odo de tiempo determinado tienes una conexi√≥n realmente mala o directamente ninguna.</strong></p><p>[J] S√≠, tambi√©n lo llaman Lie-Fi, como que es un poco de mentira. Te dice que tiene wi-fi pero intenta descargar cosas por la wi-fi y no acaba de traerse nada. Yo creo que √©se es un buen caso de uso. Jake Archibald, que es uno de los ingenieros de Google que ha estado dando presentaciones sobre esto, tiene una PWA para ver art√≠culos de Wikipedia. Y tiene un bot√≥n para descargar un art√≠culo y poder leerlo luego. Creo que esa funcionalidad es muy buena. Yo tengo un blog y no uso JS para nada, excepto para un SW. Y si te quedas sin conexi√≥n puedes leer el post que estabas leyendo m√°s un par de enlaces m√°s que todo que tengo arriba en el men√∫. Y ya est√°, no necesitas nada m√°s. Est√° muy bien darle al usuario la posibilidad de que si quieren puedan descargar el contenido online. Me parece s√∫per bien y creo que √©se es el tipo de casos de uso que tenemos que intentar cubrir, y no intentar usarlo para todo s√≥lo porque es nuevo.</p><blockquote><p>Mucha gente cree que esto de las PWA es s√≥lo para sitios web grandes o de empresas importantes. En realidad puedes a√±adir un SW y manifest a cualquier web.</p></blockquote><p><strong>[I] Antes has hablado del Manifest. Aunque ya sabemos que es un JSON y que da ciertas funcionalidades como decir ‚Äúb√°jate este archivo, baja este otro‚Äù. ¬øPara qu√© otras cosas se puede utilizar el Manifest?</strong></p><p>[J] Yo creo que estaban un poco hartos de a√±adir cabeceras ‚Äúmeta‚Äù dentro dentro de las p√°ginas y decidieron crear un fichero donde definir un JSON con un mont√≥n de informaci√≥n que queremos tener para esta integraci√≥n. En Google lo llaman A2HS (Add to Home Screen) y es lo que va a utilizar el sistema operativo m√≥vil para poder abrir la aplicaci√≥n. T√∫ le dices con qu√© orientaci√≥n quieres abrirla y qu√© iconos quieres utilizar. Cuando implementas una PWA puedes comprobar dentro de tu c√≥digo si est√° corriendo en modo aplicaci√≥n (lanzada desde la pantalla de inicio) o si est√° corriendo dentro del navegador, utilizando display-mode. Si es standalone significa que est√° instalada y corriendo desde la pantalla de inicio. Est√° bien para analytics, para saber cu√°nta gente ha instalado la aplicaci√≥n y la est√° utilizando as√≠. Tambi√©n puedes utilizarlo para media-queries, para poder cambiar ligeramente en el estilo de la p√°gina dependiendo de si lo has lanzado desde la pantalla de inicio o no. Uno de los casos de uso ser√≠a mostrar botones de navegaci√≥n cuando lo lanzas en fullscreen.</p><p>Mucha gente cree que esto de las PWA es s√≥lo para sitios web grandes o de empresas importantes. En realidad puedes a√±adir un SW y manifest a cualquier web. Hay directorios de PWAs (por ejemplo <a href="https://pwa-directory.appspot.com/" target="_blank" rel="noopener">PWA Directory</a> o <a href="https://pwa.rocks" target="_blank" rel="noopener">PWA Rocks</a>) a poder descubrir dentro de Bing PWAs y te va a ofrecer la posibilidad de instalarlas. Es una especie de store pero en lugar de t√∫ publicar ah√≠, Microsoft va a utilizar el mismo crawler que usan para Bing y va a poder mostrar ah√≠ directamente la web.</p><p>No creo que las PWAs est√©n restringidas a webs grandes y pienso que todo el mundo deber√≠a probarlas. Los desarrolladores deber√≠amos hacer pruebas con nuestras webs. Cuando empec√© a utilizar ServiceWorkers me di cabezazos contra el ordenador porque las herramientas de desarrollo no estaban muy desarrolladas, valga la redundancia. Cuando hac√≠a una petici√≥n no sab√≠a si la respuesta estaba viniendo del ServiceWorker o de verdad estaba sirviendo el fichero del servidor. Ten√≠asque buscar por ah√≠ un men√∫ hab√≠a muy oculto para activar la opci√≥n de que todas las peticiones dentro de localhost fueran directamente al fichero y que no se cacheen. Esto ha mejorado much√≠simo.</p><p>Tenemos muchas estrategias sobre c√≥mo hacer versionado de cach√©s. Cuando almacenas en ServiceWorker est√°s almacenando en la memoria del navegador. Si haces cambios en tu web y lanzas una nueva versi√≥n y versionas de la misma forma que versionas otros scripts, deber√≠as ser un buen ciudadano, acceder a la versi√≥n previa que ten√≠as cacheada y eliminarla del navegador. Si no al final vas a acumular un mont√≥n de bundles de Javascript o templates que ya no se necesitan.</p><p>S√© que hay alguna pregunta sobre utilizar PWAs con React, Vue y otras librer√≠as. Si hab√©is utilizado alguna vez Create React App, que es una especie de boilerplate para crear aplicaciones React, tambi√©n existe la posibilidad de utilizar estas mismas herramientas para crear PWAs. Create React App va a crear directamente por defecto una PWAs y, si utiliz√°is Preact, lanzaron su CLI para crearlas con Preact, y Vue tambi√©n tiene su CLI con el que se generan PWAs por defecto.</p><p><strong>[C] Como has comentado antes, Apple no tiene soporte para para PWAs. ¬øVes un poco de guerra entre Google y Apple?</strong></p><p>[J] A veces parece que s√≠, al igual que Internet Explorer no implementaba nada nuevo en su navegador y entonces sali√≥ Firefox que implementaba todo. Mucha gente se pas√≥ a Firefox y posteriormente a Chrome. Siempre existe esta guerra de navegadores y de las empresas que hay detr√°s. Me gusta mucho Google, que est√° empujando por estos est√°ndares. Si desarrollamos PWAs el usuario no necesitar√° ir a la Store a descargarse nada, y ahora mismo tanto puede Google com oApple se llevan un porcentaje cuando descargas aplicaciones de pago y tambi√©n de los pagos in-app. Al principio Apple s√≥lo ofrec√≠a herramientas web para desarrollar ‚Äúaplicaciones‚Äù para iPhone, no exist√≠a nada para hacer una aplicaci√≥n nativa. Todo giraba en torno a crear webs que tuviera el mismo look&amp;feel. Luego descubrieron que ah√≠ es donde estaba el negocio cuando empezaron a proporcionar estas herramientas para desarrollar aplicaciones nativas. Es dif√≠cil que vayas a ir en contra de tu principal fuente de ingresos. Google parece que tienen los ingresos m√°s diversificados. Al confiar en una plataforma de anuncios Google se va a llevar dinero por anuncio, que tambi√©n se muestran en la web (eg PWA).</p><p>Hay mucho trabajo para estandarizar estas APIs, implementarlas de una forma buena idea y de releasearlas. Pero estoy seguro de que tambi√©n hay decisiones de negocio. Google se ha posicionado claramente hacia promover esta serie de APIs, hacen workshops en varios sitios del mundo explicando c√≥mo usarlas, muestran c√≥mo diferentes webs est√°n implementando esta funcionalidad (qu√© problemas ten√≠an de rendimiento, c√≥mo han a√±adido PWAs y han ido mejorando, cu√°les son las m√©tricas que se ha movido como mayor retenci√≥n de usuarios o m√°s p√°ginas vistas). Trabajan codo con codo con empresas grandes como Flipkart - el ‚ÄúAmazon‚Äù de India - o ele.me, que es una empresa muy grande de China de venta de comida online.</p><p>Apple va un poco por su cuenta. Es verdad que Safari est√° cambiando, implementando mucha funcionalidad que faltaba, pero da la sensaci√≥n de que son reacios a implementar PWAs. Para entender mejor las razones pienso que es √∫til pensar c√≥mo puede afectar a las fuentes de ingresos que los desarrolladores migren a web. Las empresas tienen un n√∫mero limitado de trabajadores y muchas cosas que quieren hacer. Tienen que priorizar unas frente a otras y por lo que sea no est√°n priorizando los ServiceWorkers y toda la funcionalidad para a√±adir webs a pantalla de inicio para ejecutarlas de forma standalone.</p><p><strong>[I] Yo creo que en este caso Apple a lo mejor no tiene publicidad directa como hace Google, y le da un poco m√°s igual. Como tiene tant√≠simos beneficios a trav√©s de la App Store perder ese mercado, que es inmenso, es un peligro obviamente para ellos. Ahora mismo los que √∫ltimamente llegan tarde son Edge y Safari (Edge est√° mejorando un mont√≥n pero a√∫n quedan algunas cosillas) y, en mi opini√≥n, est√° claro por qu√© no lo est√°n implementando. Con la salida de Technology Preview, que es la versi√≥n de desarrollador, s√≠ est√° cambiando, pero le queda mucho para que, como pasa con Firefox y Chrome, se actualicen de forma constante.</strong></p><p>[J] Tambi√©n est√° la restricci√≥n de que no puedes correr ning√∫n navegador con otro motor. As√≠ que aunque t√∫ instales Chrome o Firefox en iPhone est√°s corriendo Webkit por detr√°s, el motor de Safari. Puedes personalizar la experiencia alrededor del navegador pero no implementar PWAs. Eso es una decisi√≥n de negocio, y ah√≠ no hay ninguna excusa. No puedes decir ‚Äúqueremos hacer el entorno m√°s seguro‚Äù. Podr√≠an utilizar el proceso de env√≠o y revisi√≥n de aplicaciones y que t√∫ pudieras ofrecer un motor de renderizado diferente. Es su ecosistema y controlan lo que ofrecen a los usuarios. El target de usuarios es diferente. Por ejemplo, en India o China el mercado de iOS es bastante m√°s peque√±o que en otros pa√≠ses de nuestro alrededor. Cada empresa juega sus cartas.</p><p>Como desarrolladores lo tenemos que ver como una funcionalidad a√±adida. Si lo soporta el navegador podemos utilizarlo y si no lo soporta, como hemos hecho bien nuestro trabajo, va a dar lo mismo porque el usuario va a poder disfrutar de nuestra web. Son APIs para mejorar nuestra web pero nunca tenemos que asumir que est√°n ah√≠. Y lo bueno de ServiceWorker es que no se puede asumir su soporte, dado que la primera vez que carga la p√°gina no se puede utilizar.</p><p><strong>[I] Si te parece pasamos las preguntas que nos han dejado por Twitter. Pregunta Manuel si has tocado Vue para las PWAs o si sabes alg√∫n recurso sobre ServiceWorkers y notificaciones push en castellano.</strong></p><p>[J] No he usado Vue todav√≠a. He estado leyendo sobre Vue pero me he enfocado m√°s en React, que lo estoy utilizando en un proyecto grande, y probando Preact e Inferno por cuestiones de tama√±o. Afortunadamente no necesitamos utilizar ninguna de estas librer√≠as para crear PWAs. Como dije, mi blog s√≥lo utiliza Javascript para crear un ServiceWorker y tener contenido offline. Las PWAs no requieren frameworks ni librer√≠as espec√≠ficos. Ni siquiera tienen que ser una SPA.</p><p>Recomiendo utilizar Vue CLI para crear PWAs con Vue. Habr√°n tomado algunas decisiones por ti, abstray√©ndote para bien o para mal de los detalles de implementaci√≥n, pero te servir√° para crear un esqueleto para una aplicaci√≥n.</p><p>Sobre recursos en espa√±ol hay una web que se llama ‚Äú<a href="https://developers.google.com/web/fundamentals/codelabs/your-first-pwapp/" target="_blank" rel="noopener">Tu primera Progressive Web App</a>‚Äù y la escribi√≥ Pete LePage, que es un desarrollador de Google. Es una traducci√≥n al espa√±ol de la documentaci√≥n oficial. Es un muy buen recurso y es m√°s detallado que otros art√≠culos que se pueden encuentran en espa√±ol en Internet.</p><p><strong>[I] Fernando nos pregunta c√≥mo encajan con las PWAs Que, React y Angular.</strong></p><p>[J] Recomiendo que cada uno escoja el framework/librer√≠a con la que se sientan m√°s a gusto. Todas estas soluciones son similares y se pueden crear PWAs con ellas.</p><p><strong>[I] Fernando nos deja una segunda pregunta. Quiere saber si se adaptan los servicios workers correctamente a las aplicaciones h√≠bridas Ionic o PhoneGap.</strong></p><p>[J] Es una buena pregunta. Es dif√≠cil saber d√≥nde est√° la frontera entre entrar desarrollando una web que luego va a correr en una WebView, como en el caso de PhoneGap o Ionic. Tambi√©n hay alternativas nativas como ReactNative o NativeScript. Si est√°s desarrollando en iOS no vas a tener soporte para ServiceWorker independientemente de si es el navegador o si es una WebView porque no deja de ser el mismo navegador; no vas a tener soporte.</p><p>En el caso de Android no estoy seguro de c√≥mo funcionan los ServiceWorkers dentro de las WebViews. Por ejemplo, quiz√°s se cachea, quiz√°s se mantiene en memoria s√≥lo para esa WebView espec√≠fica. No he llegado a trabajar con PWAs dentro de una aplicaci√≥n h√≠brida.</p><p><strong>[C] Vamos a pasar a la tanda de preguntas que hemos. Manuel pregunta si puedes recomendar alg√∫n libro que hable sobre PWAs.</strong></p><p>[J] Hasta ahora no conoc√≠a ning√∫n libro sobre PWAs y me he puesto a buscar. Casualmente acaba de salir un libro que est√° en Early Release y se llama ‚Äú<a href="http://shop.oreilly.com/product/0636920052067.do" target="_blank" rel="noopener">Building Progressive Web Apps: Bringing the Power of Native to the Browser</a>‚Äù de O‚ÄôReilly. El autor cre√≥ tambi√©n una librer√≠a que utilic√© para un proyecto llamada ‚Äúannyang‚Äù para hacer reconocimiento de voz.</p><p>Es m√°s habitual encontrar informaci√≥n sobre PWAs en posts (sobre todo los de Developer Relations de Google) y m√°s tarde llegan a libros.</p><p><strong>[C] A Manuel le gustar√≠a saber en qu√© orden se comienza a desarrollar este tipo de aplicaciones.</strong></p><p>[J] Primero haz una web bien y luego mej√≥rala. Considera PWA como un a√±adido. No intentes utilizar PWAs desde el principio o como una forma de solucionar problemas. Por ejemplo, si tienes problemas de performance no es buena idea que intentes solucionarlos con PWAs diciendo ‚Äús√≠, esto cacheo con un ServiceWorker y ya est√°‚Äù. Hay otras cosas que vas a tener que mirar antes.</p><p>Busca otras soluciones como por ejemplo hacer split del bundle: en lugar de mandar 1MB manda 200kB y luego carga el resto de forma as√≠ncrona. No veas PWAs como el martillo y cualquier problema como un clavo.</p><p><strong>[C] David nos hace la √∫ltima pregunta. Est√° interesado en saber que si el cliente sigue requiriendo una alternativa en forma de aplicaci√≥n para tenerla en las stores, ¬øqu√© tecnolog√≠a utilizar√≠as? ¬øCordova con React? ¬øReact Native?</strong></p><p>Es un problema porque aunque tengas una PWA es probable que te digan que la quieren ver en la tienda. Hay dos alternativas. Puedes implementar una aplicaci√≥n h√≠brida con Cordova o Ionic 2, que utiliza Angular, y la empaquetas dentro de un navegador. Tambi√©n puedes utilizar lo √∫ltimo de lo √∫ltimo y utilizar React Native. En este caso tienes que reescribir la vista porque los componentes van a ser diferentes. Lo bueno es que, si la has estructurado bien, puedes reutilizar toda la parte de negocio (por ejemplo Redux). Esta opci√≥n es buena si quieres tener una aplicaci√≥n con un muy buen rendimiento. Tambi√©n existe NativeScript, que se puede utilizar con Preact.</p><p>Independientemente de la soluci√≥n trata de desacoplar el c√≥digo. Intenta tener claro qu√© parte pertenece a la vista y cu√°l es l√≥gica de negocio. Mueve c√≥digo estable a una API, de forma que d√© igual cu√°l sea la interfaz que consume los datos. Esto te permite hacer cambios tanto en la API (por ejemplo reescribi√©ndola en otro lenguaje) como el front (por ejemplo, crear un nuevo cliente para otra plataforma o utilizar una librer√≠a diferente).</p><p>Lo que usas hoy se va a quedar ‚Äúanticuado‚Äù en un par de a√±os, as√≠ que siempre intenta modularizar el c√≥digo y optimiza para el mantenimiento y migraci√≥n del c√≥digo m√°s que esforzarse en acoplar tu proyecto demasiado con un framework.</p><p><strong>[I] Si te parece con esto cerramos las preguntas de Twitter y pasamos a la m√°s dif√≠cil. Dinos c√≥mo ves la web dentro de 5 √≥ 10 a√±os.</strong></p><p>[J] Pues es una pregunta dif√≠cil. Pienso en el desarrollo de los m√≥viles y es impensable lo que hac√≠amos hace cinco a√±os comparado con lo que hacemos ahora. Hace poco estuve en una charla donde un ponente dijo que somos la √∫ltima generaci√≥n que sabr√° lo que es un navegador y creo que el futuro de la web es olvidarse del concepto ‚Äúnavegador‚Äù, o por lo menos como la √∫nica forma de consumir contenidos en la web.</p><p>La web se integra ahora mismo en m√≥viles utilizando PWAs, pero tambi√©n como una Webview en una aplicaci√≥n nativa. Tenemos Chrome OS como el mejor ejemplo de c√≥mo ejecutar sitios web que funcionan como aplicaciones. Y tenemos tambi√©n ejemplos como AMP de Google donde generas contenido que luego va a estar directamente embebido dentro del buscador, o Instant Articles para integrar contenido en Facebook, y Apple News.</p><p>En mi trabajo me doy cuenta de que muchas veces la web se utiliza como un gran backend. Por ejemplo, Google indexa el contenido de Spotify y utilizando la web en la que trabajo (open.spotify.com), extrayendo metadatos para su buscador, que se muestran en un lateral al buscar artistas. Tambi√©n se utiliza para Google Home o Alexa de Amazon para su integraci√≥n con web. Y de forma similar, cuando compartes en Facebook o Twitter, sus bots utilizan metadatos extra√≠dos de la p√°gina para mostrar una previsualizaci√≥n.</p><p>Tenemos que dejar de pensar que hacemos webs que s√≥lo van a ser consumidas a trav√©s de un navegador. Creamos contenido utilizando herramientas web pero no tenemos ning√∫n control sobre d√≥nde se van a visualizar. Un ejemplo es WebVR, donde es dif√≠cil controlar el entorno, y no existe el concepto de ‚Äúp√°gina‚Äù.</p><p>Tenemos que mirar m√°s all√°, pensar en nuevas interfaces y cu√°l va a ser el papel de la web ah√≠ y olvidarse de controlar en entorno. Cuando llegaron los m√≥viles con navegador fue un desaf√≠o crear webs. ¬øUn sitio aparte? ¬øResponsive? Este problema es f√°cil comparado con lo que viene ahora.</p><p><strong>[C] ¬°S√≠ que est√° dif√≠cil saber lo que vendr√°! Si te parece entramos en las r√°fagas, y aqu√≠ va la primera. Dinos alguien que te haya inspirado.</strong></p><p>Me gustar√≠a mencionar gente con la que he trabajado y me ha inspirado. Me gust√≥ mucho trabajar en Tuenti con <a href="https://twitter.com/OrteslaCano" target="_blank" rel="noopener">Alberto Grajera (@OrteslaCano)</a> que ahora est√° en Cabify, <a href="https://twitter.com/davideme" target="_blank" rel="noopener">Davide Mendolia (@davideme)</a> que est√° en Karumi, y <a href="https://twitter.com/felipernb" target="_blank" rel="noopener">Felipe Ribeiro (@felipernb)</a> con quien trabajo en Spotify. Son desarrolladores que sol√≠an hacer web, aunque algunos hacen ahora m√≥vil, y te recuerdan qu√© es lo importante cuando est√°s trabajando. La toma de requisitos, evaluar el problema con una mente ingenieril y no dejarse llevar por modas (por ejemplo √∫ltimas librer√≠as). A todos nos gusta utilizar lo √∫ltimo pero tenemos que anteponer el hecho de que hay un usuario detr√°s, que necesita ese proyecto a tiempo y que funcione bien. Hay una empresa que te est√° pagando por hacer el trabajo, y va a haber un compa√±ero que va a entrar a tu equipo y tiene que heredar o trabajar contigo en ese c√≥digo. Estas 3 personas me han ayudado mucho a centrarme en lo que de verdad es importante.</p><p>Hay gente conocida del mundo web que me gusta seguir, y que me han inspirado de una forma diferente. Steve Souders fue quien hizo reverse engineering de c√≥mo el navegador hac√≠a peticiones y gestionaba las dependencias entre ellas. Fue quien puso las bases de lo que hoy se conoce como WPO (Optimizaci√≥n de rendimiento web).</p><p><a href="https://twitter.com/slicknet" target="_blank" rel="noopener">Nicholas C. Zakas</a>, que trabaja en Yahoo, hablaba sobre patrones para escribir Javascript mantenible. Stoyan Stefanov, que trabaja en Facebook, es otro track de Javascript. Algunos m√°s ‚Äúrecientes‚Äù son Addy Osmani, que es un devrel de Google que da muchas charlas muy entretenidas. Y por √∫ltimo <a href="https://twitter.com/dan_abramov" target="_blank" rel="noopener">Dan Abramov</a>, que quien haya trabajado con Redux sabr√° que es quien responde cualquier pregunta sobre el tema, y trabaja en Facebook.</p><p><strong>[I] Los dejamos todos anotados para que la gente conozca a gente nueva, aprenda cosas nuevas y ampl√≠e sus horizontes. Recomi√©ndanos ahora un recurso, una p√°gina web o un blog que consideres imprescindible.</strong></p><p>No pod√≠a elegir s√≥lo uno, as√≠ que he escogido varios. Me gustan mucho las newsletter y estoy suscrito a <a href="https://frontendfoc.us/" target="_blank" rel="noopener">Frontend Focus</a> y <a href="https://javascriptweekly.com" target="_blank" rel="noopener">Javascript Weekly</a>, que comparten muchos enlaces a posts y v√≠deos de conferencias.</p><p>Me gusta mucho ver v√≠deos de charlas, como por ejemplo los de las JSConf. Esta conferencia es de las principales en JS, las entradas son caras, pero publican todos los v√≠deos en Youtube, as√≠ que es un buen recurso para ponerse al d√≠a. Google IO, el evento anual de Google, publican muchos v√≠deos de sus charlas. Hace un par de meses fue la edici√≥n de 2017 y ya est√°n subidos.</p><p>Hay un par de webs que visito bastante: <a href="https://css-tricks.com/" target="_blank" rel="noopener">CSS-Tricks</a> y <a href="https://www.smashingmagazine.com/" target="_blank" rel="noopener">Smashing Magazine</a>, que hablan sobre frontend en general.</p><p>Un buen libro es ‚ÄúHigh Performance Browser Networking‚Äù de Ilya Grigorik, que es un ingeniero De Google. Te explica todo el stack, qu√© ocurre cuando se hace una petici√≥n y todos los puntos en los que podemos trabajar para mejorar el rendimiento de una web.</p><p><strong>[I] Perfecto. Igualmente lo dejamos apuntado para que la gente los pueda ver.</strong></p><p><strong>[C] Recomi√©ndanos ahora a un invitado o invitada a quien te gustar√≠a que invit√°semos al programa.</strong></p><p>[J] Jaume Sanchez Elias (<a href="https://twitter.com/thespite" target="_blank" rel="noopener">@thespite en Twitter</a>) es un chico que hace WebGL, WebVR y cosas muy chulas. Hace poco coincid√≠ con √©l en una charla y me encant√≥ conocerlo. Es muy enriquecedor cuando conoces a gente puntera que es capaz de inspirar tanto a los desarrolladores web. Es impresionante lo que puede conseguir con estas herramientas. Jaume hace que parezca f√°cil, pero en realidad hay mucho trabajo detr√°s. Me gustar√≠a escuchar a Jaume hablar de estos temas.</p><p><strong>[I] Perfecto, pues le haremos llegar desde aqu√≠ la invitaci√≥n. Por √∫ltimo recomi√©ndanos un tema que te gustar√≠a tratar en el programa.</strong></p><p>[J] Soy un enamorado de mejorar la performance. Me gustar√≠a saber si le preocupa a los desarrolladores, si son capaces de convencer a la gente de producto de que es algo a lo que hay que dedicarle tiempo, y si se ve como una feature m√°s. Cu√°les son los casos pr√°cticos, si han introducido alguna mejora que se tradujera en m√°s usuarios u otras m√©tricas. Echo en falta ejemplos, sobre todo de empresas espa√±olas, donde se vean mejoras de rendimiento que hayan movido m√©tricas importantes para la empresa.</p><p><strong>[I] Muy bien, pues con esto cerramos el programa. La verdad es que ha sido un verdadero placer tenerte con nosotros. Hemos obtenido un mont√≥n de informaci√≥n y sobre temas √∫tiles para que a la gente le pique el gusanillo y se ponga a investigar y a realmente implementarlo.</strong></p><p>[J] Lo divertido es que es f√°cil jugar con nuestras webs, e inspeccionar el c√≥digo de cualquier web, aprendiendo de c√≥mo han aplicado otros PWA.</p><p><strong>[C] Much√≠simas gracias Jos√© Manuel por haber aceptado nuestra invitaci√≥n.</strong></p><p>[J] A vosotros, un honor.</p><p><strong>[I] Muchas gracias.</strong></p><p>[M√∫sica] Recomendaciones. El espacio de sugerencias y recursos √∫tiles para los dise√±adores y desarrolladores web.</p><p><strong>[I] En el programa de hoy os traemos cuatro links, as√≠ que all√° van mis dos primeros. El primero de los links es <a href="https://cloudfour.com/thinks/progressive-web-app-questions/" target="_blank" rel="noopener">un art√≠culo que ha escrito Jason Grigsby de Cloudfour acerca de las PWAs</a>, explicando lo que significa y lo que hacen. Dec√≠a que hace unas semanas le escrib√≠a un estudiante en su proyecto final y quer√≠a preguntarle c√≥mo funcionaban y para qu√© serv√≠an. El segundo link es una herramienta de auditor√≠a que se puede usar a trav√©s de terminal y a trav√©s de p√°gina web, y es <a href="https://github.com/GoogleChrome/lighthouse" target="_blank" rel="noopener">Lighthouse</a>. Es una herramienta que ha desarrollado Google, principalmente Paul Irish, para auditar y ver las m√©tricas de nuestras PWAs.</strong></p><p><strong>[C] El primero de mis links viene de la web de desarrolladores de Google, en la cual ten√©is <a href="https://developers.google.com/web/progressive-web-apps/checklist" target="_blank" rel="noopener">una checklist para poder testear y comprobar si cumple todos los requisitos necesarios</a> y adem√°s poder poner atenci√≥n a los detalles y de esa manera mejorar la experiencia a nuestros usuarios. El segundo de mis links es <a href="https://www.timmykokke.com/2017/06/the-pwa-resource-list/" target="_blank" rel="noopener">un listado de recursos que Timmy ha colgado en su p√°gina web personal sobre las PWAs</a>.</strong></p>]]></content>
    
    <summary type="html">
    
      He grabado un podcast sobre Progressive Web App para WeCodeSign. Esc√∫chalo o lee la transcripci√≥n.
    
    </summary>
    
    
      <category term="pwa" scheme="https://jmperezperez.com/tags/pwa/"/>
    
  </entry>
  
  <entry>
    <title>React Alicante 2017 - A summary of the talks</title>
    <link href="https://jmperezperez.com/react-alicante-2017/"/>
    <id>https://jmperezperez.com/react-alicante-2017/</id>
    <published>2017-10-01T16:00:00.000Z</published>
    <updated>2019-03-19T08:12:57.816Z</updated>
    
    <content type="html"><![CDATA[<p>This weekend I have been in Spain to attend <a href="http://reactalicante.es" target="_blank" rel="noopener">React Alicante</a>. This is the first edition of this conference, focused in React and React Native.</p><p>Continue reading to know more about the event and its contents.</p><p><img src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto,c_scale/v1510326427/react-alicante-glenn-reyes_kokxlw.jpg" sizes="(max-width: 768px) 100vw, 684px" alt="Glenn Reyes speaking at React Alicante"> <small class="caption">Glenn Reyes speaking at React Alicante</small></p><a id="more"></a><p>The conference was 3-day long, one day with workshops introducing React and React Native, and 2 days for talks in a single track.</p><p>It‚Äôs the first edition of the conference, and I believe it‚Äôs also the first React conference arranged in Spain. It was truly international, with all talks delivered in English (something unusual in Spain) and 250 attendees from 25+ countries.</p><p>The most impressive is that <strong>it was arranged by 2 Spanish expats who form the company <a href="https://limenius.com/" target="_blank" rel="noopener">Limenius</a>, based in Munich</strong>. <a href="https://twitter.com/nacmartin" target="_blank" rel="noopener">Nacho</a> and <a href="https://twitter.com/vicqr" target="_blank" rel="noopener">Victoria</a> did an impressive job, putting together a top-level conference with a great line-up and contents. They managed to prove that its possible to arrange a good conference in a well-communicated location like Alicante, with good weather and interesting attractions, while making it affordable (the regular tickets for the talks were 99).</p><img style="max-width:100%" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1510331531/react-alicante-nacho-martin_wzczdx.jpg 400w,        https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1510331531/react-alicante-nacho-martin_wzczdx.jpg 800w,        https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1510331531/react-alicante-nacho-martin_wzczdx.jpg 1200w,        https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1510331531/react-alicante-nacho-martin_wzczdx.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1510331531/react-alicante-nacho-martin_wzczdx.jpg" alt="Nacho Mart√≠n speaking at React Alicante"><p><small class="caption">Nacho Mart√≠n speaking at React Alicante</small></p><img style="max-width:100%" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1510331531/react-alicante-flavio-corpa_tg37vj.jpg 400w,        https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1510331531/react-alicante-flavio-corpa_tg37vj.jpg 800w,        https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1510331531/react-alicante-flavio-corpa_tg37vj.jpg 1200w,        https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1510331531/react-alicante-flavio-corpa_tg37vj.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1510331531/react-alicante-flavio-corpa_tg37vj.jpg" alt="Flavio Corpa during his talk"><p><small class="caption">Flavio Corpa during his talk</small></p><img style="max-width:100%" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1510331531/react-alicante-overview_hncowx.jpg 400w,        https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1510331531/react-alicante-overview_hncowx.jpg 800w,        https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1510331531/react-alicante-overview_hncowx.jpg 1200w,        https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1510331531/react-alicante-overview_hncowx.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1510331531/react-alicante-overview_hncowx.jpg" alt="Overview of React Alicante"><p><small class="caption">General overview of the full room</small></p><p>There were several talks touching on style guides and the difficult world of creating UI components that can be customisable in options and theming. Other topics were forms, CSS in JS, Redux/Mobx, code splitting, GraphQL, and React Native.</p><p>They covered pretty well the current ecosystem of tools when working with React, and they shared learnings that can be applied to our daily jobs.</p><p>Do you want more details about the talks? Continue reading for a short description of each of them and links to their slides.</p><h3 id="Talks-‚Äî-Conference-Day-1"><a href="#Talks-‚Äî-Conference-Day-1" class="headerlink" title="Talks ‚Äî Conference Day 1"></a>Talks ‚Äî Conference Day 1</h3><h4 id="The-effect-of-React-on-web-standards-by-Karl-Horky-Slides"><a href="#The-effect-of-React-on-web-standards-by-Karl-Horky-Slides" class="headerlink" title="The effect of React on web standards by Karl Horky - Slides"></a>The effect of React on web standards by <a href="https://twitter.com/karlhorky" target="_blank" rel="noopener">Karl Horky</a> - <a href="https://work.karlhorky.com/talks/packages/2017-09-28-react-alicante-the-effect-of-react-on-web-standards/" target="_blank" rel="noopener">Slides</a></h4><p>An overview of how the Web Standards committees work and how libraries (jQuery, Dojo, Angular, Knockout, Ember, React) and languages (CoffeeScript) have helped to introduce changes in the DOM and browser APIs.</p><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">&quot;React - Not just a library&quot; indeed!<a href="https://twitter.com/karlhorky?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@karlhorky</a> opening the <a href="https://twitter.com/ReactAlicante?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@ReactAlicante</a> conference by talking about webstandards üôå <a href="https://t.co/4tnVZoyn79" target="_blank" rel="noopener">pic.twitter.com/4tnVZoyn79</a></p>&mdash; React Vienna Meetup (@ReactVienna) <a href="https://twitter.com/ReactVienna/status/913665862829297665?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">29 September 2017</a></blockquote><p>It also included a summary of the current TC39 standards proposals and their stage in the specification process.</p><h4 id="Modular-CSS-by-Andrey-Okonetch-Slides"><a href="#Modular-CSS-by-Andrey-Okonetch-Slides" class="headerlink" title="Modular CSS by Andrey Okonetch - Slides"></a>Modular CSS by <a href="https://twitter.com/okonetchnikov" target="_blank" rel="noopener">Andrey Okonetch</a> - <a href="https://speakerdeck.com/okonet/modular-css-v2-css-in-js-edition" target="_blank" rel="noopener">Slides</a></h4><p>This was a fantastic talk taking us through how we used to build sites and the challenges to keep CSS maintainable. It goes through all the stages from pre-BEM, BEM, CSS modules and JSS (CSS in JS).</p><p>Andrey explains how CSS in JS is not such a bad idea, the same way JSX broke the separation of concerns by getting closer to the components logic.</p><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">Gmail and Google Maps in the history of CSS with <a href="https://twitter.com/okonetchnikov?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@okonetchnikov</a> at <a href="https://twitter.com/ReactAlicante?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@ReactAlicante</a> <a href="https://t.co/3zfpAp2WqS" target="_blank" rel="noopener">pic.twitter.com/3zfpAp2WqS</a></p>&mdash; Karl Horky (@karlhorky) <a href="https://twitter.com/karlhorky/status/913683058594902017?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">29 September 2017</a></blockquote><p>At the end, he talks about the ecosystem of tools to help us either inlining CSS in JS or creating optimised CSS rules that reduce code duplication. In short, it lets machines do what they are best at.</p><p>The talk covers a topic that is really hot at the moment. In fact several other talks also brought up the idea of moving the styles within the components to help with maintainability, theming and critical css rendering. If you like these topics I recommend you to check <a href="https://www.youtube.com/watch?v=MT4D_DioYC8" target="_blank" rel="noopener">Mark Dalgleishs talk at CSSConf EU 2017</a>.</p><h4 id="React-gt-gt-Redux-a-development-workflow-by-Braulio-Diez"><a href="#React-gt-gt-Redux-a-development-workflow-by-Braulio-Diez" class="headerlink" title="React &gt;&gt; Redux a development workflow by Braulio Diez"></a>React &gt;&gt; Redux a development workflow by <a href="https://twitter.com/braulio_sl" target="_blank" rel="noopener">Braulio Diez</a></h4><p>Braulio was really energetic and gave a talk about how you might not always need Redux when working with React. I couldn‚Äôt find tweets nor slides from the talk, so I‚Äôll wait for the videos to add more content.</p><h4 id="React-Storybook-Design-Develop-Document-and-Debug-your-React-UI-components-by-Marie-Laure-Thuret-Slides"><a href="#React-Storybook-Design-Develop-Document-and-Debug-your-React-UI-components-by-Marie-Laure-Thuret-Slides" class="headerlink" title="React-Storybook: Design, Develop, Document and Debug your React UI components by Marie-Laure Thuret - Slides"></a>React-Storybook: Design, Develop, Document and Debug your React UI components by <a href="https://twitter.com/mlthuret" target="_blank" rel="noopener">Marie-Laure Thuret</a> - <a href="https://speakerdeck.com/mlthuret/storybook-dev-design-debug-and-document-your-ui-components" target="_blank" rel="noopener">Slides</a></h4><p>I loved this talk! Do you know that feeling when you are listening someone explaining all your current pains and provides you with great solutions? That‚Äôs how I felt.</p><p>Not only did she talked about how to use StoryBook, but also how it was the source of truth and a communication tool with designers and between developers. You send a PR that makes a change in a component? Link directly to the story for that component so the reviewer sees the result without having to browse through the site.</p><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr"><a href="https://twitter.com/mlthuret?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@mlthuret</a> talking about documentation and Visual Regression Testing with StoryBook <a href="https://twitter.com/hashtag/ReactAlicante?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#ReactAlicante</a> <a href="https://twitter.com/hashtag/NiceTalk?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#NiceTalk</a> <a href="https://t.co/3trWkSmlIK" target="_blank" rel="noopener">pic.twitter.com/3trWkSmlIK</a></p>&mdash; Gabriel Garcia Seco (@GGarciaSeco10) <a href="https://twitter.com/GGarciaSeco10/status/913712092900843521?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">29 September 2017</a></blockquote><p>I was recently looking for tools to do visual regression testing to catch CSS issues, but in the end we decided to skip it. I liked that Marie-Laure talked about this and demoed <a href="https://loki.js.org" target="_blank" rel="noopener">Loki</a>, which I didnt know about, that integrates with StoryBook and provides visual diffing. It looked easy to use and a great complement to unit tests and snapshot tests for components.</p><h4 id="A-practical-guide-to-Redux-Form-by-Erik-Rasmussen-Slides-and-Code"><a href="#A-practical-guide-to-Redux-Form-by-Erik-Rasmussen-Slides-and-Code" class="headerlink" title="A practical guide to Redux Form by Erik Rasmussen - Slides and Code"></a>A practical guide to Redux Form by <a href="https://twitter.com/erikras" target="_blank" rel="noopener">Erik Rasmussen</a> - <a href="https://speakerdeck.com/erikras/a-practical-guide-to-redux-form" target="_blank" rel="noopener">Slides</a> and <a href="https://github.com/erikras/reactalicante2017" target="_blank" rel="noopener">Code</a></h4><p>Im fortunate that I dont have to deal with forms that often. If I ever have to do it with React, I think I would go for <a href="https://redux-form.com/" target="_blank" rel="noopener">Redux Form</a>.</p><p>Creating a form involves having multiple fields with a similar logic. It‚Äôs easy to end up duplicating code and dealing with unmaintainable code that only works for a given form. Redux Form helps removing boilerplate code and integrates beautifully with Redux.</p><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">.<a href="https://twitter.com/erikras?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@erikras</a> on the difficulties of using forms, including use in environments with unidirectional data flow such as React. <a href="https://t.co/qSteZV458r" target="_blank" rel="noopener">pic.twitter.com/qSteZV458r</a></p>&mdash; Karl Horky (@karlhorky) <a href="https://twitter.com/karlhorky/status/913717121032519681?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">29 September 2017</a></blockquote><p>Erik did a ver smooth live demo, going from a simple form as we would implement it, and showing how to add more functionality through Redux Form while refactoring the code.</p><p>I personally love it when I see examples of Higher-Order Components that simplify the code. It‚Äôs usually not obvious how they can solve some patterns, and it‚Äôs one of the most powerful features of functional programming applied to React.</p><h4 id="React-Native-Case-study-From-zero-to-a-super-hero-app-by-Ferran-Negre-Slides"><a href="#React-Native-Case-study-From-zero-to-a-super-hero-app-by-Ferran-Negre-Slides" class="headerlink" title="React Native  Case study: From zero to a super hero app by Ferran Negre - Slides"></a>React Native Case study: From zero to a super hero app by <a href="https://twitter.com/ferrannp" target="_blank" rel="noopener">Ferran Negre</a> - <a href="https://ferrannp.github.io/slides/react-native-zero-to-superhero/" target="_blank" rel="noopener">Slides</a></h4><p>Ferran ent through some features that most mobile applications need to deal with, and explained the challenges to implement them using React Native. He applied it to an application he had developed to follow TV Series (it reminded me to <a href="https://itunes.apple.com/us/app/ishows-tv-powered-by-trakt-tv/id992387872" target="_blank" rel="noopener">iShows</a>).</p><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">So happy to have talked in front of such a huge audience (250) in the sunny and beautiful Alicante! <a href="https://twitter.com/hashtag/reactnative?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#reactnative</a> <a href="https://twitter.com/hashtag/react?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#react</a> <a href="https://twitter.com/ReactAlicante?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@ReactAlicante</a> <a href="https://t.co/crlrB1ungY" target="_blank" rel="noopener">pic.twitter.com/crlrB1ungY</a></p>&mdash; Ferran Negre (@ferrannp) <a href="https://twitter.com/ferrannp/status/913774705521430529?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">29 September 2017</a></blockquote><p>It turns out developing React Native applications is not as straightforward as it seems, especially if you want to mimic exactly how a native application behaves in some cases. Some examples are the lack of automatic refresh of the app when changing the system language, or doing data synchronisation when the app is in the background. Ferran has been documenting lots of tips to solve this issues on his <a href="https://medium.com/@ferrannp" target="_blank" rel="noopener">Medium</a>, and contributed with Java bridges to expose native functionality to React.</p><h4 id="Mutable-or-Immutable-Lets-do-both-by-Mattia-Manzati-Slides"><a href="#Mutable-or-Immutable-Lets-do-both-by-Mattia-Manzati-Slides" class="headerlink" title="Mutable or Immutable? Lets do both! by Mattia Manzati - Slides"></a>Mutable or Immutable? Lets do both! by <a href="https://twitter.com/MattiaManzati" target="_blank" rel="noopener">Mattia Manzati</a> - <a href="https://mattiamanzati.github.io/slides-react-alicante-2017/" target="_blank" rel="noopener">Slides</a></h4><p>Mattia compares MobX and Redux showing their pros and cons and then introduces <a href="https://github.com/mobxjs/mobx-state-tree" target="_blank" rel="noopener">mobx-state-tree</a> which aims to combine the best of MobXs mutability and Reduxs immutability.</p><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">.<a href="https://twitter.com/MattiaManzati?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@MattiaManzati</a> blowing people‚Äôs minds at <a href="https://twitter.com/hashtag/ReactAlicante?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#ReactAlicante</a>. üëç <a href="https://t.co/vD7Cbjm8yP" target="_blank" rel="noopener">pic.twitter.com/vD7Cbjm8yP</a></p>&mdash; Erik Rasmussen (@erikras) <a href="https://twitter.com/erikras/status/913784924485844994?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">29 September 2017</a></blockquote><p>Not having used myself MobX, and being comfortable with the simplicity of React, it was a bit difficult to wrap my head around the problems solved by the library.</p><h4 id="Why-I-Love-Create-React-App-by-Valerii-Sorokobatko-Write-up"><a href="#Why-I-Love-Create-React-App-by-Valerii-Sorokobatko-Write-up" class="headerlink" title="Why I Love Create React App by Valerii Sorokobatko - Write up"></a>Why I Love Create React App by <a href="https://twitter.com/tuchk4" target="_blank" rel="noopener">Valerii Sorokobatko</a> - <a href="https://medium.com/@tuchk4/react-alicante-2017-why-i-love-create-react-app-ed2670b03cc3" target="_blank" rel="noopener">Write up</a></h4><p>Valerii explains how they used create-react-app at his company to provide a unified developer experience and avoid dealing with config and setup, focusing on building features instead. I like how he shows that even though you might be tempted to eject, it might be better to find an alternative that keeps you using create-react-app and getting its updates.</p><p>I love that the talk is supported by <a href="https://medium.com/@tuchk4/why-i-love-create-react-app-e63b1be689a3" target="_blank" rel="noopener">a write up on Medium</a>, which makes it easily digestible for someone that doesnt have time to go through the video.</p><h4 id="Custom-CSS-is-the-path-to-inconsistent-UI-by-Artem-Sapegin-Slides"><a href="#Custom-CSS-is-the-path-to-inconsistent-UI-by-Artem-Sapegin-Slides" class="headerlink" title="Custom CSS is the path to inconsistent UI by Artem Sapegin - Slides"></a>Custom CSS is the path to inconsistent UI by <a href="https://twitter.com/iamsapegin" target="_blank" rel="noopener">Artem Sapegin</a> - <a href="https://sapegin.github.io/slides/inconsistent-styles" target="_blank" rel="noopener">Slides</a></h4><p>The title of this lightning talk is a strong statement, and Artem explains during his talk that we should avoid magic numbers and use components to solve typography and spacing in CSS.</p><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">.<a href="https://twitter.com/iamsapegin?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@iamsapegin</a> about standard UI design and solutions for this at <a href="https://twitter.com/ReactAlicante?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@ReactAlicante</a> <a href="https://t.co/eB5NDnHsme" target="_blank" rel="noopener">pic.twitter.com/eB5NDnHsme</a></p>&mdash; Karl Horky (@karlhorky) <a href="https://twitter.com/karlhorky/status/913745863297683456?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">29 September 2017</a></blockquote><p>To solve spacing specifically he developed <a href="https://github.com/sapegin/react-spaceman" target="_blank" rel="noopener">react-spaceman</a> (see <a href="https://sapegin.github.io/react-spaceman/" target="_blank" rel="noopener">the demo</a>), inspired by <a href="https://medium.com/eightshapes-llc/space-in-design-systems-188bcbae0d62" target="_blank" rel="noopener">Nathan Curtis‚Äô framework</a>.</p><p>Artem is also the author of <a href="https://react-styleguidist.js.org/" target="_blank" rel="noopener">Styleguidist</a>, which was subject of <a href="https://twitter.com/NikkitaFTW" target="_blank" rel="noopener">Sara Vieira‚Äôs</a> talk the day after (read more below).</p><h4 id="Beyond-JavaScript-The-Real-Benefit-of-React-Native-by-Wojciech-Ogrodowczyk"><a href="#Beyond-JavaScript-The-Real-Benefit-of-React-Native-by-Wojciech-Ogrodowczyk" class="headerlink" title="Beyond JavaScript: The Real Benefit of React Native by Wojciech Ogrodowczyk"></a>Beyond JavaScript: The Real Benefit of React Native by <a href="https://twitter.com/sharnik" target="_blank" rel="noopener">Wojciech Ogrodowczyk</a></h4><p>This lightning talk tried to make us developers more critic about what languages we use.</p><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">.<a href="https://twitter.com/sharnik?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@sharnik</a> teaching about language choices, using an example of the Pirah√£ People in the Amazon <a href="https://t.co/PFd22TQnxF" target="_blank" rel="noopener">pic.twitter.com/PFd22TQnxF</a></p>&mdash; Karl Horky (@karlhorky) <a href="https://twitter.com/karlhorky/status/913752918091866113?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">29 September 2017</a></blockquote><p>Instead of saying we are JS developers we should consider ourselves developers and see the good and bad points of the different languages. Use the best tool for the job.</p><h4 id="How-to-make-React-applications-really-reactive-with-Focal-by-Gregory-Shehet-Slides"><a href="#How-to-make-React-applications-really-reactive-with-Focal-by-Gregory-Shehet-Slides" class="headerlink" title="How to make React applications really reactive with Focal? by Gregory Shehet - Slides"></a>How to make React applications really reactive with Focal? by <a href="https://twitter.com/AGambit95" target="_blank" rel="noopener">Gregory Shehet</a> - <a href="https://www.dropbox.com/sh/hnbra4ezcj72jj2/AAAHVE9lrkusriYtDsTyCr7Ga?dl=0" target="_blank" rel="noopener">Slides</a></h4><p>Gregory went through an example application using Reactive Programming and Observables in his lightning talk, and showed how <a href="https://github.com/grammarly/focal" target="_blank" rel="noopener">Focal</a> can overcome the limitations of React for rendering Observables.</p><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">.<a href="https://twitter.com/AGambit95?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@AGambit95</a> on rendering observables within React using Focal at <a href="https://twitter.com/ReactAlicante?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@ReactAlicante</a> <a href="https://t.co/LhmOofGgmj" target="_blank" rel="noopener">pic.twitter.com/LhmOofGgmj</a></p>&mdash; Karl Horky (@karlhorky) <a href="https://twitter.com/karlhorky/status/913791213681115137?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">29 September 2017</a></blockquote><h3 id="Talks-‚Äî-Conference-Day-2"><a href="#Talks-‚Äî-Conference-Day-2" class="headerlink" title="Talks ‚Äî Conference Day 2"></a>Talks ‚Äî Conference Day 2</h3><h4 id="End-to-End-testing-React-applications-by-Forbes-Lindesay-Repo-with-slides"><a href="#End-to-End-testing-React-applications-by-Forbes-Lindesay-Repo-with-slides" class="headerlink" title="End to End testing React applications by Forbes Lindesay - Repo (with slides)"></a>End to End testing React applications by <a href="https://twitter.com/ForbesLindesay" target="_blank" rel="noopener">Forbes Lindesay</a> - <a href="https://github.com/ForbesLindesay/end-to-end-testing-react-applications" target="_blank" rel="noopener">Repo (with slides)</a></h4><p>Forbes, who ran the <a href="https://github.com/ForbesLindesay/intro-to-react" target="_blank" rel="noopener">React workshop</a> at the conference, also gave a talk. Forbes used to work in the Ads team at Facebook London, and a very active programmer with many projects on GitHub.</p><p>In his talk he presented an alternative Testing Pyramid compose by static analysis + javascript unit tests + end to end tests, describing tools to use and the limitations of every step. Lots of these tools like Flow, Jest or Prettier have actually been created at Facebook and now for part of the workflow of many of us.</p><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">Starting this second day of talks with End to end testing React applications by <a href="https://twitter.com/ForbesLindesay?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@ForbesLindesay</a> <a href="https://twitter.com/hashtag/ReactAlicante?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#ReactAlicante</a> <a href="https://t.co/h414HbNAqO" target="_blank" rel="noopener">pic.twitter.com/h414HbNAqO</a></p>&mdash; ReactAlicante ‚öõÔ∏èüåûü•ò (@ReactAlicante) <a href="https://twitter.com/ReactAlicante/status/914025944855334912?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">30 September 2017</a></blockquote><p>End to end tests usually present problems, being slow, unreliable and expensive. Forbes has worked on <a href="https://github.com/ForbesLindesay/cabbie" target="_blank" rel="noopener">cabbie</a> and <a href="https://github.com/ForbesLindesay/taxi-rank" target="_blank" rel="noopener">taxi-rank</a> to make this easier. Cabbie is a webdriver client for Node.js. With it you can control Chrome through chromedriver, but also run the tests using JSDom through taxi-rank, which can run way faster than controlling a real browser, and could be a good alternative in some cases.</p><h4 id="Writing-highly-reusable-React-components-by-Javi-Velasco"><a href="#Writing-highly-reusable-React-components-by-Javi-Velasco" class="headerlink" title="Writing highly reusable React components by Javi Velasco"></a>Writing highly reusable React components by <a href="https://twitter.com/javivelasco" target="_blank" rel="noopener">Javi Velasco</a></h4><p>Javi is the author of <a href="http://react-toolbox.com" target="_blank" rel="noopener">react-toolbox</a>, a suite of React components that use Material Design. The project started back in October 2015 and Javi explained some architectural decisions that were taken and he would address now in a different way.</p><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">.<a href="https://twitter.com/javivelasco?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@javivelasco</a> about to start showing us how to write highly reusable React components <a href="https://t.co/Iy0nzkP3Dx" target="_blank" rel="noopener">pic.twitter.com/Iy0nzkP3Dx</a></p>&mdash; ReactAlicante ‚öõÔ∏èüåûü•ò (@ReactAlicante) <a href="https://twitter.com/ReactAlicante/status/914037890828718080?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">30 September 2017</a></blockquote><p>I like these talks that show the evolution of a project since that‚Äôs what we live everyday with. We build for what‚Äôs needed today and try to make it last, but 2 years in a web project are very long and we quickly find better ways of dealing with past issues.</p><p>Javi explained the theming and customizable constraints imposed by those components, and how he was thinking of isolating the functionality in a <a href="https://www.npmjs.com/package/react-toolbox-core" target="_blank" rel="noopener">react-toolbox-core package</a> (<a href="https://github.com/react-toolbox/react-toolbox/tree/agnostic-components" target="_blank" rel="noopener">here the branch</a> and <a href="https://github.com/javivelasco/react-toolbox-airbnb" target="_blank" rel="noopener">demo</a>), and make it easy to use any CSS-in-JS (aka JSS) method for styling.</p><h4 id="The-Dream-of-Styleguide-Driven-Development-by-Sara-Vieira-Slides-and-Repo"><a href="#The-Dream-of-Styleguide-Driven-Development-by-Sara-Vieira-Slides-and-Repo" class="headerlink" title="The Dream of Styleguide Driven Development by Sara Vieira - Slides and Repo"></a>The Dream of Styleguide Driven Development by <a href="https://twitter.com/NikkitaFTW" target="_blank" rel="noopener">Sara Vieira</a> - <a href="https://styleguide-driven-development-anvohjeduy.now.sh/" target="_blank" rel="noopener">Slides</a> and <a href="https://github.com/SaraVieira/styleguide-driven-development" target="_blank" rel="noopener">Repo</a></h4><p>Sara talked about how to split a design into smaller chunks (eg typography, buttons, icons and cards) and isolate them in a style guide that serves to communicate with the designers.</p><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">React <a href="https://twitter.com/styleguidist?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@styleguidist</a> at <a href="https://twitter.com/hashtag/reactalicante?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#reactalicante</a> by <a href="https://twitter.com/NikkitaFTW?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@NikkitaFTW</a> ü•òüõ•üåÖ<a href="https://t.co/r7pbggUMag" target="_blank" rel="noopener">https://t.co/r7pbggUMag</a> <a href="https://t.co/E2F0QlSnh8" target="_blank" rel="noopener">pic.twitter.com/E2F0QlSnh8</a></p>&mdash; Artem Sapegin ‚òï (@iamsapegin) <a href="https://twitter.com/iamsapegin/status/914057821397897216?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">30 September 2017</a></blockquote><p>Creating new pages is a matter of putting those components together, instead of coming up with new ways to codify the style needed for each page. Sara showed 2 tools for creating style guides: <a href="https://github.com/styleguidist/react-styleguidist" target="_blank" rel="noopener">Styleguidist</a> and <a href="https://storybook.js.org/" target="_blank" rel="noopener">Storybook</a>.</p><p>Storybook had been covered at the first day of the conference, so Sara focused on demoing Styleguidist and showing the differences between the two.</p><p>Regardless of the tool, I really think we should componentise early and evolve the design based on the components.</p><h4 id="Building-a-Realtime-Chat-with-GraphQL-Subscriptions-by-Nikolas-Burk-Slides-and-Demo-code"><a href="#Building-a-Realtime-Chat-with-GraphQL-Subscriptions-by-Nikolas-Burk-Slides-and-Demo-code" class="headerlink" title="Building a Realtime Chat with GraphQL Subscriptions by Nikolas Burk - Slides and Demo code"></a>Building a Realtime Chat with GraphQL Subscriptions by <a href="https://twitter.com/nikolasburk" target="_blank" rel="noopener">Nikolas Burk</a> - <a href="https://www.slideshare.net/nburk/building-a-realtime-chat-with-react-graphql-subscriptions" target="_blank" rel="noopener">Slides</a> and <a href="https://github.com/nikolasburk/graphql-chat" target="_blank" rel="noopener">Demo code</a></h4><p>Many of us have heard about GraphQL but arent using it in production. Nikolas gave a quick overview about GraphQL and coded a chat application based on React + <a href="http://dev.apollodata.com/" target="_blank" rel="noopener">Apollo</a>. For the backend he used <a href="http://graph.cool/" target="_blank" rel="noopener">graphcool</a>, a hosted GraphQL service.</p><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr"><a href="https://twitter.com/nikolasburk?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@nikolasburk</a> speaking on GraphQL subscriptions <a href="https://twitter.com/ReactAlicante?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@ReactAlicante</a> <a href="https://t.co/tmqHVJSTG3" target="_blank" rel="noopener">pic.twitter.com/tmqHVJSTG3</a></p>&mdash; Shawn Leberknight (@shawns_beard) <a href="https://twitter.com/shawns_beard/status/914070758892163072?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">30 September 2017</a></blockquote><p>Nikolas made it look really easy, and thanks to the tools we have today at reach using GraphQL is not a daunting task anymore.</p><h4 id="Code-splitting-in-React-apps-by-Glenn-Reyes-Slides"><a href="#Code-splitting-in-React-apps-by-Glenn-Reyes-Slides" class="headerlink" title="Code-splitting in React apps by Glenn Reyes - Slides"></a>Code-splitting in React apps by <a href="https://twitter.com/glnnrys" target="_blank" rel="noopener">Glenn Reyes</a> - <a href="https://speakerdeck.com/glennreyes/code-splitting-in-react-apps" target="_blank" rel="noopener">Slides</a></h4><p>I was hoping someone would bring up the topic of performance, and that was Glenn. He address the topic of code splitting, generating several bundles out of the JS and CSS code in our React apps.</p><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">Our own <a href="https://twitter.com/glnnrys?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@glnnrys</a> is kicking off with code splitting in <a href="https://twitter.com/reactjs?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@reactjs</a> apps <a href="https://twitter.com/ReactAlicante?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@ReactAlicante</a> üëèüëèüëè <a href="https://t.co/pvHAUU0JrX" target="_blank" rel="noopener">pic.twitter.com/pvHAUU0JrX</a></p>&mdash; React Vienna Meetup (@ReactVienna) <a href="https://twitter.com/ReactVienna/status/914078814342467584?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">30 September 2017</a></blockquote><p>Using <code>import()</code>, a higher-order component and Webpack we can easilly split our bundles in vendor + app chunks, but also at a path or a component level. Thus the browsers requests the bundles needed for the views as we browse them (or we let the browser preload them when it‚Äôs idle).</p><p>I liked the mention to <a href="https://github.com/zeit/next.js/" target="_blank" rel="noopener">Next.js</a>, which has built-in lots of these concepts, and the idea of using <a href="https://github.com/aweary/react-perimeter" target="_blank" rel="noopener">react-perimeter</a> to lazy load components as the user moved the cursor close to an element.</p><h4 id="Redux-Saga-the-Viking-way-to-manage-side-effects-by-Nacho-Martin-Slides"><a href="#Redux-Saga-the-Viking-way-to-manage-side-effects-by-Nacho-Martin-Slides" class="headerlink" title="Redux Saga, the Viking way to manage side effects by Nacho Mart√≠n - Slides"></a>Redux Saga, the Viking way to manage side effects by <a href="https://twitter.com/nacmartin" target="_blank" rel="noopener">Nacho Mart√≠n</a> - <a href="https://www.slideshare.net/nachomartin/redux-sagas-react-alicante" target="_blank" rel="noopener">Slides</a></h4><p>Nacho was one of the organisers and apart from the React Native workshop he also presented a talk. He described Redux Saga as a way to manage side-effects.</p><p>If you have ever tried to get promises back from dispatching actions or orchestrate other sub-actions as a result of actions, youre likely to have used sagas or something like <a href="https://github.com/gaearon/redux-thunk" target="_blank" rel="noopener">redux-thunk</a>.</p><p>He started the talk in the best possible way, by saying:</p><blockquote><p>Maybe you don‚Äôt need redux-saga</p></blockquote><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">.<a href="https://twitter.com/nacmartin?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@nacmartin</a> about to start his talk, showing how to manage side-effects with Redux Saga <a href="https://twitter.com/hashtag/ReactAlicante?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#ReactAlicante</a> <a href="https://t.co/C9egYqumQp" target="_blank" rel="noopener">pic.twitter.com/C9egYqumQp</a></p>&mdash; ReactAlicante ‚öõÔ∏èüåûü•ò (@ReactAlicante) <a href="https://twitter.com/ReactAlicante/status/914114831367725058?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">30 September 2017</a></blockquote><p>More often than not we like to pull more and more tooling when developing React applications just because we think we need them. Nacho explained where Sagas fit and how the use generators underneath, which makes writing async code always as easy as writing synchronous one.</p><p>I think it‚Äôs a good library when thunks fail short.</p><h4 id="The-Road-to-a-Statically-Typed-Future-by-Patrick-Stapfer-Slides"><a href="#The-Road-to-a-Statically-Typed-Future-by-Patrick-Stapfer-Slides" class="headerlink" title="The Road to a Statically Typed Future by Patrick Stapfer - Slides"></a>The Road to a Statically Typed Future by <a href="https://twitter.com/ryyppy" target="_blank" rel="noopener">Patrick Stapfer</a> - <a href="https://speakerdeck.com/ryyppy/the-road-to-a-statically-typed-future-reactalicante-2017" target="_blank" rel="noopener">Slides</a></h4><p>Patrick talked about typing (eg using Typescript or Flow) and how it improves functional patterns writing JS apps, but also as contracts communications client and server to accomplish fully-typed architectures.</p><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">The evolution of static type systems with <a href="https://twitter.com/ryyppy?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@ryyppy</a> at <a href="https://twitter.com/ReactAlicante?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@ReactAlicante</a> <a href="https://t.co/8wW5MGlrAA" target="_blank" rel="noopener">pic.twitter.com/8wW5MGlrAA</a></p>&mdash; Karl Horky (@karlhorky) <a href="https://twitter.com/karlhorky/status/914125965390905344?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">30 September 2017</a></blockquote><p>Finally, Patrick shows how ReasonML and BuckleScript can enforce code correctness even more with an example of a Tic Tac Toe game implementation.</p><h4 id="Case-study-Lucentum-creating-our-own-React-component-library-by-Flavio-Corpa"><a href="#Case-study-Lucentum-creating-our-own-React-component-library-by-Flavio-Corpa" class="headerlink" title="Case study: Lucentum, creating our own React component library by Flavio Corpa"></a>Case study: Lucentum, creating our own React component library by <a href="https://twitter.com/FlavioCorpa" target="_blank" rel="noopener">Flavio Corpa</a></h4><p>Flavio talked about Lucentum, a component library he developed for a client. He shared his learnings and challenges theming and creating awefully complex components, while keeping everything working.</p><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr"><a href="https://twitter.com/FlavioCorpa?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@FlavioCorpa</a> speaking on React component library: case study <a href="https://twitter.com/ReactAlicante?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@ReactAlicante</a> <a href="https://t.co/Rk59QaLBge" target="_blank" rel="noopener">pic.twitter.com/Rk59QaLBge</a></p>&mdash; Shawn Leberknight (@shawns_beard) <a href="https://twitter.com/shawns_beard/status/914144631495041024?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">30 September 2017</a></blockquote><p>It was a down-to-earth talk in which most of us felt identified with. It was also a nice way to link back to Javi Velasco‚Äôs talk about UI components, and how difficult it is to build them to be flexible and accommodate for any imaginable situation.</p><h4 id="Deploying-atomic-design-system-at-scale-by-Nick-Balestra-Slides"><a href="#Deploying-atomic-design-system-at-scale-by-Nick-Balestra-Slides" class="headerlink" title="Deploying atomic design system at scale by Nick Balestra - Slides"></a>Deploying atomic design system at scale by <a href="https://twitter.com/nickbalestra" target="_blank" rel="noopener">Nick Balestra</a> - <a href="https://speakerdeck.com/nickbalestra/deploying-atomic-design-system-at-scale" target="_blank" rel="noopener">Slides</a></h4><p>Nick talked about scaling websites through <a href="https://github.com/opentable/oc" target="_blank" rel="noopener">OpenComponents</a>. Think of the microservice approach taken all the way till the frontend.</p><img style="max-width:100%" sizes="(max-width: 768px) 100vw, 684px" srcset="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:400,f_auto/v1510331530/react-alicante-nick-balestra_gzaig6.jpg 400w,        https://res.cloudinary.com/jmperez/image/upload/w_auto:100:800,f_auto/v1510331530/react-alicante-nick-balestra_gzaig6.jpg 800w,        https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1200,f_auto/v1510331530/react-alicante-nick-balestra_gzaig6.jpg 1200w,        https://res.cloudinary.com/jmperez/image/upload/w_auto:100:1400,f_auto/v1510331530/react-alicante-nick-balestra_gzaig6.jpg 1400w" src="https://res.cloudinary.com/jmperez/image/upload/w_auto:100:684,f_auto/v1510331530/react-alicante-nick-balestra_gzaig6.jpg" alt="Nick Balestra speaking at React Alicante"><p>I liked his presentation very much. We have been trying to solve some of these issues at Spotify for years, in creative ways like <a href="https://speakerdeck.com/jmperez/cross-platform-web-development" target="_blank" rel="noopener">pushing the boundaries of what iframes can do</a>.</p><p>OC‚Äôs approach (and thus OpenTable‚Äôs, the company that built it) is to have parts of the UI served my different services, that can be written in different languages, and maintained/versioned/deployed by a certain team without dependencies on others. The same services can be used to compose email messages or create embeddable widgets.</p><p>I still wonder how everything can be put in place without breaking anything, and where shared state is stored. Still, this architecture seems to work OpenTable.</p><h3 id="Videos"><a href="#Videos" class="headerlink" title="Videos"></a>Videos</h3><p>The videos for the talks are expected to be published in the coming weeks. I‚Äôll link to them when they are live.</p><p>I really hope the conference will be back next year. I think these initiatives help showing that there is a lot of talent in Alicante and it can be a very good destination for remote workers and companies.</p><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>]]></content>
    
    <summary type="html">
    
      First React conference in Spain, covering React and React Native. An international event with workshops and talks.
    
    </summary>
    
    
      <category term="conference" scheme="https://jmperezperez.com/tags/conference/"/>
    
      <category term="react" scheme="https://jmperezperez.com/tags/react/"/>
    
  </entry>
  
</feed>
